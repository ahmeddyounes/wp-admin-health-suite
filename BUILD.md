# Build System Documentation

## Overview

This WordPress plugin uses Webpack to build and bundle React components for use in admin pages. The build system is configured for both development and production environments with appropriate optimizations.

## Build Commands

```bash
# Production build (minified, optimized)
npm run build

# Development build (with source maps)
npm run build:dev

# Watch mode (auto-rebuild on changes)
npm run watch

# Development server with hot reload
npm run dev

# Linting
npm run lint

# Auto-fix linting issues
npm run lint:fix

# Run tests
npm test

# Run all checks (lint + tests) - recommended before submitting PRs
npm run check
```

## Architecture

### Entry Points

The build system creates separate bundles for each admin page:

- `dashboard.bundle.js` - Main dashboard page
- `database-health.bundle.js` - Database health page
- `media-audit.bundle.js` - Media audit page
- `performance.bundle.js` - Performance page
- `settings.bundle.js` - Settings page

Each entry point is located in `assets/js/entries/` and imports:

- React components from `assets/js/components/`
- Page-specific JavaScript from `assets/js/`
- Core admin utilities from `assets/js/admin.js`

### Output

Built files are output to `assets/js/dist/`:

- `*.bundle.js` - Compiled and bundled JavaScript
- `*.bundle.js.map` - Source maps (for debugging)
- `assets.php` - Dependency metadata generated by WordPress

### Dependencies

#### Externalized (not bundled):

- React
- ReactDOM
- jQuery
- WordPress packages (wp.\*)

These are provided by WordPress and loaded separately to avoid duplication.

#### Bundled:

- Custom React components
- Page-specific JavaScript
- Utility functions

## Development Workflow

1. **Start development server:**

    ```bash
    npm run watch
    ```

2. **Make changes** to JavaScript/JSX files in `assets/js/`

3. **Webpack automatically rebuilds** the affected bundles

4. **Refresh browser** to see changes

## Production Build

The production build includes:

- ✅ Minification with Terser
- ✅ Tree-shaking (removes unused code)
- ✅ Source maps for debugging
- ✅ Code splitting (vendor bundle for shared dependencies)
- ✅ Console statement removal
- ✅ WordPress dependency extraction

Bundle sizes (production):

- Dashboard: ~65KB
- Performance: ~56KB
- Database Health: ~37KB
- Media Audit: ~33KB
- Settings: ~12KB

## Configuration Files

- `webpack.config.js` - Webpack configuration
- `.babelrc` - Babel transpiler configuration
- `.eslintrc.json` - ESLint linting rules
- `jest.config.js` - Jest testing configuration
- `package.json` - NPM scripts and dependencies

## WordPress Integration

The `includes/Assets.php` class:

1. Detects the current admin page
2. Loads the appropriate bundle from `assets/js/dist/`
3. Reads dependency metadata from `assets/js/dist/assets.php`
4. Enqueues scripts with proper WordPress dependencies

## Hot Module Replacement (HMR)

Development server runs on port 9000 with proxy to WordPress at localhost:8080.

Configure `devServer.proxy.target` in `webpack.config.js` to match your local WordPress URL.

## Troubleshooting

**Build fails:**

- Run `npm install` to ensure all dependencies are installed
- Check for syntax errors in JavaScript files

**Changes not reflected:**

- Clear browser cache
- Ensure watch mode is running
- Check webpack output for errors

**Missing dependencies:**

- Check `assets.php` is generated in dist folder
- Verify WordPress is loading React and ReactDOM

## Adding New Components

1. Create component in `assets/js/components/YourComponent.jsx`
2. Import in appropriate entry point file
3. Export via `window.WPAdminHealthComponents`
4. Use in PHP templates via JavaScript
5. Rebuild bundles

## Browser Support

Babel is configured to support:

- Browsers with >1% market share
- Last 2 versions of major browsers
- Exclude dead browsers

Configured in `.babelrc` preset-env targets.

## Contributing

Before submitting a pull request, ensure all checks pass:

```bash
# Run all PHP checks (PHPCS linting + PHPStan static analysis + unit tests)
composer check

# Run all JavaScript checks (ESLint + Jest tests)
npm run check

# Run everything
composer check && npm run check
```

This ensures:
- ✅ Code follows WordPress coding standards (PHPCS)
- ✅ No static analysis issues (PHPStan)
- ✅ All PHP unit tests pass
- ✅ JavaScript follows ESLint rules
- ✅ All JavaScript tests pass
