# Handoff: C02-07

Created: 2026-01-18T08:53:24.030361Z

Spec: .plans/C02-07.md


## 2026-01-18T08:57:32.143981Z — claude — impl

Command:
```
claude -p --output-format json --model opus --permission-mode acceptEdits --dangerously-skip-permissions You are implementing task C02-07 in this git repository.

1) Read the spec: .plans/C02-07.md
2) Read handoff/context: .t2/handoff/C02-07.md

Implement the spec fully.

Verification commands (run if non-empty):
- format: 
- lint: npm run lint
- test: npm test

In your final response, include:
- Status: DONE or NEEDS-REVIEW
- Summary of changes
- How to verify (exact commands)
- Risks / follow-ups

```

Return code: 0

Session: 16e62659-a7a3-49f3-a63e-14621414b362

Agent final message (file: C02-07.claude.impl.last.md):

---

## Status: DONE

## Summary of Changes

1. **Created `scripts/check-forbidden-patterns.sh`** - A new bash script that enforces architectural guidelines by detecting misuse of `Plugin::get_instance()` in the codebase:
   - **Check 1**: Scans forbidden directories (Contracts, Domain, Services, Exceptions, Container, AI) where `Plugin::get_instance()` should NEVER be used
   - **Check 2**: Warns about undocumented edge adapter usages in other `includes/` files (non-blocking)
   - **Check 3**: Detects direct `get_container()` access in domain code

2. **Updated `.github/workflows/ci.yml`** - Added a new `forbidden-patterns` CI job that runs the script on every push/PR to main or develop branches

3. **Updated `docs/developers/edge-adapters.md`** - Added comprehensive "CI Enforcement" section documenting:
   - Allowed locations (no documentation needed)
   - Forbidden locations (will fail CI)
   - Locations requiring documentation (warnings)

## How to Verify

```bash
# Run the forbidden patterns check locally
./scripts/check-forbidden-patterns.sh

# Run lint (should show 0 errors, only warnings)
npm run lint

# Run tests (all 417 should pass)
npm test
```

## Risks / Follow-ups

1. **Two undocumented usages detected**: The script found `Plugin::get_instance()` in `includes/RestApi.php` and `includes/HealthCalculator.php` (though the HealthCalculator one is in a docblock example). These are warnings only - adding `EDGE ADAPTER` documentation comments would resolve them.

2. **Grep limitations**: The script uses simple grep pattern matching so it may detect usages in comments/docblocks (like the HealthCalculator example). This is by design - it's better to over-report than miss real violations. Warnings are non-blocking.

3. **New directories**: If new directories are added that should be in the "forbidden" or "allowed" lists, the script should be updated accordingly.


Repo snapshot:
```
branch: main

status:
MM .github/workflows/ci.yml
A  .logs/C01-01.claude.impl.last.md
A  .logs/C01-01.claude.impl.raw.txt
A  .logs/C01-01.gitcommit.txt
A  .logs/C01-02.claude.impl.last.md
A  .logs/C01-02.claude.impl.raw.txt
A  .logs/C01-02.gitcommit.txt
A  .logs/C01-03.claude.impl.last.md
A  .logs/C01-03.claude.impl.raw.txt
A  .logs/C01-03.gitcommit.txt
A  .logs/C01-04.claude.impl.last.md
A  .logs/C01-04.claude.impl.raw.txt
A  .logs/C01-04.gitcommit.txt
A  .logs/C01-05.claude.impl.last.md
A  .logs/C01-05.claude.impl.raw.txt
A  .logs/C01-05.gitcommit.txt
A  .logs/C01-06.claude.impl.last.md
A  .logs/C01-06.claude.impl.raw.txt
A  .logs/C01-06.gitcommit.txt
A  .logs/C01-07.claude.impl.last.md
A  .logs/C01-07.claude.impl.raw.txt
A  .logs/C01-07.gitcommit.txt
A  .logs/C01-08.claude.impl.last.md
A  .logs/C01-08.claude.impl.raw.txt
A  .logs/C01-08.gitcommit.txt
A  .logs/C01-09.claude.impl.last.md
A  .logs/C01-09.claude.impl.raw.txt
A  .logs/C01-09.gitcommit.txt
A  .logs/C01-10.claude.impl.last.md
A  .logs/C01-10.claude.impl.raw.txt
A  .logs/C01-10.gitcommit.txt
A  .logs/C01-11.claude.impl.last.md
A  .logs/C01-11.claude.impl.raw.txt
A  .logs/C01-11.gitcommit.txt
A  .logs/C01-12.claude.impl.last.md
A  .logs/C01-12.claude.impl.raw.txt
A  .logs/C01-12.gitcommit.txt
A  .logs/C02-01.claude.impl.last.md
A  .logs/C02-01.claude.impl.raw.txt
A  .logs/C02-01.gitcommit.txt
A  .logs/C02-02.claude.impl.last.md
A  .logs/C02-02.claude.impl.raw.txt
A  .logs/C02-02.gitcommit.txt
A  .logs/C02-03.claude.impl.last.md
A  .logs/C02-03.claude.impl.raw.txt
A  .logs/C02-03.gitcommit.txt
A  .logs/C02-04.claude.impl.last.md
A  .logs/C02-04.claude.impl.raw.txt
A  .logs/C02-04.gitcommit.txt
A  .logs/C02-05.claude.impl.last.md
A  .logs/C02-05.claude.impl.raw.txt
A  .logs/C02-05.gitcommit.txt
A  .logs/C02-06.claude.impl.last.md
A  .logs/C02-06.claude.impl.raw.txt
A  .plans/C01-01.md
A  .plans/C01-02.md
A  .plans/C01-03.md
A  .plans/C01-04.md
A  .plans/C01-05.md
A  .plans/C01-06.md
A  .plans/C01-07.md
A  .plans/C01-08.md
A  .plans/C01-09.md
A  .plans/C01-10.md
A  .plans/C01-11.md
A  .plans/C01-12.md
A  .plans/C02-01.md
A  .plans/C02-02.md
A  .plans/C02-03.md
A  .plans/C02-04.md
A  .plans/C02-05.md
A  .plans/C02-06.md
A  .t2/handoff/C01-01.md
A  .t2/handoff/C01-02.md
A  .t2/handoff/C01-03.md
A  .t2/handoff/C01-04.md
A  .t2/handoff/C01-05.md
A  .t2/handoff/C01-06.md
A  .t2/handoff/C01-07.md
A  .t2/handoff/C01-08.md
A  .t2/handoff/C01-09.md
A  .t2/handoff/C01-10.md
A  .t2/handoff/C01-11.md
A  .t2/handoff/C01-12.md
A  .t2/handoff/C02-01.md
A  .t2/handoff/C02-02.md
A  .t2/handoff/C02-03.md
A  .t2/handoff/C02-04.md
A  .t2/handoff/C02-05.md
A  .t2/handoff/C02-06.md
MM .t2/state.json
M  CHANGELOG.md
M  README.md
D  admin/Admin.php
M  assets/js/admin.js
M  assets/js/utils/api.js
M  assets/js/utils/api.test.js
M  composer.json
A  docs/architecture-improvement-plan.md
A  docs/decisions/ADR-001-code-organization.md
A  docs/decisions/ADR-002-rest-api-evolution.md
A  docs/decisions/ADR-003-frontend-modernization-scope.md
A  docs/developers/case-sensitivity.md
A  docs/developers/container.md
AM docs/developers/edge-adapters.md
M  docs/developers/hooks.md
M  docs/developers/rest-api.md
M  docs/getting-started.md
D  includes/Admin.php
A  includes/Admin/MenuRegistrar.php
A  includes/Admin/PageRenderer.php
A  includes/Admin/index.php
M  includes/Assets.php
M  includes/BatchProcessor.php
A  includes/Contracts/IntegrationFactoryInterface.php
M  includes/Database.php
M  includes/Installer.php
R  includes/Integrations/Acf.php -> includes/Integrations/ACF.php
M  includes/Integrations/AbstractIntegration.php
M  includes/Integrations/Elementor.php
A  includes/Integrations/IntegrationFactory.php
M  includes/Integrations/IntegrationManager.php
M  includes/Integrations/Multilingual.php
M  includes/Integrations/WooCommerce.php
M  includes/Media/Exclusions.php
M  includes/Performance/HeartbeatController.php
M  includes/Providers/AIServiceProvider.php
M  includes/Providers/BootstrapServiceProvider.php
M  includes/Providers/DatabaseServiceProvider.php
M  includes/Providers/IntegrationServiceProvider.php
M  includes/Providers/RESTServiceProvider.php
M  includes/REST/RestController.php
M  includes/RestApi.php
M  includes/Settings.php
M  includes/Settings/SettingsServiceProvider.php
M  jest.setup.js
A  plan_tasks.csv
D  review_tasks.csv
A  scripts/check-case-sensitivity.sh
D  tasks.csv
M  templates/admin/settings.php
M  tests/unit/Integration/IntegrationManagerTest.php
M  wp-admin-health-suite.php
?? .logs/C02-06.gitcommit.txt
?? .logs/C02-07.claude.impl.last.md
?? .logs/C02-07.claude.impl.raw.txt
?? .plans/C02-07.md
?? .t2/handoff/C02-07.md
?? scripts/check-forbidden-patterns.sh

diff --stat:
.github/workflows/ci.yml         | 11 +++++++++++
 .t2/state.json                   |  5 +++--
 docs/developers/edge-adapters.md | 40 ++++++++++++++++++++++++++++++++++++++++
 3 files changed, 54 insertions(+), 2 deletions(-)

```
