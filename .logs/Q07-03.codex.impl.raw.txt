Status: DONE

Summary of changes:
- Updated database cleanup settings: safer defaults (`revisions_to_keep` now defaults to 5), clarified field descriptions, switched orphaned cleanup to `orphaned_cleanup_enabled`, and added stricter sanitization for `excluded_transient_prefixes` (`newline_list`, max 100). (`includes/Settings/Domain/DatabaseSettings.php`)
- Improved settings validation globally: integer inputs now clamp correctly (no more `-1` becoming `1`), added `newline_list` sanitizer, and migrated legacy `cleanup_orphaned_metadata` → `orphaned_cleanup_enabled`. (`includes/Settings/SettingsRegistry.php`)
- Aligned scheduled database cleanup behavior with settings: scheduled transients cleanup honors excluded prefixes; spam/trash cleanup honors retention days and per-type toggles; added auto-drafts cleanup (older than 7 days by default) and extended task schema for manual overrides. (`includes/Database/Tasks/DatabaseCleanupTask.php`)
- Added standalone coverage for the new sanitization + migration behavior and a missing stub used by the new sanitizer. (`tests/unit-standalone/Settings/SettingsRegistryTest.php`, `tests/bootstrap-standalone.php`)

How to verify:
- `npm run lint`
- `npm test`

Risks / follow-ups:
- Scheduled trash/spam cleanup now only runs when the corresponding retention days setting is `> 0`; if someone previously relied on “delete everything” behavior, they’ll need to set retention days or run manually.
- Auto-drafts cleanup uses a fixed 7-day threshold; consider making this configurable if needed.
- Integer sanitization behavior changed globally (negative/non-numeric now clamps to min/default instead of `absint` behavior); worth a quick spot-check of any settings that might have depended on the old behavior.

OpenAI Codex v0.86.0 (research preview)
--------
workdir: /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite
model: gpt-5.2
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: xhigh
reasoning summaries: auto
session id: 019bcaae-3d42-7d90-9d09-179746f4320d
--------
user
You are implementing task Q07-03 in this git repository.

1) Read the spec: .plans/Q07-03.md
2) Read handoff/context: .t2/handoff/Q07-03.md

Implement the spec fully.

Verification commands (run if non-empty):
- format: 
- lint: npm run lint
- test: npm test

In your final response, include:
- Status: DONE or NEEDS-REVIEW
- Summary of changes
- How to verify (exact commands)
- Risks / follow-ups

mcp startup: no servers
exec
/bin/zsh -lc ls in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 41ms:
ACCESSIBILITY.md
admin
assets
bin
BUILD.md
CHANGELOG.md
CODE_QUALITY.md
composer.json
composer.lock
docs
includes
index.php
jest.config.js
jest.setup.js
languages
node_modules
package-lock.json
package.json
PERFORMANCE.md
phpcs.xml
exec
/bin/zsh -lc "sed -n '1,200p' .plans/Q07-03.md" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 41ms:
# Q07-03 — Database Settings Domain Review

Review includes/Settings/Domain/DatabaseSettings.php for cleanup threshold settings, retention period configuration, and validation of user inputs.
exec
/bin/zsh -lc "sed -n '1,200p' .t2/handoff/Q07-03.md" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 43ms:
# Handoff: Q07-03

Created: 2026-01-17T06:39:35.204256Z

Spec: .plans/Q07-03.md

thinking
**Inspecting database settings**

I need to fully implement the minimal specs, particularly regarding the DatabaseSettings.php file. This involves reviewing elements like cleanup threshold settings, retention period configuration, and user input validation. So, I'll start by inspecting and opening the includes/Settings/Domain/DatabaseSettings.php file to see what improvements I need to make. It's crucial to ensure everything is set properly for optimal performance!
exec
/bin/zsh -lc "sed -n '1,200p' includes/Settings/Domain/DatabaseSettings.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 31ms:
<?php
/**
 * Database Settings
 *
 * Database cleanup settings.
 *
 * @package WPAdminHealth\Settings\Domain
 */

namespace WPAdminHealth\Settings\Domain;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

/**
 * Class DatabaseSettings
 *
 * Manages database cleanup settings.

thinking
**Reviewing settings fields**

I'm looking at the file that defines settings fields. The specifications mention a need to review cleanup threshold settings, retention period configuration, and validation of user inputs. The fields seem to have sanitize types and min/max values defined, but I'm wondering if those min/max restrictions are actually enforced. I need to check whether the AbstractDomainSettings class is doing that correctly. Let's delve into the AbstractDomainSettings.php file to inspect it further!
exec
/bin/zsh -lc "sed -n '1,200p' includes/Settings/Domain/AbstractDomainSettings.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 37ms:
<?php
/**
 * Abstract Domain Settings
 *
 * Base class for domain-specific settings.
 *
 * @package WPAdminHealth\Settings\Domain
 */

namespace WPAdminHealth\Settings\Domain;

use WPAdminHealth\Settings\Contracts\DomainSettingsInterface;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

/**
 * Class AbstractDomainSettings

thinking
**Exploring settings management**

I’m considering that the abstract class only holds settings and not sanitization, which means there should be a settings manager involved. It seems like I need to search within includes/Settings to understand how it registers fields with the WordPress settings API. There’s a lot to unpack here, and I want to make sure I grasp how everything connects in managing these settings. Let's dive deeper into includes/Settings!
exec
/bin/zsh -lc 'ls includes/Settings' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 34ms:
Contracts
Domain
SettingsRegistry.php
SettingsServiceProvider.php

thinking
**Exploring the code base**

I want to start by looking at SettingsRegistry.php because it might handle registration and data sanitization. This could be an essential part of the system, so I’ll pay close attention to detail while reviewing any functions or processes used within it. Understanding this could really clarify how the system manages user inputs and ensures security. Let’s see what we find!
exec
/bin/zsh -lc "sed -n '1,200p' includes/Settings/SettingsRegistry.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 32ms:
<?php
/**
 * Settings Registry
 *
 * Aggregates and manages all domain-specific settings.
 *
 * @package WPAdminHealth\Settings
 */

namespace WPAdminHealth\Settings;

use WPAdminHealth\Contracts\SettingsInterface;
use WPAdminHealth\Settings\Contracts\DomainSettingsInterface;
use WPAdminHealth\Settings\Contracts\SettingsRegistryInterface;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

exec
/bin/zsh -lc "sed -n '200,400p' includes/Settings/SettingsRegistry.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 32ms:
			$defaults = array_merge( $defaults, $domain->get_defaults() );
		}
		return $defaults;
	}

	/**
	 * Check if safe mode is enabled.
	 *
	 * @return bool True if safe mode is enabled.
	 */
	public function is_safe_mode_enabled(): bool {
		// Allow wp-config.php to force safe mode on/off.
		if ( defined( 'WPHA_SAFE_MODE' ) ) {
			return (bool) WPHA_SAFE_MODE;
		}

		return (bool) $this->get_setting( 'safe_mode', false );
	}

	/**
exec
/bin/zsh -lc "sed -n '400,800p' includes/Settings/SettingsRegistry.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 31ms:

		switch ( $sanitize ) {
			case 'boolean':
				$schema = array(
					'type'    => 'boolean',
					'default' => (bool) ( $field['default'] ?? false ),
				);
				break;

			case 'integer':
				$schema = array(
					'type'    => 'integer',
					'default' => absint( $field['default'] ?? 0 ),
				);
				if ( isset( $field['min'] ) ) {
					$schema['minimum'] = (int) $field['min'];
				}
				if ( isset( $field['max'] ) ) {
					$schema['maximum'] = (int) $field['max'];
				}


thinking
**Evaluating integer sanitization**

I'm thinking about how sanitization handles min/max enforcement for integers. It seems it uses absolute integers, which means negative values turn positive. For retention days, I’d want to allow 0 and positive numbers, but converting -1 to 1 feels wrong since it could misinterpret the user’s intent. Maybe I should treat negative values as 0 instead. For integer inputs, I might want to avoid using absolute integers and instead clamp them to the minimum. Also, there could be issues with text areas that aren't properly normalized.
thinking
**Checking database cleanup settings**

I need to look over the code for the database cleanup service. First, I should search for specific setting keys related to this. It sounds like using ripgrep would be a good choice for this task, as it's efficient for searching through code. I want to make sure I find everything relevant to ensure the cleanup process operates correctly. It’s important to be thorough with this to avoid any issues in the future!
exec
/bin/zsh -lc 'rg -n "revisions_to_keep|auto_clean_spam_days|auto_clean_trash_days|excluded_transient_prefixes|optimize_tables_weekly|orphaned_cleanup_enabled|cleanup_expired_transients" -S .' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 51ms:
./tests/IntegrationTest.php:149:		$settings['revisions_to_keep'] = 2;
./tests/IntegrationTest.php:270:		$settings['revisions_to_keep'] = 3;
./tests/IntegrationTest.php:276:		$this->assertEquals( 3, $updated_settings['revisions_to_keep'], 'Should keep 3 revisions' );
./tests/IntegrationTest.php:534:		$settings['revisions_to_keep'] = 2;
./tests/IntegrationTest.php:535:		$settings['cleanup_expired_transients'] = true;
./tests/IntegrationTest.php:597:		$settings['revisions_to_keep'] = 5;
./tests/IntegrationTest.php:607:		$this->assertNotEquals( $exported_settings['revisions_to_keep'], $default_settings['revisions_to_keep'] );
./tests/IntegrationTest.php:615:		$this->assertEquals( 5, $restored_settings['revisions_to_keep'], 'Settings should be restored' );
./tasks.csv:47:M06-03,"Database Cleanup Settings","Settings fields: revisions_to_keep (0-50), auto_clean_spam_days (0-365, 0=disabled), auto_clean_trash_days (0-365), excluded_transient_prefixes (textarea, one per line), optimize_tables_weekly (bool), orphaned_cleanup_enabled (bool). Acceptance: Settings properly control cleanup behavior, exclusion patterns work, auto-clean respects day settings."
./tests/factories/PostFactory.php:28:		add_filter( 'wp_revisions_to_keep', '__return_true' );
./tests/factories/PostFactory.php:39:		remove_filter( 'wp_revisions_to_keep', '__return_true' );
./includes/Settings/Domain/DatabaseSettings.php:83:			'cleanup_expired_transients'  => array(
./includes/Settings/Domain/DatabaseSettings.php:97:			'revisions_to_keep'           => array(
./includes/Settings/Domain/DatabaseSettings.php:107:			'auto_clean_spam_days'        => array(
./includes/Settings/Domain/DatabaseSettings.php:117:			'auto_clean_trash_days'       => array(
./includes/Settings/Domain/DatabaseSettings.php:127:			'excluded_transient_prefixes' => array(
./includes/Settings/Domain/DatabaseSettings.php:135:			'optimize_tables_weekly'      => array(
./includes/Settings/Domain/DatabaseSettings.php:143:			'orphaned_cleanup_enabled'    => array(
./includes/Database/Tasks/DatabaseCleanupTask.php:266:			if ( ! empty( $settings['optimize_tables_weekly'] ) || ! empty( $options['optimize_tables'] ) ) {
./includes/Database/Tasks/DatabaseCleanupTask.php:338:		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {

thinking
**Inspecting configurations**

I’m focusing on the DatabaseCleanupTask and REST controllers. It’s important to check for any mismatches with the settings. I’ll dive into the sections of the DatabaseCleanupTask that are relevant to this issue, making sure to note any discrepancies that could affect functionality. I want to ensure everything is properly aligned and functioning smoothly. Let’s get started on that!
exec
/bin/zsh -lc "sed -n '1,240p' includes/Database/Tasks/DatabaseCleanupTask.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 34ms:
<?php
/**
 * Database Cleanup Task
 *
 * Scheduled task for database maintenance operations.
 *
 * @package WPAdminHealth\Database\Tasks
 */

namespace WPAdminHealth\Database\Tasks;

use WPAdminHealth\Scheduler\AbstractScheduledTask;
use WPAdminHealth\Contracts\RevisionsManagerInterface;
use WPAdminHealth\Contracts\TransientsCleanerInterface;
use WPAdminHealth\Contracts\OrphanedCleanerInterface;
use WPAdminHealth\Contracts\TrashCleanerInterface;
use WPAdminHealth\Contracts\OptimizerInterface;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
exec
/bin/zsh -lc 'rg -n "function determine_cleanup_tasks" -n includes/Database/Tasks/DatabaseCleanupTask.php' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 38ms:
332:	private function determine_cleanup_tasks( array $settings, array $options ): array {
exec
/bin/zsh -lc "sed -n '320,420p' includes/Database/Tasks/DatabaseCleanupTask.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 39ms:
		return $result;
	}

	/**
	 * Determine which cleanup tasks to run based on settings and options.
	 *
	 * @since 1.5.0
	 *
	 * @param array $settings Plugin settings.
	 * @param array $options  Task options.
	 * @return array List of task identifiers.
	 */
	private function determine_cleanup_tasks( array $settings, array $options ): array {
		$cleanup_tasks = array();

		if ( ! empty( $settings['cleanup_revisions'] ) || ! empty( $options['clean_revisions'] ) ) {
			$cleanup_tasks[] = 'revisions';
		}
		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
			$cleanup_tasks[] = 'transients';
exec
/bin/zsh -lc "sed -n '240,360p' includes/Database/Tasks/DatabaseCleanupTask.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 39ms:

			if ( isset( $result['error'] ) ) {
				$subtask_errors[ $task ] = $result['error'];
				$this->log( sprintf( 'Subtask %s failed: %s', $task, $result['error'] ), 'error' );
			} else {
				$total_items += $result['items'];
				$total_bytes += $result['bytes'];
				$completed_tasks[] = $task;
			}

			/**
			 * Fires after a subtask is executed.
			 *
			 * @since 1.5.0
			 *
			 * @hook wpha_db_cleanup_after_subtask
			 *
			 * @param string $task    The subtask identifier.
			 * @param array  $result  The subtask result.
			 * @param array  $options Task options.

thinking
**Evaluating cleanup settings**

I'm looking into the `optimize_tables_weekly` function. It seems that `orphaned_cleanup_enabled` isn't being used here. Other settings like `cleanup_auto_drafts`, `cleanup_trashed_comments`, and `cleanup_spam_comments` don’t appear to be part of the `determine_cleanup_tasks`. Maybe each subtask processes them differently? I should check within `execute_subtask_with_recovery`. It might help to search for where `cleanup_auto_drafts` is being utilized and how these subtasks are structured.
exec
/bin/zsh -lc 'rg -n "cleanup_auto_drafts|cleanup_spam_comments|cleanup_trashed_comments|cleanup_trashed_posts" includes/Database/Tasks/DatabaseCleanupTask.php includes -S' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 45ms:
includes/Database/Tasks/DatabaseCleanupTask.php:344:		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
includes/Settings/Domain/DatabaseSettings.php:55:			'cleanup_auto_drafts'         => array(
includes/Settings/Domain/DatabaseSettings.php:62:			'cleanup_trashed_posts'       => array(
includes/Settings/Domain/DatabaseSettings.php:69:			'cleanup_spam_comments'       => array(
includes/Settings/Domain/DatabaseSettings.php:76:			'cleanup_trashed_comments'    => array(
includes/Database/Tasks/DatabaseCleanupTask.php:344:		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {

thinking
**Locating TrashCleaner implementations**

I’m looking into TrashCleaner to see if there are other instances. There’s the TrashCleanerInterface and its implementations. I’ll need to locate the includes/Database/Cleaners directory and search for classes that implement TrashCleaner. It seems like a straightforward task, but I want to ensure I’m thorough in my search to find all relevant implementations. I’ll take my time to get it right!
exec
/bin/zsh -lc 'rg -n "interface TrashCleanerInterface|class .*TrashCleaner" -S includes' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 41ms:
includes/Database/TrashCleaner.php:28:class TrashCleaner implements TrashCleanerInterface {
includes/Contracts/TrashCleanerInterface.php:25:interface TrashCleanerInterface {
exec
/bin/zsh -lc "sed -n '1,240p' includes/Database/TrashCleaner.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 41ms:
<?php
/**
 * Trash & Spam Cleaner Class
 *
 * Manages WordPress trashed posts and spam/trashed comments.
 * Provides methods to count, identify, and delete trashed content with age-based filtering.
 *
 * @package WPAdminHealth
 */

namespace WPAdminHealth\Database;

use WPAdminHealth\Contracts\TrashCleanerInterface;
use WPAdminHealth\Contracts\ConnectionInterface;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

exec
/bin/zsh -lc "sed -n '240,520p' includes/Database/TrashCleaner.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 43ms:

		// Build the query to get spam comments.
		$where_clauses = array( "comment_approved = 'spam'" );
		$prepare_args  = array();

		// Filter by age.
		if ( $older_than_days > 0 ) {
			$where_clauses[] = 'comment_date < %s';
			$date_threshold = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
			$prepare_args[] = $date_threshold;
		}

		$where_sql = implode( ' AND ', $where_clauses );

		if ( ! empty( $prepare_args ) ) {
			$query = $this->connection->prepare(
				"SELECT comment_ID FROM {$comments_table} WHERE {$where_sql} ORDER BY comment_ID ASC",
				...$prepare_args
			);


thinking
**Analyzing TrashCleaner features**

I'm examining the TrashCleaner’s age filter and noting how the settings for auto cleaning spam and trash may be utilized in REST controllers or possibly in scheduled tasks. I wonder if there's a dedicated scheduled task that uses these settings. It seems like the `determine_cleanup_tasks` only targets 'trash' with conditions around cleaned posts, but not spam or trash comments. Perhaps they have separate tasks for cleaning those. I'll have to look into the `execute_subtask` next.
exec
/bin/zsh -lc 'rg -n "trash_cleaner" includes/Database/Tasks/DatabaseCleanupTask.php' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 35ms:
120:	private TrashCleanerInterface $trash_cleaner;
149:	 * @param TrashCleanerInterface      $trash_cleaner      Trash cleaner.
156:		TrashCleanerInterface $trash_cleaner,
162:		$this->trash_cleaner      = $trash_cleaner;
561:				$cleaned = $this->trash_cleaner->empty_all_trash();
exec
/bin/zsh -lc "sed -n '500,640p' includes/Database/Tasks/DatabaseCleanupTask.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 38ms:
	 * @return bool True if there's saved progress to resume.
	 */
	public function has_pending_progress(): bool {
		$progress = get_option( self::PROGRESS_OPTION_KEY, array() );
		return ! empty( $progress );
	}

	/**
	 * Force clear any saved progress (useful for admin reset).
	 *
	 * @since 1.5.0
	 *
	 * @return bool True on success.
	 */
	public function reset_progress(): bool {
		$this->log( 'Progress manually reset' );
		return $this->clear_progress();
	}

	/**
exec
/bin/zsh -lc "rg -n \"delete_spam_comments\\(|delete_trashed_posts\\(|delete_trashed_comments\\(\" -S includes" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 51ms:
includes/REST/DatabaseController.php:671:		$result = $this->trash_cleaner->delete_spam_comments( $older_than_days );
includes/REST/DatabaseController.php:714:		$posts_result = $this->trash_cleaner->delete_trashed_posts( $post_types, $older_than_days );
includes/REST/DatabaseController.php:717:		$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
includes/REST/Database/CleanupController.php:637:		$result = $this->trash_cleaner->delete_spam_comments( $older_than_days );
includes/REST/Database/CleanupController.php:676:		$posts_result    = $this->trash_cleaner->delete_trashed_posts( $post_types, $older_than_days );
includes/REST/Database/CleanupController.php:677:		$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
includes/Database/TrashCleaner.php:156:	public function delete_trashed_posts( array $post_types = array(), int $older_than_days = 0 ): array {
includes/Database/TrashCleaner.php:238:	public function delete_spam_comments( int $older_than_days = 0 ): array {
includes/Database/TrashCleaner.php:312:	public function delete_trashed_comments( int $older_than_days = 0 ): array {
includes/Database/TrashCleaner.php:390:		$posts_result = $this->delete_trashed_posts( array(), 0 );
includes/Database/TrashCleaner.php:393:		$comments_result = $this->delete_trashed_comments( 0 );
includes/AI/OneClickFix.php:547:		$result = $this->trash_cleaner->delete_spam_comments( 30 );
includes/Contracts/TrashCleanerInterface.php:73:	public function delete_trashed_posts( array $post_types = array(), int $older_than_days = 0 ): array;
includes/Contracts/TrashCleanerInterface.php:83:	public function delete_spam_comments( int $older_than_days = 0 ): array;
includes/Contracts/TrashCleanerInterface.php:93:	public function delete_trashed_comments( int $older_than_days = 0 ): array;
exec
/bin/zsh -lc "sed -n '35,70p' tasks.csv" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 39ms:
M04-02,"Query Monitor Integration","Create /includes/performance/class-query-monitor.php. Methods: capture_slow_queries(threshold_ms), get_query_summary(), get_queries_by_caller(), export_query_log(). If Query Monitor plugin active, integrate with its data. Otherwise, implement basic monitoring: hook into 'query' filter, measure SAVEQUERIES if enabled. Identify: slow queries (>50ms), duplicate queries, queries without indexes (EXPLAIN). Log to custom table with TTL. Acceptance: Works standalone and enhanced with Query Monitor, identifies genuinely slow queries, logs are prunable."
M04-03,"Heartbeat API Controller","Create /includes/performance/class-heartbeat-controller.php. Methods: get_current_settings(), update_frequency(location, seconds), disable_heartbeat(location), enable_heartbeat(location). Locations: 'admin', 'post-editor', 'frontend'. Frequency options: 15s, 30s, 60s, 120s, disabled. Use wp_heartbeat_settings filter. Store settings in options. Provide presets: 'Default', 'Optimized', 'Minimal'. Show estimated CPU savings per preset. Acceptance: Heartbeat modifications work correctly, doesn't break autosave/post locking, presets provide reasonable defaults."
M04-04,"Admin Ajax Monitor","Create /includes/performance/class-ajax-monitor.php. Methods: log_ajax_request(), get_ajax_summary(period), get_frequent_ajax_actions(), get_slow_ajax_actions(). Hook into wp_ajax_* and track: action name, execution time, memory used, user role, timestamp. Aggregate: requests per minute, average response time, most frequent actions. Identify: excessive polling, slow endpoints, redundant requests. Store in custom table with daily cleanup. Acceptance: Captures all admin AJAX, aggregates meaningfully, identifies optimization opportunities."
M04-05,"Object Cache Status Checker","Create /includes/performance/class-cache-checker.php. Methods: get_cache_status(), test_cache_performance(), get_cache_recommendations(), is_persistent_cache_available(). Check for: Redis, Memcached, APCu, file-based cache, no cache. Performance test: set/get 100 items, measure time. Recommendations based on hosting environment detection. Report: cache type, hit rate (if available), recommendations. Acceptance: Correctly identifies cache backend, performance test is meaningful, recommendations are actionable per hosting type."
M04-06,"Autoload Options Analyzer","Create /includes/performance/class-autoload-analyzer.php. Methods: get_autoloaded_options(), get_autoload_size(), find_large_autoloads(threshold), recommend_autoload_changes(). Query options where autoload='yes'. Identify: very large autoloaded options (>10KB), likely candidates for non-autoload (infrequent settings). Calculate total autoload size. Provide: option name, size, source (core/plugin/theme), recommendation. Ability to change autoload status with confirmation. Acceptance: Accurately lists autoloaded options, size calculations correct, autoload changes apply properly."
M04-07,"Performance Dashboard Page","Create /templates/admin/performance.php with React app. Sections: Performance Score card (based on all factors), Plugin Impact ranking (sortable table), Query Analysis (slow queries, counts), Heartbeat Control panel, Object Cache status, Autoload Analysis. Plugin ranking: shows load time impact, memory, queries with bar visualizations. Heartbeat panel: toggle/slider controls per location. Quick recommendations sidebar with action buttons. Acceptance: All metrics display correctly, controls work, recommendations are contextual."
M04-08,"Performance REST Endpoints","Create /includes/rest/class-performance-controller.php. Endpoints: GET /wpha/v1/performance/stats (overview), GET /wpha/v1/performance/plugins (plugin rankings), GET /wpha/v1/performance/queries (query analysis), GET /wpha/v1/performance/heartbeat (current settings), POST /wpha/v1/performance/heartbeat (update settings), GET /wpha/v1/performance/cache (cache status), GET /wpha/v1/performance/autoload (autoload analysis), POST /wpha/v1/performance/autoload (change autoload). Acceptance: All endpoints return correct data, POST endpoints validate input, changes persist."
M05-01,"AI Recommendations Engine","Create /includes/ai/class-recommendations.php. Methods: generate_recommendations(), prioritize_issues(), get_actionable_steps(), dismiss_recommendation(id). Analyze all scan results and generate prioritized recommendations. Format: {id, priority (1-10), category, title, description, impact_estimate, action_type, action_params}. Categories: database, media, performance, security. Priority based on: impact (space/speed), ease of fix, risk level. Cache recommendations, regenerate on new scan. Acceptance: Recommendations are genuinely actionable, priorities make sense, dismissed items stay dismissed."
M05-02,"One-Click Fix System","Create /includes/ai/class-one-click-fix.php. Methods: get_safe_fixes(), execute_fix(recommendation_id), execute_all_safe(), get_fix_preview(recommendation_id). Safe fixes (auto-executable): clear expired transients, delete spam comments >30 days, clean post revisions keeping 3, optimize tables. Preview shows: what will be affected, estimated impact. Batch execution with progress tracking. All fixes logged to activity. Rollback info stored for 24 hours. Acceptance: Safe fixes never cause data loss, previews are accurate, execution is reliable with progress feedback."
M05-03,"Recommendations UI Component","Create /assets/js/components/Recommendations.jsx. Display: prioritized list with severity indicators (critical/warning/info), category icons, expandable details, action buttons. Actions: 'Fix Now' (executes immediately), 'Preview' (shows impact), 'Dismiss' (hides recommendation), 'Learn More' (external link). Filter by category. Sort by priority/category. Animate completion of fixes. Empty state when all addressed. Acceptance: List renders correctly, actions work, dismissed items persist in localStorage, animations are smooth."
M06-01,"Settings Page Framework","Create /includes/class-settings.php using WordPress Settings API. Sections: General, Database Cleanup, Media Audit, Performance, Scheduling, Advanced. Register settings with register_setting(), add_settings_section(), add_settings_field(). Sanitization callbacks for each field type. Default values in activation. Export/import settings as JSON. Reset to defaults option. Acceptance: All settings save correctly, sanitization prevents invalid data, export/import works, reset works."
M06-02,"General Settings Section","Settings fields: health_score_cache_duration (1-24 hours), dashboard_widget_enabled (bool), admin_bar_menu (bool), notification_email (email), enable_logging (bool), log_retention_days (7-90), delete_data_on_uninstall (bool). Validation: email format check, numeric range validation. Acceptance: All fields render correctly, validation works, settings take effect immediately."
M06-03,"Database Cleanup Settings","Settings fields: revisions_to_keep (0-50), auto_clean_spam_days (0-365, 0=disabled), auto_clean_trash_days (0-365), excluded_transient_prefixes (textarea, one per line), optimize_tables_weekly (bool), orphaned_cleanup_enabled (bool). Acceptance: Settings properly control cleanup behavior, exclusion patterns work, auto-clean respects day settings."
M06-04,"Media Audit Settings","Settings fields: unused_media_scan_depth (posts only, all content, deep scan), large_file_threshold_kb (100-5000), duplicate_detection_method (hash, filename, both), excluded_media_ids (comma-separated), media_trash_retention_days (7-90), scan_acf_fields (bool), scan_elementor (bool), scan_woocommerce (bool). Acceptance: Scan depth affects what's checked, thresholds work correctly, builder integrations toggle properly."
M06-05,"Performance Settings Section","Settings fields: heartbeat_admin_frequency (15-120), heartbeat_editor_frequency (15-120), heartbeat_frontend (enabled/disabled), query_logging_enabled (bool), slow_query_threshold_ms (10-500), plugin_profiling_enabled (bool). Acceptance: Heartbeat settings apply correctly, query logging togglable, thresholds affect what's flagged."
M06-06,"Scheduling Settings Section","Settings fields: scheduler_enabled (bool), database_cleanup_frequency (daily/weekly/monthly/disabled), media_scan_frequency (weekly/monthly/disabled), performance_check_frequency (daily/weekly), preferred_time (hour selector 0-23), notification_on_completion (bool). Create/update Action Scheduler tasks when saved. Acceptance: Schedules create correctly, time preference respected, notifications send on completion."
M06-07,"Advanced Settings Section","Settings fields: enable_rest_api (bool), rest_api_rate_limit (10-120 per minute), debug_mode (bool), custom_css (textarea for admin customization), safe_mode (disables destructive operations). Safe mode: all delete/clean endpoints return preview only. Debug mode: extra logging, visible query times. Acceptance: Safe mode truly prevents data modification, debug mode provides useful info, custom CSS applies."
M06-08,"Settings Admin Page","Create /templates/admin/settings.php. Tabbed interface matching WP settings pages style. Each section as tab. Save button per tab or unified save. Success/error notices on save. Settings export/import in Advanced tab with file upload. Reset section per tab. Preview of scheduled tasks showing next run times. Acceptance: Tabs work correctly, save provides feedback, export creates valid JSON, import validates and applies."
M07-01,"Admin Styles - Core","Create /assets/css/admin.css. Design system: use WP admin colors via CSS variables (--wp-admin-theme-color), 8px grid spacing, consistent border-radius (4px), shadow levels (sm, md, lg). Component styles: cards, buttons, form elements, tables, modals, toasts, progress bars. Responsive: stack on <782px. Dark mode support via prefers-color-scheme. Scope all styles to .wpha-wrap to prevent conflicts. Acceptance: Consistent with WP admin aesthetic, responsive, no style conflicts with other plugins."
M07-02,"Admin Styles - Dashboard","Create /assets/css/dashboard.css. Health score circle: 200px diameter, thick stroke, gradient fill option. Metric cards: icon + content layout, hover lift effect, trend indicators. Activity timeline: vertical line connector, icon circles, timestamp styling. Quick actions: icon grid layout, hover states. Loading skeletons: animated shimmer effect. Acceptance: Dashboard looks polished and professional, animations are performant, matches mockup specifications."
exec
/bin/zsh -lc 'rg -n "M06-03" tasks.csv' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 36ms:
47:M06-03,"Database Cleanup Settings","Settings fields: revisions_to_keep (0-50), auto_clean_spam_days (0-365, 0=disabled), auto_clean_trash_days (0-365), excluded_transient_prefixes (textarea, one per line), optimize_tables_weekly (bool), orphaned_cleanup_enabled (bool). Acceptance: Settings properly control cleanup behavior, exclusion patterns work, auto-clean respects day settings."
exec
/bin/zsh -lc "sed -n '520,760p' includes/REST/DatabaseController.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 43ms:
		if ( empty( $results ) ) {
			return $this->format_error_response(
				new WP_Error(
					'optimization_failed',
					__( 'No tables were optimized. Please check the table names.', 'wp-admin-health-suite' )
				),
				400
			);
		}

		// Calculate total bytes freed.
		$total_bytes_freed = 0;
		foreach ( $results as $result ) {
			$total_bytes_freed += isset( $result['size_reduced'] ) ? $result['size_reduced'] : 0;
		}

		// Log to activity.
		$this->log_activity(
			'optimization',
			array(

thinking
**Exploring review tasks**

I’m thinking that Q07-03 might be connected to review tasks, possibly indicating that there are code issues flagged by static analysis. To clarify, I should take a look at review_tasks.csv to see if it includes Q07-03. I’ll open the file and check around the Q07-03 entries to gather more information. This should help me understand if there's anything I need to address.
exec
/bin/zsh -lc "rg -n \"Q07-03\" review_tasks.csv && sed -n '1,120p' review_tasks.csv" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 50ms:
42:Q07-03,"Database Settings Domain Review","Review includes/Settings/Domain/DatabaseSettings.php for cleanup threshold settings, retention period configuration, and validation of user inputs."
id,title,spec
Q01-01,"Core Plugin Architecture Review","Review includes/Plugin.php for singleton pattern correctness, DI container initialization, hook registration order, and plugin lifecycle management (activation/deactivation). Check for memory leaks, proper dependency resolution, and WordPress best practices compliance."
Q01-02,"Dependency Injection Container Review","Review includes/Container/Container.php and ServiceProvider.php for proper service registration, singleton vs factory behavior, circular dependency handling, and lazy loading of services. Verify interface binding and resolution logic."
Q01-03,"Service Provider Registration Review","Review all files in includes/Providers/ (CoreServiceProvider, DatabaseServiceProvider, MediaServiceProvider, PerformanceServiceProvider, AIServiceProvider, RESTServiceProvider, SchedulerServiceProvider) for proper service binding, dependency ordering, and initialization logic."
Q01-04,"Autoloader and Namespace Review","Review includes/autoload.php for PSR-4 compliance, proper namespace mapping, error handling for missing classes, and performance of class loading. Verify all classes are properly namespaced."
Q01-05,"Contracts and Interfaces Review","Review all interfaces in includes/Contracts/ for proper abstraction, method signatures, return type declarations, and documentation. Ensure interfaces follow ISP (Interface Segregation Principle)."
Q02-01,"Database Analyzer Review","Review includes/database/Analyzer.php for SQL query safety, accurate size calculations, proper caching strategy (5-min TTL), and handling of large databases. Check for N+1 queries and proper use of $wpdb->prepare()."
Q02-02,"Database Revisions Manager Review","Review includes/database/RevisionsManager.php for safe revision deletion logic, configurable retention, proper batch processing, and recovery mechanisms. Verify it doesn't delete revisions of unpublished posts incorrectly."
Q02-03,"Database Transients Cleaner Review","Review includes/database/TransientsCleaner.php for proper expired transient detection, handling of site transients vs regular transients, and multisite compatibility. Check for race conditions during cleanup."
Q02-04,"Database Trash Cleaner Review","Review includes/database/TrashCleaner.php for safe trash/spam post deletion, proper handling of scheduled posts, attachment cleanup, and comment spam removal. Verify no accidental deletion of valid content."
Q02-05,"Database Orphaned Cleaner Review","Review includes/database/OrphanedCleaner.php for accurate orphaned metadata detection (postmeta, usermeta, commentmeta), safe cleanup logic, and handling of multisite metadata. Check for false positives."
Q02-06,"Database Optimizer Review","Review includes/database/Optimizer.php for safe table optimization operations, InnoDB vs MyISAM handling, table locking implications, and progress reporting. Verify it handles large tables gracefully."
Q02-07,"Database Orphaned Tables Review","Review includes/database/OrphanedTables.php for accurate detection of tables from deactivated plugins, safe deletion safeguards, and handling of shared tables. Check false positive prevention."
Q02-08,"Database Connection Wrapper Review","Review includes/database/WpdbConnection.php for proper $wpdb wrapping, error handling, query logging, and connection state management. Verify it properly handles reconnection scenarios."
Q02-09,"Database Cleanup Task Review","Review includes/database/Tasks/DatabaseCleanupTask.php for proper WP-Cron integration, batch processing, error recovery, and progress tracking. Check for timeout handling on long-running cleanups."
Q03-01,"Media Scanner Review","Review includes/media/Scanner.php for efficient media library scanning, proper detection of unused/duplicate/large files, batch processing with generators, and memory management for large libraries."
Q03-02,"Media Duplicate Detector Review","Review includes/media/DuplicateDetector.php for accurate duplicate detection algorithm (hash-based vs content-based), handling of different image sizes, and performance with large media libraries."
Q03-03,"Media Large Files Review","Review includes/media/LargeFiles.php for configurable threshold detection, proper size calculation, handling of different file types, and integration with optimization recommendations."
Q03-04,"Media Alt Text Checker Review","Review includes/media/AltTextChecker.php for accurate detection of missing alt text, handling of decorative images, multilingual support (WPML/Polylang), and accessibility compliance reporting."

thinking
**Exploring review tasks**

I'm thinking of review tasks similar to code review improvements. I need to focus on Q07-03, which falls under the settings domain. There could be other related tasks in Q07 too. My next step will be to examine the review_tasks.csv file specifically for Q07 tasks. So, I'll set out to search for Q07 within that file to find all relevant tasks.
exec
/bin/zsh -lc 'rg -n "''^Q07" review_tasks.csv' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 49ms:
40:Q07-01,"Settings Registry Review","Review includes/Settings/SettingsRegistry.php for central settings management, schema definition, validation logic, and WordPress options API integration."
41:Q07-02,"Core Settings Domain Review","Review includes/Settings/Domain/CoreSettings.php for core plugin settings definition, safe mode implementation, debug mode handling, and feature toggles."
42:Q07-03,"Database Settings Domain Review","Review includes/Settings/Domain/DatabaseSettings.php for cleanup threshold settings, retention period configuration, and validation of user inputs."
43:Q07-04,"Media Settings Domain Review","Review includes/Settings/Domain/MediaSettings.php for exclusion pattern settings, delete confirmation requirements, and safe defaults."
44:Q07-05,"Performance Settings Domain Review","Review includes/Settings/Domain/PerformanceSettings.php for heartbeat control settings, AJAX limits, and monitoring configuration options."
45:Q07-06,"Scheduling Settings Domain Review","Review includes/Settings/Domain/SchedulingSettings.php for cron schedule configuration, task enablement settings, and timezone handling."
46:Q07-07,"Advanced Settings Domain Review","Review includes/Settings/Domain/AdvancedSettings.php for REST API settings, rate limiting configuration, custom CSS handling, and export/import functionality."

thinking
**Inspecting settings domains**

It looks like Q07 tasks are connected to settings domains. Q07-03 probably wants improvements similar to those made in Q07-01. I think I need to look into CoreSettings to see if anything has changed or needs adjustment. Following those patterns seems key, so I'll definitely inspect the CoreSettings domain file to get a better understanding of what improvements might be necessary. Let's make sure everything aligns correctly!
exec
/bin/zsh -lc "sed -n '1,220p' includes/Settings/Domain/CoreSettings.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 51ms:
<?php
/**
 * Core Settings
 *
 * General plugin settings.
 *
 * @package WPAdminHealth\Settings\Domain
 */

namespace WPAdminHealth\Settings\Domain;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

/**
 * Class CoreSettings
 *
 * Manages general plugin settings.





thinking
**Reviewing database settings**

I'm thinking about ensuring that the database settings, like the min/max values in the Q07-03 settings file, are clear and have safe defaults. Right now, some checkbox fields appear to lack descriptions, and there are also duplicates. The spec mentions the retention period, so I might need to align the min/max default for trash cleanup with WordPress, possibly setting it to 30 days. I’ll also check how the UI handles these settings by inspecting templates and settings files to ensure everything is sanitized correctly.
thinking
**Examining sanitization functions**

I'm digging into how WordPress handles sanitization, especially with the `sanitize_textarea_field` function. It seems like it ultimately uses `sanitize_text_field`, which strips out newlines by converting them to spaces. I think I need to confirm my understanding, as it looks like `sanitize_textarea_field` is supposed to preserve newlines while also removing unwanted tags. I want to make sure that when we're sanitizing text, we respect the "one per line" format, so I need to verify how these functions are interacting.
thinking
**Clarifying sanitization practices**

I’m reviewing how WordPress sanitizes text, particularly with `sanitize_textarea_field`. It appears that this function uses `sanitize_text_field`, but since version 4.7.0, there might be a filter included. The key point I’m focusing on is whether `sanitize_textarea_field` preserves newlines, since it’s specifically meant for text areas. I feel a bit confused about the specifics and can't access the definitions directly, so I want to recall details about how these functions work from memory to ensure accuracy.
thinking
**Confirming handling of newlines**

I think I've figured it out! From memory, I see that the `sanitize_text_field` function uses a regex pattern that replaces newlines and converts whitespace sequences into single spaces. However, when it comes to `sanitize_textarea_field`, it seems to preserve newlines because it excludes `\n` in its regex. It collapses carriage returns and tabs but maintains those crucial newlines, which is important for text area inputs. This makes sense, considering what these functions are designed to do!
thinking
**Analyzing newline handling and transient safety**

It looks like `sanitize_textarea_field` collapses carriage returns (`\r`) into spaces, which would keep newlines intact, but could potentially lead to lines that start with spaces. Trimming those lines should clean things up nicely. However, I need to consider that `wp_strip_all_tags` doesn’t remove newlines, so this approach seems compatible. I'm thinking about how user input validation should be tailored for text areas and ensuring that transient names are safe by restricting characters. I’ll need to review the `TransientsCleaner` for more insights into how patterns are managed!
exec
/bin/zsh -lc "sed -n '1,260p' includes/Database/TransientsCleaner.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 40ms:
<?php
/**
 * Transients Cleaner Class
 *
 * Manages WordPress transients including analysis, deletion, and cleanup operations.
 * Handles both options table transients and external object cache.
 *
 * @package WPAdminHealth
 */

namespace WPAdminHealth\Database;

use WPAdminHealth\Contracts\TransientsCleanerInterface;
use WPAdminHealth\Contracts\ConnectionInterface;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

exec
/bin/zsh -lc 'rg -n "should_exclude_transient" -n includes/Database/TransientsCleaner.php' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 39ms:
245:				if ( $this->should_exclude_transient( $extracted['name'], $exclude_patterns ) ) {
277:					if ( $this->should_exclude_transient( $extracted['name'], $exclude_patterns ) ) {
306:					if ( $this->should_exclude_transient( $extracted['name'], $exclude_patterns ) ) {
505:				if ( $this->should_exclude_transient( $extracted['name'], $exclude_patterns ) ) {
534:					if ( $this->should_exclude_transient( $extracted['name'], $exclude_patterns ) ) {
560:					if ( $this->should_exclude_transient( $extracted['name'], $exclude_patterns ) ) {
789:	private function should_exclude_transient( $transient_name, $exclude_patterns = array() ) {
exec
/bin/zsh -lc "sed -n '760,860p' includes/Database/TransientsCleaner.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 40ms:

			$query = $this->connection->prepare(
				"SELECT option_value FROM {$options_table}
				WHERE option_name = %s
				LIMIT 1",
				$timeout_key
			);
		}

		if ( null === $query ) {
			return null;
		}

		$timeout = $this->connection->get_var( $query );

		if ( null === $timeout || '' === $timeout ) {
			return null;
		}

		return gmdate( 'Y-m-d H:i:s', (int) $timeout );
exec
/bin/zsh -lc "sed -n '1,260p' includes/Database/RevisionsManager.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 46ms:
<?php
/**
 * Revisions Manager Class
 *
 * Manages WordPress post revisions including analysis, deletion, and cleanup operations.
 *
 * @package WPAdminHealth
 */

namespace WPAdminHealth\Database;

use WPAdminHealth\Contracts\RevisionsManagerInterface;
use WPAdminHealth\Contracts\ConnectionInterface;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

/**

thinking
**Considering database settings**

I think "threshold settings" could refer to revision limits. My focus should be on the DatabaseSettings domain, where I can possibly enhance definitions to incorporate safe defaults and stricter validation. It’s important to check if there are settings like "orphaned_cleanup_enabled" that are used in scheduled tasks, though I'm unsure if that's always the case. I'll need to search for how "orphaned_cleanup_enabled" is utilized.
exec
/bin/zsh -lc 'rg -n "orphaned_cleanup_enabled" -S includes' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 52ms:
includes/Settings/Domain/DatabaseSettings.php:143:			'orphaned_cleanup_enabled'    => array(

thinking
**Evaluating settings for cleanup**

I'm noticing a potential issue with leftover settings that don't seem necessary anymore. It looks like there's a setting for orphaned cleanup that has been replaced by another one, leading to confusion. I should consider removing the unused setting or aligning them to avoid misleading the UI. There are also other fields like cleanup_spam_comments and cleanup_trashed_comments that I need to verify if they're actually being used. I’ll search for the cleanup_spam_comments field to check its status.
exec
/bin/zsh -lc 'rg -n "cleanup_spam_comments|cleanup_trashed_comments|cleanup_auto_drafts" -S includes' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 46ms:
includes/Settings/Domain/DatabaseSettings.php:55:			'cleanup_auto_drafts'         => array(
includes/Settings/Domain/DatabaseSettings.php:69:			'cleanup_spam_comments'       => array(
includes/Settings/Domain/DatabaseSettings.php:76:			'cleanup_trashed_comments'    => array(




thinking
**Reviewing cleanup settings**

I'm looking into the cleanup settings, and it strikes me as unusual that many toggles remain unused. The determine_cleanup_tasks function only relies on cleanup_trashed_posts, which means the scheduled cleanup just deletes trash posts and comments if that’s enabled. There's a distinction between spam comments and trashed comments, but those toggles aren't utilized. I wonder if the plugin has manual cleanup actions linked to those toggles since the DatabaseController includes functions like clean_spam and clean_trash. Now, I should check those endpoints to gather more details.
thinking
**Examining database cleanup configuration**

I see there’s a Domain section for 'database_cleanup,' likely meant for configuring scheduled tasks on what to clean automatically, but it seems that's not yet implemented. For Q07-03, it looks like I need to align the scheduled database cleanup with the provided toggles and retention settings. Although the spec refers primarily to the DatabaseSettings domain file, implementing it fully might mean integrating those settings into the cleanup task. I'll also need to review DatabaseCleanupTask for any relevant earlier tasks and ensure the code changes reflect the review, rather than just comments.
thinking
**Aligning cleanup settings with implementation**

I think the next step should be to make sure the cleanup settings actually match the intended behavior. For the scheduled tasks, implementing the toggles and retention periods could require adjustments beyond just the settings file. To truly make these settings meaningful, I might need to modify both the scheduled cleanup logic and the REST controllers. 

Since the task is about "implementing the spec fully,” I’ll focus on improvements like cleanup threshold settings and retention configurations alongside input validation. The review tasks suggest I may need to modify existing code to align with best practices, particularly concerning the features like numeric boundaries and sanitizing input for revisions.
thinking
**Validating retention and input handling**

I see that there are already min/max values in place, but I need to ensure the retention days are validated according to those limits and properly applied to scheduled cleanup tasks. Also, the text area input for excluded transient prefixes needs to be validated line-by-line, checking for safe patterns. The SettingsRegistry uses sanitize_textarea_field, which may not keep multi-line inputs intact. 

I might require a custom sanitization type, like 'newline_list' or 'text_lines,' to handle a list of lines effectively. The spec emphasizes validating user inputs to avoid control characters and duplicates. Implementing a custom sanitize function could allow for parsing and storing as an array instead of a string. However, changing the field to 'excluded_transient_prefixes' as an array might disrupt the existing structure and UI, but it could be feasible if adequately sanitized. I'll also look at MediaSettings for any similar patterns.
exec
/bin/zsh -lc "sed -n '1,240p' includes/Settings/Domain/MediaSettings.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 43ms:
<?php
/**
 * Media Settings
 *
 * Media audit settings.
 *
 * @package WPAdminHealth\Settings\Domain
 */

namespace WPAdminHealth\Settings\Domain;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

/**
 * Class MediaSettings
 *
 * Manages media audit settings.
exec
/bin/zsh -lc 'rg -n "database_cleanup" -S templates admin includes/assets | head' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 64ms:
rg: includes/assets: No such file or directory (os error 2)
templates/admin/settings.php:199:					'wpha_database_cleanup'   => __( 'Database Cleanup', 'wp-admin-health-suite' ),
templates/admin/settings.php:221:							if ( 'wpha_database_cleanup' === $hook ) {
templates/admin/settings.php:222:								$frequency_key = 'database_cleanup_frequency';
exec
/bin/zsh -lc "sed -n '1,320p' templates/admin/settings.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 46ms:
<?php
/**
 * Settings Template
 *
 * @package WPAdminHealth
 */

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

// Get settings instance.
$settings_obj = new \WPAdminHealth\Settings();
$sections     = $settings_obj->get_sections();
$settings     = $settings_obj->get_settings();

// Get current tab.
$current_tab = isset( $_GET['tab'] ) ? sanitize_key( $_GET['tab'] ) : 'general';


thinking
**Checking settings template**

I'm thinking about the settings template and wondering if it uses \WPAdminHealth\Settings() as an older wrapper instead of SettingsRegistry. I need to dig into includes/Settings.php to clarify that. I'll search through the files to figure this out. It's essential to ensure I'm looking at the correct structure and updating my approach if necessary. Let's get to searching and see what I find!
exec
/bin/zsh -lc "ls includes | rg -n \"Settings\\.php\" || true" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 49ms:
26:Settings.php
exec
/bin/zsh -lc "sed -n '1,260p' includes/Settings.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 39ms:
<?php
/**
 * Settings Facade
 *
 * Backward-compatible wrapper used by legacy templates.
 *
 * @package WPAdminHealth
 */

namespace WPAdminHealth;

use WPAdminHealth\Contracts\SettingsInterface;
use WPAdminHealth\Settings\SettingsRegistry;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

/**

thinking
**Examining UI settings**

I’m thinking about the settings in the UI and how they relate to the SettingsInterface and SettingsRegistry. The domain field definitions play a significant role in UI rendering, so any modifications will be visible there. Also, I notice the sanitization process defined in SettingsRegistry to ensure values meet specific criteria. Now, even though DatabaseSettings defines fields, those don’t come into play if keys are removed. I want to inspect the Scheduling settings domain next to see what patterns emerge around retention or thresholds.
exec
/bin/zsh -lc "sed -n '1,260p' includes/Settings/Domain/SchedulingSettings.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 52ms:
<?php
/**
 * Scheduling Settings
 *
 * Task scheduling settings.
 *
 * @package WPAdminHealth\Settings\Domain
 */

namespace WPAdminHealth\Settings\Domain;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

/**
 * Class SchedulingSettings
 *
 * Manages task scheduling settings.

thinking
**Clarifying cleanup tasks**

I'm thinking about cleaning up revisions, transients, orphaned metadata, and trash items. The instructions don't mention spam separately, but trash items would include already trashed posts and comments, while spam comments are excluded. Auto drafts also seem to be outside this scope. However, I see DatabaseSettings has options for cleanup on spam comments and auto drafts, which makes me wonder if they should be included. I’ll search the scheduler tasks for any references to spam or auto drafts.
exec
/bin/zsh -lc 'rg -n "auto[-_]?draft" includes/Database/Tasks -S' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite exited 1 in 49ms:






thinking
**Examining parameter validation**

I might need to look into options for parameter validation in the CleanupController.php file, though that could be out-of-scope. The spec does mention "validation of user inputs," which could apply to REST inputs or specifically user input in the WP admin. The domain field definitions suggest enhancing sanitize types, maybe like 'integer.' 

I noticed there could be missing sanitization, especially for checkboxes and the textarea for excluded_transient_prefixes. I should also check for minimum and maximum values for certain numbers. Lastly, I'll look into other tasks, particularly Q07-02 and Q07-03, to see how they handle similar adjustments.
thinking
**Reviewing threshold and retention settings**

The spec mentions threshold and retention settings, which are already implemented, but they might have incorrect min/max values or be mislabeled. For example, 'revisions_to_keep' correctly indicates that the range is "0-50." However, 'auto_clean_spam_days' and 'auto_clean_trash_days' both appear to be set correctly at 0-365.

But I think the "cleanup threshold settings" should also apply to auto-drafts cleaning, which may need a threshold of over seven days. Currently, there's a toggle for cleanup_auto_drafts but no days threshold. Spam and trash comments have toggles, too, but these might need to be linked to retention settings instead. If auto_clean_spam_days is greater than 0, then the spam should be cleaned automatically; otherwise, it should be disabled.
thinking
**Streamlining settings**

It looks like the current setup has a mix of toggles and day settings, which seems redundant. The spec might suggest using the day settings as retention periods without needing additional checkboxes. Therefore, we might consider removing toggles for cleanup_spam_comments and cleanup_trashed_posts.

Right now, the settings include several toggles alongside threshold and retention parameters that could complicate things. For instance, cleanup_auto_drafts has a toggle but no days set for thresholds, which means it would clean all auto-drafts if enabled without any age requirement. Additionally, there's an orphaned_cleanup_enabled setting that feels like it could be redundant.
thinking
**Considering auto drafts and settings**

I’m thinking that while it might be helpful to remove auto drafts, regenerating them later can be done if needed. These toggles seem designed for manual cleanup rather than scheduled tasks, but since they appear on the "Database Cleanup" settings page and are meant to be part of scheduled tasks, that could be misleading.

If users enable the cleanup_spam_comments toggle expecting it to work automatically, but it doesn't, then that’s a bug. To implement the "Database Settings Domain Review," I’ll likely need to match the settings with actual features and adjust the default values to be more user-friendly. This might involve either removing or deprecating unused settings, but removing them could disrupt user expectations. Maybe a migration approach that ignores unknown keys could work, as the SettingsRegistry already handles those cases.
thinking
**Evaluating user experience and implementation**

I'm considering that while removing unused settings might be fine, it could degrade user experience if they suddenly disappear. The specification may not want any removals, suggesting it might be better to implement those settings instead. 

To do this, I could modify DatabaseCleanupTask to address auto drafts, spam comments, and trashed comments while using retention day thresholds. This would make the settings more meaningful, but it would require creating additional methods to clean auto drafts. Currently, the TrashCleaner handles trashed posts and spam comments but not auto drafts, so I need to search for existing methods related to cleaning them. I'll look for "auto-draft" in the project.
exec
/bin/zsh -lc 'rg -n "auto-draft|auto_draft" -S includes' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 64ms:
includes/Media/ReferenceFinder.php:164:			WHERE post_status NOT IN ('trash', 'auto-draft')
includes/HealthCalculator.php:324:		// Count auto-draft posts.
includes/HealthCalculator.php:325:		$auto_drafts = $this->connection->get_var(
includes/HealthCalculator.php:326:			"SELECT COUNT(*) FROM {$posts_table} WHERE post_status = 'auto-draft'"
includes/HealthCalculator.php:328:		if ( $auto_drafts > 20 ) {
includes/HealthCalculator.php:329:			$score -= min( 15, ( $auto_drafts - 20 ) / 5 );
includes/HealthCalculator.php:446:			AND post_status NOT IN ('trash', 'auto-draft')"
includes/Media/Scanner.php:562:			WHERE post_status NOT IN ('trash', 'auto-draft')
includes/Media/Scanner.php:1014:				WHERE post_status NOT IN ('trash', 'auto-draft')
includes/Contracts/AnalyzerInterface.php:86:	 * Get the count of auto-draft posts.
includes/Contracts/AnalyzerInterface.php:90:	 * @return int Number of auto-draft posts.
includes/Contracts/AnalyzerInterface.php:92:	public function get_auto_drafts_count(): int;
includes/Integrations/Acf.php:274:				WHERE p.post_status NOT IN ('trash', 'auto-draft')
includes/Integrations/Acf.php:295:				WHERE p.post_status NOT IN ('trash', 'auto-draft')
includes/Integrations/Acf.php:317:				WHERE p.post_status NOT IN ('trash', 'auto-draft')
includes/Integrations/Acf.php:532:				AND p.post_status NOT IN ('trash', 'auto-draft')
includes/Integrations/Acf.php:559:				AND p.post_status NOT IN ('trash', 'auto-draft')",
includes/Integrations/Acf.php:642:					WHERE p.post_status NOT IN ('trash', 'auto-draft')
includes/Integrations/Acf.php:702:				WHERE p.post_status NOT IN ('trash', 'auto-draft')
includes/Integrations/Elementor.php:346:			AND p.post_status NOT IN ('trash', 'auto-draft')

thinking
**Inspecting DashboardController**

I need to focus on the DashboardController and the delete_auto_drafts action. It's essential to see how this action is implemented, what settings are involved, and the overall structure. It's all about ensuring that I understand the code behind the deletion of auto drafts. By inspecting this action, I can get clarity on its functionality and any potential implications. Let’s dig into the details and see what I find!
exec
/bin/zsh -lc "sed -n '440,580p' includes/REST/DashboardController.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 35ms:
				'action_id'     => $action_id,
				'items_cleaned' => $result['items_cleaned'],
				'bytes_freed'   => $result['bytes_freed'],
				'log_id'        => $log_id,
				'logged'        => $logged,
			),
			$message
		);
	}

	/**
	 * Execute action based on action ID.
	 *
	 * @since 1.0.0
	 * @since 1.3.0 Uses ConnectionInterface instead of global $wpdb.
	 *
	 * @param string $action_id The action ID to execute.
	 * @return array|WP_Error Result array or WP_Error on failure.
	 */
	private function execute_action( $action_id ) {






thinking
**Considering cleanup tasks**

I’m thinking about how DatabaseSettings could relate to scheduled cleanup tasks and Dashboard quick actions. If cleanup_auto_drafts is enabled, I could include an auto drafts subtask. Similarly, if cleanup_spam_comments is on, then I’d include a spam subtask. I’m also wondering whether to separate tasks like 'trash_posts' and 'trash_comments,' or combine them instead. The spec emphasizes "cleanup threshold settings" which suggests limiting deletions per run, even if the scheduled task tracks time and progress. I might need to focus more on validating these settings than implementing new tasks.
thinking
**Reviewing settings and validation**

I'm focusing on the "cleanup threshold settings" and "retention period configuration" mentioned in the spec. While these settings exist, it’s important to ensure they’re used in tasks. I'll validate user inputs too, making sure numbers are within range and that newline lists are sanitized and unique. For the SettingsRegistry, it uses absint for integers but doesn’t check options for certain fields. Also, some checkboxes should default to false for safety. Lastly, I think cleanup frequency and scheduling setup need to be considered, with weekly defaults for cleanup.
thinking
**Analyzing database cleanup settings**

I've noticed that the default setting for database cleanup domain toggles is generally set to false, with an exception for cleanup_expired_transients which defaults to true. This means that expired transients will be cleaned weekly, which seems safe. However, if users enable cleanup_revisions while revision_to_keep defaults to 0, they'll delete all revisions, which could be too harsh. I should consider changing revision_to_keep to a safe default, like 5. Also, maybe retention for spam and trash should default to 30 days, allowing for more thoughtful management. Integrating auto_clean_trash_days might also help minimize risk.
thinking
**Modifying database cleanup logic**

I’m considering changes to the DatabaseCleanupTask, especially with the trash subtask needing to respect settings for posts, comments, spam, and retention days. Currently, scheduled tasks run weekly and don't differentiate; they empty everything, which could be risky. Users might want to auto-delete trash older than a certain number of days, and without checks, that's problematic. If auto_clean_trash_days is set to 0, perhaps the task shouldn't do anything, aligning retention settings with deletion logic. However, cleanup_trashed_posts might prompt a trash emptying regardless of age, complicating things further.
thinking
**Refining cleanup tasks and settings**

I want to refine the DatabaseCleanupTask to ensure it respects settings for trash, spam, and auto drafts appropriately. The scheduled tasks should delete only those items older than specified days, and a setting of 0 should disable deletion. I think the checkbox for cleanup_trashed_posts may need reworking to clarify its purpose. 

For spam cleanup, I want to make sure it triggers appropriately based on settings. I might consider changing how we handle auto drafts, potentially setting it to delete drafts older than 7 days. Unused fields could be removed, focusing only on the necessary ones for cleanup logic. I’m thinking we can implement specific subtasks for spams and trashed posts to ensure they’re handled correctly. However, integrating auto drafts cleanup might not be essential right now.
thinking
**Clarifying cleanup settings**

I’m realizing there's some confusion between cleanup_orphaned_metadata and orphaned_cleanup_enabled. It looks like the latter is the intended field name according to tasks.csv. Maybe cleanup_orphaned_metadata is an old key, leftover from a previous naming convention. To align things, I think we should consider removing cleanup_orphaned_metadata and use orphaned_cleanup_enabled instead, but that would require some migration.

I noticed that tasks.csv lists several required fields but doesn’t mention cleanup types, which might mean those are controlled by other factors. I’ll need to ensure that orphaned_cleanup_enabled is properly integrated into the database cleanup logic. Lastly, I want to check other task definitions to confirm everything is aligned.
exec
/bin/zsh -lc 'rg -n "''^M06" tasks.csv' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 64ms:
45:M06-01,"Settings Page Framework","Create /includes/class-settings.php using WordPress Settings API. Sections: General, Database Cleanup, Media Audit, Performance, Scheduling, Advanced. Register settings with register_setting(), add_settings_section(), add_settings_field(). Sanitization callbacks for each field type. Default values in activation. Export/import settings as JSON. Reset to defaults option. Acceptance: All settings save correctly, sanitization prevents invalid data, export/import works, reset works."
46:M06-02,"General Settings Section","Settings fields: health_score_cache_duration (1-24 hours), dashboard_widget_enabled (bool), admin_bar_menu (bool), notification_email (email), enable_logging (bool), log_retention_days (7-90), delete_data_on_uninstall (bool). Validation: email format check, numeric range validation. Acceptance: All fields render correctly, validation works, settings take effect immediately."
47:M06-03,"Database Cleanup Settings","Settings fields: revisions_to_keep (0-50), auto_clean_spam_days (0-365, 0=disabled), auto_clean_trash_days (0-365), excluded_transient_prefixes (textarea, one per line), optimize_tables_weekly (bool), orphaned_cleanup_enabled (bool). Acceptance: Settings properly control cleanup behavior, exclusion patterns work, auto-clean respects day settings."
48:M06-04,"Media Audit Settings","Settings fields: unused_media_scan_depth (posts only, all content, deep scan), large_file_threshold_kb (100-5000), duplicate_detection_method (hash, filename, both), excluded_media_ids (comma-separated), media_trash_retention_days (7-90), scan_acf_fields (bool), scan_elementor (bool), scan_woocommerce (bool). Acceptance: Scan depth affects what's checked, thresholds work correctly, builder integrations toggle properly."
49:M06-05,"Performance Settings Section","Settings fields: heartbeat_admin_frequency (15-120), heartbeat_editor_frequency (15-120), heartbeat_frontend (enabled/disabled), query_logging_enabled (bool), slow_query_threshold_ms (10-500), plugin_profiling_enabled (bool). Acceptance: Heartbeat settings apply correctly, query logging togglable, thresholds affect what's flagged."
50:M06-06,"Scheduling Settings Section","Settings fields: scheduler_enabled (bool), database_cleanup_frequency (daily/weekly/monthly/disabled), media_scan_frequency (weekly/monthly/disabled), performance_check_frequency (daily/weekly), preferred_time (hour selector 0-23), notification_on_completion (bool). Create/update Action Scheduler tasks when saved. Acceptance: Schedules create correctly, time preference respected, notifications send on completion."
51:M06-07,"Advanced Settings Section","Settings fields: enable_rest_api (bool), rest_api_rate_limit (10-120 per minute), debug_mode (bool), custom_css (textarea for admin customization), safe_mode (disables destructive operations). Safe mode: all delete/clean endpoints return preview only. Debug mode: extra logging, visible query times. Acceptance: Safe mode truly prevents data modification, debug mode provides useful info, custom CSS applies."
52:M06-08,"Settings Admin Page","Create /templates/admin/settings.php. Tabbed interface matching WP settings pages style. Each section as tab. Save button per tab or unified save. Success/error notices on save. Settings export/import in Advanced tab with file upload. Reset section per tab. Preview of scheduled tasks showing next run times. Acceptance: Tabs work correctly, save provides feedback, export creates valid JSON, import validates and applies."



thinking
**Clarifying database tasks**

I'm examining task M06-03, which has specific fields, but the actual DatabaseSettings includes additional fields like the cleanup_* checkboxes. I'm considering whether to remove those extras to align with M06-03, even though the task doesn’t explicitly limit it to only listed fields. The acceptance criteria indicate that day settings should influence automatic cleanup behavior. We definitely need to implement this, ensuring the orphaned_cleanup_enabled controls the behavior, and I might update scheduled tasks accordingly.
thinking
**Evaluating scheduled tasks**

I’m considering keeping the new key for backward compatibility or using both as an OR option. The revision cleanup should respect the revisions_to_keep threshold. The scheduled task currently uses this setting, but if it falls back, it defaults to 5, which may not be ideal. Should I switch defaults to zero? I need to ensure that features align with the SettingsRegistry. Although database settings aren't my primary focus, I want to make sure everything works effectively. I’ll check how scheduled tasks are executed next.
thinking
**Checking installation defaults**

I need to search for the initial default settings for "wpha_settings." It looks like the Installer.php file might be the place where those defaults are set. I should take a quick look at that to confirm. It’s important to understand what these defaults are since they could impact how everything operates. I'll make sure to inspect this thoroughly to get accurate information. This inspection could clarify how defaults work in the setup process!
exec
/bin/zsh -lc 'rg -n "wpha_settings" includes/Installer.php includes -S | head -n 50' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 49ms:
includes/Scheduler/AbstractScheduledTask.php:99:		$settings = get_option( 'wpha_settings', array() );
includes/Media/Tasks/MediaScanTask.php:219:		$settings        = get_option( 'wpha_settings', array() );
includes/Database/Tasks/DatabaseCleanupTask.php:186:		$settings          = get_option( 'wpha_settings', array() );
includes/Database/Tasks/DatabaseCleanupTask.php:534:				$settings      = get_option( 'wpha_settings', array() );
includes/Performance/Tasks/PerformanceCheckTask.php:124:		$settings      = get_option( 'wpha_settings', array() );
includes/Settings/SettingsRegistry.php:36:	public const OPTION_NAME = 'wpha_settings';
includes/Settings/SettingsServiceProvider.php:327:			'wpha_settings_group',
includes/Settings/SettingsServiceProvider.php:349:				'wpha_settings'
includes/Settings/SettingsServiceProvider.php:359:				'wpha_settings',
includes/Settings/Domain/AbstractDomainSettings.php:33:	protected const OPTION_NAME = 'wpha_settings';

thinking
**Checking installer options**

I need to check if the installer is missing or perhaps not found. Let me dive into organizing this, so I'll start searching for the update_option specifically related to "wpha_settings." It feels like there’s something here that needs verifying to make sure everything is working smoothly. Let’s see what I can find in the settings! I want to ensure I cover all the bases in this process.
exec
/bin/zsh -lc "rg -n \"update_option\\(\\s*'wpha_settings'|add_option\\(\\s*'wpha_settings'|SettingsRegistry::OPTION_NAME\" -S includes | head -n 50" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 71ms:
includes/Settings.php:100:		$name = SettingsRegistry::OPTION_NAME . '[' . $field_id . ']';
includes/Installer.php:226:		if ( false !== get_option( SettingsRegistry::OPTION_NAME ) ) {
includes/Installer.php:238:		update_option( SettingsRegistry::OPTION_NAME, $registry->get_default_settings() );
includes/Installer.php:266:		$settings = get_option( SettingsRegistry::OPTION_NAME, array() );
includes/Installer.php:464:		$settings = get_option( SettingsRegistry::OPTION_NAME, array() );
includes/Installer.php:543:		delete_option( SettingsRegistry::OPTION_NAME );
includes/Settings/SettingsServiceProvider.php:144:		add_action( 'update_option_' . SettingsRegistry::OPTION_NAME, array( $this, 'handle_scheduling_update' ), 10, 2 );
includes/Settings/SettingsServiceProvider.php:328:			SettingsRegistry::OPTION_NAME,
includes/Settings/SettingsServiceProvider.php:384:		$name = SettingsRegistry::OPTION_NAME . '[' . $field_id . ']';
includes/Settings/SettingsServiceProvider.php:585:		update_option( SettingsRegistry::OPTION_NAME, $sanitized );
includes/Settings/SettingsServiceProvider.php:715:		update_option( SettingsRegistry::OPTION_NAME, $registry->get_default_settings() );
includes/Settings/SettingsServiceProvider.php:762:		update_option( SettingsRegistry::OPTION_NAME, $current_settings );
exec
/bin/zsh -lc "sed -n '200,330p' includes/Installer.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 47ms:
			id bigint(20) unsigned NOT NULL AUTO_INCREMENT,
			action varchar(255) NOT NULL,
			execution_time decimal(10,2) NOT NULL,
			memory_used bigint(20) unsigned NOT NULL DEFAULT 0,
			user_role varchar(50) NOT NULL,
			created_at datetime NOT NULL,
			PRIMARY KEY  (id),
			KEY action (action),
			KEY user_role (user_role),
			KEY created_at (created_at),
			KEY execution_time (execution_time)
		) {$charset_collate};";

		dbDelta( $sql_ajax_log );
	}

	/**
	 * Set default settings on installation.
	 *
	 * @since 1.0.0



thinking
**Considering cleanup settings**

I'm evaluating the retention day settings for auto-clean spam and trash. Right now, these settings are used by REST endpoints for manual cleanup, but scheduled tasks might bypass them and delete everything if cleanup_trash_posts is enabled. I think I need to adjust the scheduled cleanup to respect these day settings, which seems to involve modifying the DatabaseCleanupTask to determine which subtasks to run. Also, I should consider the revisions_to_keep threshold; maybe updating the default to something safer would help.
thinking
**Adjusting validation settings**

I think I need to adjust the min/max settings for revisions_to_keep, which is currently set between 0-50, and validate that. For auto_clean days, the max is 365, which is fine. I'm also considering user input validation in DatabaseSettings through excluded_transient_prefixes and ensuring it can't lead to SQL injection. I'll want to enforce stricter sanitization for these inputs and check character limits for performance reasons. It's essential to implement proper validation to keep everything secure and efficient!
thinking
**Implementing custom sanitization**

I’m considering implementing a new sanitize type in SettingsRegistry, like 'prefix_list' or 'newline_list', to improve how DatabaseSettings handle inputs. While I could use the existing 'textarea' type and sanitize_textarea_field, that might not meet all our validation needs. A custom 'text_list' type could be more effective, as it would split inputs by newlines, trim them, remove empty entries, and ensure patterns are safe. I’ll also check the min/max definitions for keep values and review the SettingsServiceProvider for proper registration and sanitization of these fields.
exec
/bin/zsh -lc "sed -n '280,450p' includes/Settings/SettingsServiceProvider.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 51ms:
				array(
					'parent' => $parent_id,
					'id'     => $parent_id . '_safe_mode',
					'title'  => __( 'Safe Mode: On', 'wp-admin-health-suite' ),
					'href'   => admin_url( 'admin.php?page=admin-health-settings&tab=advanced' ),
				)
			);
		}
	}

	/**
	 * Register custom cron schedules for weekly and monthly intervals.
	 *
	 * WordPress only provides hourly, twicedaily, and daily by default.
	 *
	 * @param array $schedules Existing schedules.
	 * @return array Modified schedules.
	 */
	public function register_cron_schedules( array $schedules ): array {
		if ( ! isset( $schedules['weekly'] ) ) {



thinking
**Implementing specifications**

I’m thinking about running additional tests if that helps, but the instructions say to execute commands like lint and test after making changes, so I should keep that in mind. I’ll need to update the DatabaseSettings definitions and make sure the logic aligns with that.

Next, I’ll inspect the patterns for custom sanitize types, like seeing how AdvancedSettings uses 'css'. I can propose new types like 'newline_list' or 'prefix_list', while also considering how `get_option_schema` builds the schema with `build_field_schema`. I need to ensure the schema returns the right types, possibly as strings or arrays.
thinking
**Adjusting sanitization and validation**

I'm thinking about implementing a new sanitize type called 'prefix_lines' and mapping it to a schema string. However, I realize that `build_field_schema` won't recognize this type and defaults to string instead. The `sanitize_field_value` will need to handle it correctly.

Also, retention day settings should likely be between 0 and 365, treating 0 as disabled. I'll implement integer sanitization that clamps negative values to 0 and values over 365 accordingly, but the issue arises with `absint`, which converts negatives to positives. If a user mistakenly enters -1, it doesn't register as disabled. I could use `intval` for better validation, but this may change behavior across the system and affect existing tests.
thinking
**Examining integer sanitization tests**

I'm planning to look at the tests related to integer sanitization within the SettingsRegistry, specifically in the `tests/IntegrationTest` area. I want to ensure that the tests cover various scenarios effectively. I’ll check the lines around there to see how well they validate integer inputs and if there are any gaps in the testing process that might need addressing. My goal is to make sure everything is robust and ready for any upcoming changes!
exec
/bin/zsh -lc "sed -n '240,320p' tests/IntegrationTest.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 51ms:
			)
		);

		$this->assertNotNull( $updated_task->last_run, 'Task should have last_run timestamp' );
		$this->assertNotNull( $updated_task->next_run, 'Task should have next_run timestamp' );

		// Step 6: Unschedule the task.
		$unscheduled = $this->scheduler->unschedule_cleanup( 'transients' );
		$this->assertTrue( $unscheduled, 'Should unschedule task successfully' );

		// Verify task is inactive.
		$inactive_task = $wpdb->get_row(
			$wpdb->prepare(
				"SELECT * FROM {$table} WHERE id = %d",
				$task_id
			)
		);
		$this->assertEquals( 'inactive', $inactive_task->status, 'Task should be inactive' );
	}


thinking
**Evaluating test integration**

I’m noticing that cleanup_revisions exist and are part of the integration tests, but they aren’t in M06-03. It’s possible the existing tests in `tests/IntegrationTest.php` focus on PHPUnit, even though the user instructions only mention npm. I wonder if `npm test` actually runs Jest for JavaScript tests, even if there aren’t any changes there. Since our changes are in PHP, it could make sense to run PHPUnit, although the instructions specify `npm test`. I’ll need to check the package.json scripts for clarity.
exec
/bin/zsh -lc 'cat package.json' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 51ms:
{
  "name": "wp-admin-health-suite",
  "version": "1.0.0",
  "description": "A comprehensive suite for monitoring and maintaining WordPress admin health and performance",
  "scripts": {
    "build": "webpack --mode production",
    "build:dev": "webpack --mode development",
    "watch": "webpack --mode development --watch",
    "dev": "webpack serve --mode development --open",
    "lint": "eslint assets/js --ext .js,.jsx",
    "lint:fix": "eslint assets/js --ext .js,.jsx --fix",
    "format": "prettier --write \"**/*.{js,jsx,json,css,scss,md}\"",
    "format:check": "prettier --check \"**/*.{js,jsx,json,css,scss,md}\"",
    "test": "jest --passWithNoTests",
    "prepare": "husky"
  },
  "keywords": [
    "wordpress",
    "plugin",
    "health",

thinking
**Planning updates for JS tasks**

I realize that lint and test are specific to JavaScript, so changes in PHP won’t affect them, but I still need to follow the commands. Since the format command is empty in the package.json and the user mentioned it as such, we won’t run it. Now, I’m looking at the implementation of improvements. The plan seems short, so I'll create a detailed plan using update_plan, with steps to inspect settings, implement fixes, add tests, and finalize.
Plan update
  → Audit current DB settings usage
  • Update settings definitions + sanitizers
  • Align cleanup task with retention settings
  • Add/adjust tests as needed
  • Run lint and tests

thinking
**Auditing database settings**

I'm currently in the auditing phase. I've already looked at DatabaseSettings and tasks, but I think I need to do more. Next, I'll examine the rest controllers and cleanup logic, as well as the settings page, which is complete. Now, I need to identify any required changes. I want to determine how the scheduled database cleanup task is triggered and what actions it involves. I see that there's a scheduler called AbstractScheduledTask that reads settings and decides if it should run.
exec
/bin/zsh -lc "sed -n '1,220p' includes/Scheduler/AbstractScheduledTask.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 54ms:
<?php
/**
 * Abstract Scheduled Task
 *
 * Base class for scheduled task implementations.
 *
 * @package WPAdminHealth\Scheduler
 */

namespace WPAdminHealth\Scheduler;

use WPAdminHealth\Scheduler\Contracts\SchedulableInterface;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

/**
 * Class AbstractScheduledTask





thinking
**Evaluating cleanup toggles**

I'm looking into cleanup toggles for trashed comments and posts. There are two current toggles: "cleanup_trashed_posts" and "cleanup_trashed_comments", plus a setting for auto cleaning trash days. I want to simplify this process—if either toggle is on, I'll run a task to delete old posts or comments based on the number of days set. However, if the number of days is zero, it should skip the process since that's considered disabled. If users want everything deleted, they’d need a different setting!
thinking
**Clarifying cleanup settings**

I’m trying to interpret the settings for the cleanup feature. If the retention days are set to zero, it implies that the feature is disabled, but that seems to conflict with another interpretation where zero days means to delete everything. To avoid confusion, I think the descriptions need updating to clarify this! Currently, there's a chance the toggles may seem redundant since the days setting already indicates if cleanup is enabled. However, toggles could still let users disable cleanup without resetting the days to zero.
thinking
**Evaluating toggle functionality**

I see that having toggles allows users to disable features temporarily while keeping their configured days. So, I can keep the toggles and set them to run only if both the toggle is enabled and the days are greater than zero. This applies to comments, spam, revisions, and expired transients. For auto drafts, I could consider a new setting for "auto_clean_auto_drafts_days" since currently, there's no retention threshold for them. If it's not supported, it might be better to remove that cleanup option entirely.
thinking
**Considering auto draft cleanup**

It seems I might need to implement scheduled deletion for auto drafts since they aren't currently in the tasks list. Even though the spec doesn't specifically mention auto drafts, the database health section includes them, and there's a dashboard action to delete them. It could be beneficial to have scheduled cleanup for drafts, perhaps deleting those older than seven days for safety. To support this, I might consider adding a retention field for auto drafts, but I need to be cautious not to expand too much and stick to the spec.
thinking
**Considering cleanup integration tests**

I’m examining how integration tests rely on the `cleanup_revisions` feature. The spec seems to suggest I review the `DatabaseSettings` file without mentioning the removal of fields, so I'll probably adjust the existing fields instead. I think it's best to keep current fields but validate the important ones. As for implementing scheduled cleanup for spam and trash comments, I might need to add subtasks. This change could affect scheduled behavior, but it’s set to false by default, which remains safe. 

I’ll need to adjust the current cleanup that empties all trash posts without accounting for retention days; I think it’s safer to delete only the older items if the retention days are set appropriately. While this adjusts behavior, it might affect users who previously relied on immediate trash deletion. But the expectation with `auto_clean_trash_days` implies a preference for age-based deletion, so it feels correct to implement that. 

However, if there’s a manual run of the cleanup task, it shouldn’t override the age filter but could benefit from accepting that parameter in the options. It might require schema changes, though I’m not sure the current tasks schema includes an age threshold. I also need to clarify the description of settings fields and address duplicate cleanup options for orphaned metadata to streamline the UI and options accordingly.
exec
/bin/zsh -lc 'rg -n "cleanup_orphaned_metadata|orphaned_cleanup_enabled" -S tests includes | head -n 50' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 125ms:
includes/Settings/Domain/DatabaseSettings.php:90:			'cleanup_orphaned_metadata'   => array(
includes/Settings/Domain/DatabaseSettings.php:143:			'orphaned_cleanup_enabled'    => array(
includes/Database/Tasks/DatabaseCleanupTask.php:341:		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {

thinking
**Analyzing settings migration**

I’m thinking we can change something since there are no tests involved, but we also need to update any code references like DatabaseCleanupTask. It’s simple enough, but I’m concerned about stored settings in existing installations. If we remove the cleanup_orphaned_metadata key and add orphaned_cleanup_enabled, users might lose their previous settings. It seems best to provide a migration in SettingsRegistry to map the old key to the new one if it’s absent. Although, the plugin may already have settings migrations, so I'll check the Installer for those.
exec
/bin/zsh -lc 'rg -n "migrate|upgrade|version" includes/Installer.php | head -n 80' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 133ms:
25: * Handles plugin installation, upgrades, and database setup.
33:	 * Option name for storing plugin version.
37:	const VERSION_OPTION = 'wpha_version';
94:		self::set_version();
122:		require_once ABSPATH . 'wp-admin/includes/upgrade.php';
244:	 * Set plugin version in options.
250:	private static function set_version() {
377:	 * Check if upgrade is needed and run upgrade routine.
383:	public static function maybe_upgrade() {
384:		$current_version = get_option( self::VERSION_OPTION );
386:		if ( version_compare( $current_version, WP_ADMIN_HEALTH_VERSION, '<' ) ) {
387:			self::upgrade( $current_version );
392:	 * Run upgrade routines based on version.
396:	 * @param string $from_version The version upgrading from.
399:	private static function upgrade( $from_version ) {
403:		// Update version.
404:		self::set_version();
407:		 * Fires after plugin upgrade is complete.
411:		 * @hook wpha_upgraded
413:		 * @param {string} $from_version The version being upgraded from.
exec
/bin/zsh -lc "sed -n '360,520p' includes/Installer.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 64ms:
	 *
	 * @since 1.2.0
	 *
	 * @param string $frequency Frequency name.
	 * @return int|false Interval in seconds, or false if invalid.
	 */
	private static function get_interval_seconds( string $frequency ) {
		$intervals = array(
			'daily'   => DAY_IN_SECONDS,
			'weekly'  => WEEK_IN_SECONDS,
			'monthly' => 30 * DAY_IN_SECONDS,
		);

		return $intervals[ $frequency ] ?? false;
	}

	/**
	 * Check if upgrade is needed and run upgrade routine.
	 *
	 * @since 1.0.0









thinking
**Considering migration options**

I’m realizing the installer doesn’t run upgrade migrations for settings. If we rename a setting key, I think we may need to implement a migration in `SettingsRegistry` to handle that. Keeping both keys could work, but it might mean ignoring old keys and needing mapping in `sanitize_settings`. We could also consider removing unused keys but there's some uncertainty regarding the spec on this. I'll check other code references for "orphaned_cleanup_enabled" to clarify how we should proceed.
thinking
**Implementing cleanup changes**

It looks like Q07-03 is about implementing a cleanup process, and I’ll use the `orphaned_cleanup_enabled` key based on the tasks list. I plan to update `DatabaseSettings` to remove the `cleanup_orphaned_metadata` field and rename it to keep consistency. Backward compatibility is also a priority, so I’ll ensure the old field continues to work as an alias. We’ll need to migrate the values during sanitization or plugin loading since existing installations might not save changes right away. I'll consider how it displays in the settings UI too.
thinking
**Mapping old settings**

I’m thinking about how to handle old keys in `SettingsRegistry->get_all_settings`. After retrieving the options, I want to map the old key to the new one. However, I realize that the old key won't be included after we remove it using `array_intersect_key` with known fields. Mapping should happen before that intersection. Another option is keeping the old key hidden in the UI but still accessible. I might need to mark it as hidden in `DatabaseSettings` or implement mapping in `get_all_settings` before filtering; there are definitely challenges in keeping things tidy!
thinking
**Implementing settings migration**

It looks like `get_all_settings` loads `$settings` and intersects with known fields. I think I can map the old key to the new one before the intersection happens, which ensures the new key is retained. This way, I can remove the old field definition while keeping its value during reads. I’ll also need to persist the mapping upon saving, but I realize saving will drop the old key. So, I’ll implement a method called `migrate_settings_keys`, mapping `'cleanup_orphaned_metadata'` to `'orphaned_cleanup_enabled'`, while preserving existing values in `sanitize_settings`. Let's keep it straightforward for now!
thinking
**Refining settings validation**

I see that if the old key exists but the new key doesn't, `sanitize_settings` could default to the new key. To prevent this, I should migrate keys before sanitizing. I’ll implement a method `migrate_legacy_settings` to ensure the mapping of old to new keys in both `get_all_settings` and `sanitize_settings`. 

For retention days, I plan to update the `DatabaseCleanupTask` to reflect these settings and clarify in `DatabaseSettings` that retention days impact scheduled tasks, including some custom validation for excluded transient prefixes using `sanitize_text_field`. It’s crucial to preserve existing behaviors and ensure all inputs are robustly validated!
thinking
**Enhancing user input validation**

I need to add a new sanitize type, potentially 'newline_list', to ensure proper validation of user inputs in the SettingsRegistry. However, a simpler approach might be to just adjust the DatabaseSettings field definitions to use 'transient_prefixes' for excluded transient prefixes. For the sanitization process in `sanitize_field_value`, I'll implement functionality that will normalize newlines, sanitize each line with `sanitize_text_field`, trim, remove duplicates, and limit the number of lines.

I also want to ensure that settings for cleanup thresholds and retention periods are validated correctly, including sanitizing integers to prevent negative values. While I’m thinking about tests, perhaps adding unit tests for PHP would be beneficial, even if I can't run them all, just to ensure everything behaves as expected!
thinking
**Adjusting cleanup settings**

I’m realizing that deleting all revisions might be too harsh, so I think the default should keep a few—maybe 3 or 5. The current default is 0, which deletes all, so that’s risky. It's essential to change the default for new installs. Also, for tasks like `auto_clean_spam_days`, I want to keep them safe with a default of 0 (disabled).  

For cleanup options, I should rename some fields for clarity and add new tasks like `trash_posts` and `spam` while ensuring existing progress tracking remains stable. I need to be careful about changes so that we don’t disrupt users' settings or tasks already in progress!
thinking
**Updating cleanup settings**

I’m realizing that the `revisions_to_keep` key should always have a default of 0 for safety. The max revisions should also probably clamp to 100, while settings max is 50. I noticed that the scheduled tasks currently ignore `excluded_transient_prefixes`, which is a big oversight!  

So, I’ll modify the transients subtask to include these prefixes. For inflation and spam cleanup, I'll implement age thresholds using settings effectively and ensure that toggles for trash and spam respect the user’s choices. Finally, I’ll look into adding safe retention days for auto drafts to prevent unintentional data loss!
thinking
**Reviewing settings validation**

I’m noticing that the RevisionsManager uses absint without a limit, which could lead to excessive values. The settings have a max of 50, so the scheduled tasks should pull sanitized values from these settings to ensure they fall within an acceptable range.  

I'll also check DatabaseSettings for any numeric validation—like ensuring that excluded prefixes aren't missing a length check. Additionally, some checkboxes lack descriptions, so I plan to add those for clarity. Lastly, I'll update the plan to say step 1 is complete and step 2 is in progress!
Plan update
  ✓ Audit current DB settings usage
  → Update settings definitions + sanitizers
  • Align cleanup task with retention settings
  • Add/adjust tests as needed
  • Run lint and tests






thinking
**Deciding on naming conventions**

I’m leaning towards making the naming more generic, specifically using terms like 'lines' or 'list'. For this field, I want each line to be sanitized, and I'm considering calling that type 'text_lines' or 'newline_text'. After some thought, I think 'text_lines' makes the most sense. Since the restful schema treats it as a string, I’ll implement it in sanitize_field_value using 'newline_list' to keep it descriptive and consistent with existing code.
thinking
**Implementing integer sanitization**

I’m considering an update to our integer sanitization process. Currently, we have code that uses `absint($value)`, but I'm thinking of a change.

The new approach would set a default if the input is null. I wonder about handling booleans and numeric values too. I'd compute with a check for numeric, and then see if it falls within specified min and max values.

Oh, but if the input is an empty string, it returns false for is_numeric, so a default would be better than returning 0. However, I need to account for cases where users might clear the input.
thinking
**Handling default values for fields**

I'm figuring out how to handle default values for different fields. For instance, if `health_score_cache_duration` has a default of 1 and a user clears it, it ends up at 0, which then clamps to 1. But for `preferred_time`, if it defaults to 2 and is cleared, it returns 0 instead. 

Should we revert to the default for cleared inputs? It makes sense for user input validation. If a user enters a non-numeric value, treating it as default seems like a logical approach. I also need to account for how the WP settings API might receive strings. If a user inputs '0005', it should convert to 5.
thinking
**Handling user input and key migration**

I'm analyzing how the system should handle user inputs like '-1' and '3.14'. If the user enters '-1', it recognizes it as numeric and then clamps it to a minimum of 0, which seems right. For '3.14', casting it to an integer results in 3, which also feels appropriate.

Now, regarding the schema builder, I noticed that the method `absint($field['default'] ?? 0)` would turn negative defaults to positive, although defaults shouldn’t be negative for our case.

For key migration, I plan to add a method to manage deprecated keys. If 'orphaned_cleanup_enabled' is set, we'll keep it; if 'cleanup_orphaned_metadata' is set, we'll convert that old value to a boolean and possibly remove the old key later to avoid duplication. I’ll need to remember to call migration in `get_all_settings` and sanitize the settings.
thinking
**Updating settings and sanitization**

In `get_all_settings`, once I retrieve and verify the `$settings`, I'll call the method to migrate any legacy settings. After that, I'll parse defaults to ensure the new keys are included. While sanitizing settings, I need to migrate both stored values and input for key renames to keep the values intact. 

I'll also implement a private method to handle the renaming of orphaned cleanup settings. For `sanitize_field_value`, I'm updating how integers and newline lists are processed, ensuring that null values treat as defaults. For newline lists, I’ll ensure the order is preserved while eliminating duplicates.  

Regarding other fields, I need to adjust definitions accordingly and decide to remove `cleanup_orphaned_metadata`, opting instead for `orphaned_cleanup_enabled`. I’ll ensure any existing code reflects these updates before finalizing the changes.
thinking
**Restructuring cleanup settings**

I'm thinking about restructuring the cleanup settings for easier management. I’ll keep most of the existing order while updating descriptions for clarity, like adding that enabling `cleanup_revisions` will prune revisions based on configured limits.

For `cleanup_auto_drafts`, I’ll consider keeping it with a description related to manual cleanup, even though scheduled tasks don’t currently action it. Adjustments for `cleanup_trashed_posts` along with similar cleanup options will have clear retention descriptions.

I also want to update the `excluded_transient_prefixes` to use 'newline_list' for better sanitation and possibly set a max items limit. As for `revisions_to_keep`, I’m leaning toward a default of 5. I’ll also update the corresponding descriptions and implement all necessary patches, including validation for new input types.
file update
M /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite/includes/Settings/SettingsRegistry.php
@@ -100,2 +100,4 @@
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
@@ -270,2 +272,5 @@
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
@@ -357,8 +362,12 @@
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
@@ -382,2 +391,35 @@
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
@@ -392,2 +434,21 @@
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 2.1.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
apply_patch(auto_approved=true) exited 0 in 24ms:
Success. Updated the following files:
M includes/Settings/SettingsRegistry.php
file update:
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..230e758c73c62da6c56a3ea09e4f7070b89eade9
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 2.1.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

file update:
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..230e758c73c62da6c56a3ea09e4f7070b89eade9
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 2.1.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Checking Settings update**

I'm working on updating SettingsRegistry with a new sanitize type and integer sanitization migration. I need to ensure the PHP syntax is correct. We added `@since 2.1.0`, but there might be a version conflict with the plugin, possibly at 2.0.0 or even 1.5.0. The task spec doesn’t mention versions, but since we’ve included `@since 2.1.0`, it might not align properly. I should check the plugin version constant in wp-admin-health-suite.php to clarify.
exec
/bin/zsh -lc 'rg -n "WP_ADMIN_HEALTH_VERSION" -S wp-admin-health-suite.php includes/Plugin.php | head' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 65ms:
wp-admin-health-suite.php:27:define( 'WP_ADMIN_HEALTH_VERSION', '1.0.0' );
includes/Plugin.php:95:		$this->version     = defined( 'WP_ADMIN_HEALTH_VERSION' ) ? WP_ADMIN_HEALTH_VERSION : '1.0.0';
file update:
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..230e758c73c62da6c56a3ea09e4f7070b89eade9
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 2.1.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

file update
M /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite/includes/Settings/Domain/DatabaseSettings.php
@@ -53,2 +53,3 @@
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
@@ -60,2 +61,3 @@
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
@@ -67,2 +69,3 @@
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
@@ -74,2 +77,3 @@
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
@@ -81,2 +85,3 @@
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
@@ -88,9 +93,11 @@
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
@@ -100,5 +107,5 @@
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
@@ -131,3 +138,4 @@
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
@@ -141,10 +149,2 @@
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
apply_patch(auto_approved=true) exited 0 in 30ms:
Success. Updated the following files:
M includes/Settings/Domain/DatabaseSettings.php
file update:
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..230e758c73c62da6c56a3ea09e4f7070b89eade9
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 2.1.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

file update:
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..230e758c73c62da6c56a3ea09e4f7070b89eade9
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 2.1.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Updating DatabaseSettings**

I'm updating the DatabaseSettings. I've removed the cleanup_orphaned_metadata field, moved orphaned_cleanup_enabled earlier, and changed its title to 'Clean Orphaned Metadata'. I've also updated revisions_to_keep's default to 5 and made some adjustments to excluded_transient_prefixes, changing sanitize to newline_list and adding max_items. 

Descriptions for checkboxes have been added, especially for cleanup_auto_drafts, which indicates that old auto-draft posts will be deleted, although the task doesn’t handle them yet. I need to ensure other code aligns with these defaults and update the SettingsRegistry migration accordingly. Let's patch!
file update
M /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite/includes/Settings/SettingsRegistry.php
@@ -436,3 +436,3 @@
 	 *
-	 * @since 2.1.0
+	 * @since 1.5.0
 	 *
apply_patch(auto_approved=true) exited 0 in 44ms:
Success. Updated the following files:
M includes/Settings/SettingsRegistry.php
file update:
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

file update:
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.




thinking
**Evaluating sanitization steps**

I’m thinking about step 2 and how it might require updates in other areas related to `excluded_transient_prefixes` sanitization, which is automatic. It's important that `sanitize_field_value` properly handles the `newline_list` and uses `$default`, which could be an empty string. I need to check that `sanitize_text_field` doesn’t call functions without the WordPress context loaded. There’s also a mention of tasks related to orphaned metadata and migration mapping—making sure everything transitions smoothly.
thinking
**Assessing DatabaseCleanupTask and updates**

I realized that DatabaseCleanupTask directly uses `get_option`, so it won't recognize `orphaned_cleanup_enabled` by default, meaning orphaned cleanup will not operate. I’ll need to update this in step 3, which is for later. For step 2, the revision to keep has a new default set by the Installer, affecting fresh installs but not existing ones. I also need to consider updates for settings definitions and sanitizers, and possibly revise the JSON schema builder for clarity on field types.
thinking
**Updating UI and steps**

I’m considering whether I should update the settings UI for the `textarea` to include features like a placeholder. But, I'm not sure if that's necessary right now. Anyway, I’ll mark step 2 as completed and move on to step 3. It's good to keep this progress organized, making sure I stay on track with all the updates needed. Keeping these steps clear will help ensure everything flows smoothly moving forward!
Plan update
  ✓ Audit current DB settings usage
  ✓ Update settings definitions + sanitizers
  → Align cleanup task with retention settings
  • Add/adjust tests as needed
  • Run lint and tests
file update:
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

exec
/bin/zsh -lc "sed -n '1,160p' includes/Contracts/TransientsCleanerInterface.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 49ms:
<?php
/**
 * Transients Cleaner Interface
 *
 * Defines the contract for managing WordPress transients.
 *
 * @package WPAdminHealth\Contracts
 */

namespace WPAdminHealth\Contracts;

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	die;
}

/**
 * Interface TransientsCleanerInterface
 *
 * Contract for transient cleanup operations.
file update:
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.










thinking
**Evaluating cleanup tasks**

I'm working with `delete_expired_transients`, which accepts array patterns, so that's good. I’m considering adding logic for scheduled tasks for spam cleanup, but currently, the cleanup tasks list doesn't include that.

I think we need to implement `cleanup_trashed_posts` and `cleanup_trashed_comments` separately, applying retention days.

We need to clarify when to run these cleanups based on retention days. I wonder if running them when retention days are set to 0 might cause confusion. It's probably safer to do nothing in that case.
thinking
**Updating retention descriptions**

With the new checkbox description mentioning the retention period, users should understand that nothing will happen if days are set to 0. I think we also need to clarify the description of `auto_clean_trash_days`, stating it's used when trash cleanup is enabled.

For cleanup logic: if `cleanup_trashed_posts` or `cleanup_trashed_comments` is enabled with `older_than_days` greater than 0, we should delete those items. Otherwise, we can skip and log that retention is disabled. 

Now, for auto drafts cleanup, I’m considering whether to use the existing setting or create a new one specifically for auto drafts, since the current setting is mainly for trash.
thinking
**Considering auto drafts cleanup**

I think auto drafts could potentially be interpreted differently since they aren't technically in trash. However, I could consider "old auto-draft posts" to be those older than 7 days, but users might prefer customizable settings. The spec doesn’t mention this, though retention for auto drafts could fit into a retention period configuration.

To keep things manageable, we could implement cleanup for auto drafts by deleting those older than 7 days or maybe even 30. It might be good to introduce a new setting like `auto_clean_auto_drafts_days` for this. However, the spec primarily focuses on threshold settings and doesn’t clearly include retention for drafts, so there might be a need to review this further.
thinking
**Reviewing auto drafts implementation**

I see that implementing auto drafts cleanup could be part of a review process. The user didn't ask for modifications beyond the spec, but since the spec mentions retention period configuration, there could be room to include this. The spec discusses cleanup threshold settings, but there’s no mention of auto drafts retention.

Given that we updated the checkbox description claiming scheduled cleanup would delete old auto-draft posts, we should follow through and implement this to maintain accuracy. However, we can adjust the description to avoid specifying scheduled or old drafts. I also noticed there’s no existing code for deleting auto drafts, but we can implement that within `DatabaseCleanupTask` using global `$wpdb` and WP delete posts, although it might be a bit intensive.
thinking
**Implementing auto drafts cleanup**

I’m considering how to implement auto drafts cleanup using only WP functions. I can use `get_posts`, targeting auto-drafts, applying an age threshold with a date query. Since auto-drafts tend to be fewer, scheduling cleanup might be feasible, but I’ll need batching to avoid exceeding time limits with `wp_delete_post`. 

I think we can delete a set number, perhaps 200, per run. It might also be good to create a dedicated subtask for this, limiting deletions based on remaining time.

For retention, I could set a hard-coded threshold of 7 days. Adding a new field like `auto_clean_auto_drafts_days` could provide configurability, but that feels like expanding beyond the original scope. Since the spec doesn’t explicitly mention auto drafts, I might stick with deleting drafts older than 7 days, which keeps things simpler.
thinking
**Implementing scheduled cleanup tasks**

I’m planning to implement a scheduled task to clean up auto drafts older than 7 days. Users can still manually delete any recent drafts through the dashboard. I'll use `post_modified` to determine their age and query for them using `get_posts`, specifying `post_status` as 'auto-draft'. While it’s important to batch deletions to avoid time limit issues, I need to seamlessly integrate REST controllers and might need to update them for consistency after reviewing how defaults are handled. 

Since we changed default revision retention to 5, I’ll check if existing code overrides this change and potentially update various controllers to reflect the new approach without passing explicit defaults. While it’s crucial to ensure that settings apply correctly, the focus remains on scheduled tasks, including potential clean-up of spam and trash as well.
thinking
**Implementing cleanup tasks for database**

I plan to add various cleanup tasks based on user options, like 'revisions', 'transients', 'orphaned', 'spam', 'trash', and 'auto_drafts'. Manual cleanup might trigger immediate emptying of trash, while scheduled tasks focus on retention settings. For the 'trash' task, I’ll need to check for options—if manual run is set to clean trash, it should delete all regardless of age.

For spam and auto drafts, new tasks can be introduced, ensuring that options allow manual control where necessary. I’ll also streamline functions to eliminate any redundant or repetitive code for better efficiency. I'll use helper methods for clarity and maintain a consistent approach across revisions and transients tasks. Now, it's time to implement these changes!
thinking
**Implementing item cleanup tasks**

I need to count deleted items and bytes, starting with trash posts and comments. For scheduled runs, if `cleanup_trashed_posts` is true but `older_than_days` equals 0, the task won't run, which is fine. However, for manual runs with cleanup options, the behavior should match previous settings, ensuring all trash is emptied.

I’m also adding a case for spam comments, drawing from the settings for retention days. Auto drafts will be managed similarly, with a default of 7 days. I might also need to check for safe mode settings to ensure destructive operations are handled correctly. Overall, transparency in feature descriptions is important, so I’ll update any relevant settings documents to clarify retention days for users.
thinking
**Adjusting cleanup tasks**

I'm realizing that I need to tweak `determine_cleanup_tasks` to incorporate retention days for various tasks. It also seems like it might be a good idea to update the `description` property for clarity. Plus, I'm considering whether to revise `get_settings_schema` to add new options for cleaning spam, auto drafts, and specific retention days. While adding these might not be necessary for scheduled tasks, I need to explore whether they could apply to REST API calls for manual task execution, ensuring everything stays validated.
exec
/bin/zsh -lc "rg -n \"get_settings_schema\\(\" -S includes | head -n 50" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 65ms:
includes/Scheduler/AbstractScheduledTask.php:106:	public function get_settings_schema(): array {
includes/Scheduler/SchedulerRegistry.php:320:				'settings_schema'   => $task->get_settings_schema(),
includes/Media/Tasks/MediaScanTask.php:755:	public function get_settings_schema(): array {
includes/Scheduler/Contracts/SchedulableInterface.php:74:	public function get_settings_schema(): array;
includes/Database/Tasks/DatabaseCleanupTask.php:574:	public function get_settings_schema(): array {
includes/Performance/Tasks/PerformanceCheckTask.php:292:	public function get_settings_schema(): array {
file update:
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

exec
/bin/zsh -lc "sed -n '260,380p' includes/Scheduler/SchedulerRegistry.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 43ms:
	 * @since 1.2.0
	 * @since 1.2.1 Use MySQL RELEASE_LOCK for atomic operations.
	 *
	 * @param string $task_id The task identifier.
	 * @return bool True if lock was released, false otherwise.
	 */
	private function release_lock( string $task_id ): bool {
		$lock_name = 'wpha_task_' . md5( $task_id );

		// Release MySQL advisory lock.
		if ( $this->connection ) {
			$query  = $this->connection->prepare( 'SELECT RELEASE_LOCK(%s)', $lock_name );
			$result = $query ? $this->connection->get_var( $query ) : null;
		} else {
			global $wpdb;
			$result = $wpdb->get_var(
				$wpdb->prepare(
					'SELECT RELEASE_LOCK(%s)',
					$lock_name
				)
file update:
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Exploring settings for tasks**

I’m thinking that get_settings_schema is useful for the REST UI, and adding schemas for things like spam and trash might help with manual triggers. However, the specs don’t seem to mention that directly, but there could be a way. I should check the REST controllers for scheduler tasks to see if there’s an endpoint for running tasks. I’ll also search for how the scheduler registry is being used.
exec
/bin/zsh -lc 'rg -n "SchedulerRegistry" -S includes/REST | head -n 50' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 36ms:

file update:
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Searching for task endpoints**

I think I should look into whether there's an endpoint for tasks. It makes sense to search for 'get_task_definitions' and see how that function is used. I'll try to find the details on its implementation and how I can utilize it effectively. This could help me better understand the structure and organization of tasks. It's all about getting to the information I need in the most efficient way possible!
exec
/bin/zsh -lc 'rg -n "get_task_definitions" -S includes | head -n 50' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 52ms:
includes/Scheduler/SchedulerRegistry.php:310:	public function get_task_definitions(): array {
file update:
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

file update
M /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -77,3 +77,3 @@
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
@@ -340,6 +340,25 @@
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
@@ -347,2 +366,6 @@
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
@@ -542,3 +565,8 @@
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
@@ -559,5 +587,53 @@
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
@@ -565,2 +641,49 @@
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
@@ -602,2 +725,19 @@
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
apply_patch(auto_approved=true) exited 0 in 43ms:
Success. Updated the following files:
M includes/Database/Tasks/DatabaseCleanupTask.php
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..b14eb39c9a8b4edcc531913a3624c92d7875127f
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.






thinking
**Updating cleanup tasks**

I need to update the DatabaseCleanupTask's subtask to parse excluded patterns. I used `str_replace` to normalize newlines and then exploded the string, which is good. I also made sure that any patterns already sanitized have whitespace removed with `trim`, so that's covered.

For the spam subtask, we need to check if `clean_spam` and `older_than_days` options are set; otherwise, use default settings. For scheduled runs, if `clean_spam` isn't set, we skip if `older_than_days <= 0`. The spam case will execute only if retention is greater than 0 and `cleanup_spam_comments` is enabled. If `clean_spam` is true but `older_than_days` isn't provided, it'll default to settings, possibly 0. I need to ensure that the condition checks are logical to avoid unintended deletions while keeping the process effective.
thinking
**Updating trash cleanup**

For the trash subtask, I see that during a scheduled run, if the `clean_trash` option isn't set, we only include trash in the cleanup if retention days are greater than 0 and the toggles for posts or comments are enabled. If `older_than_days` is greater than 0, we can skip the check.

I also have to consider existing settings like `cleanup_trashed_posts` and `cleanup_trashed_comments`. If only one is enabled, it will only clean up what’s allowed, which is a behavior change from before. In a manual run, if `clean_trash` is true, we set `older_than_days` appropriately based on provided options. For the auto drafts subtask, I’ll default `older_than_days` to 7 days.
thinking
**Managing auto drafts**

If the `clean_auto_drafts` option is true and `older_than_days` is set, I’ll use that value. If it's zero or negative, I’ll set it to 0, meaning I’ll delete all auto drafts modified before now since the `strtotime("-0 days")` would return now.

For a scheduled run with `cleanup_auto_drafts` true and a default of 7 days, it will clean drafts older than that, which seems safe. I should update the DatabaseSettings checkbox description to clarify that it refers to drafts older than 7 days, as the current wording is a bit ambiguous. However, I’m questioning if 7 days is an appropriate hardcoded value. Maybe 30 days would be better!
thinking
**Determining auto-draft retention**

I can decide on the retention policy for WP auto-drafts. While 7 days seems safe, I wonder if it's too short. It could lead to deleting drafts that aren't used immediately, which wouldn't be ideal. However, the plugin already uses 7 days for other retention settings, so it makes sense to stick with that.

Next, I need to ensure that the `get_posts` call uses the correct `date_query`. If `older_than_days` is 0, it includes all existing posts since it checks for modifications made before now. If it's set to 7, it targets posts older than that, which is fine. The `date_query` can handle either a string or an array, so I should verify if it meets expectations and how inclusivity is defined in this context.
thinking
**Refining auto-drafts and cleanup**

I’m considering how we might exclude exactly the threshold time in cleanup operations. We’ve limited the posts per page to 200, so any excess will be processed gradually through weekly scheduled tasks. It’s good that the `determine_cleanup_tasks` includes the auto-drafts subtask every run, even if they don’t exist.

With new options added to the schema and `get_option` retrieving the latest settings efficiently, that’s solid. I also need to ensure the cleanup processes properly reference the recent changes to `cleanup_orphaned_metadata`. I’ll update the DatabaseSettings to clarify the auto-drafts policy about the 7-day threshold as we finalize our changes.
file update
M /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite/includes/Settings/Domain/DatabaseSettings.php
@@ -61,3 +61,3 @@
 				'sanitize' => 'boolean',
-				'description' => __( 'When enabled, scheduled cleanup will delete old auto-draft posts.', 'wp-admin-health-suite' ),
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
apply_patch(auto_approved=true) exited 0 in 46ms:
Success. Updated the following files:
M includes/Settings/Domain/DatabaseSettings.php
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.



thinking
**Updating retention settings**

I’m working on step 3, thinking about how to update other components to utilize retention settings. Scheduled tasks are currently set up to use a transient cleaner with exclude patterns, but what about the revisions to keep? I’ll consider cleanup threshold settings, including minimum and maximum revisions to keep. I should check if other code uses settings for things like spam. It seems we might need to enable the scheduled database cleanup task too. Everything's falling into place!
thinking
**Adjusting settings for cleanup**

For step 3, I need to update "DatabaseSettings domain" for configuring the retention period. Specifically, I think auto_clean_spam_days should only activate if cleanup_spam_comments is enabled. I should also check the new sanitize type 'newline_list', which uses wp_strip_all_tags and sanitize_text_field. I’ll make sure that the `array_filter($items, 'strlen');` function doesn't throw errors if an item is zero, since that should be fine. Additionally, I may have to adjust the rest controllers to use the new `orphaned_cleanup_enabled` key instead of cleanup_orphaned_metadata, but I’ll check thoroughly.
exec
/bin/zsh -lc 'rg -n "cleanup_orphaned_metadata" -S .' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 73ms:
./includes/Settings/SettingsRegistry.php:445:			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
./includes/Settings/SettingsRegistry.php:447:			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
./includes/Database/Tasks/DatabaseCleanupTask.php:343:			|| ! empty( $settings['cleanup_orphaned_metadata'] )
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

exec
/bin/zsh -lc 'rg -n "orphaned_cleanup_enabled" -S includes | head -n 50' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 52ms:
includes/Settings/SettingsRegistry.php:444:			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
includes/Settings/SettingsRegistry.php:447:			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
includes/Database/Tasks/DatabaseCleanupTask.php:342:			! empty( $settings['orphaned_cleanup_enabled'] )
includes/Settings/Domain/DatabaseSettings.php:96:			'orphaned_cleanup_enabled'    => array(
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.



thinking
**Evaluating process steps**

It might be large, but keeping too many isn’t dangerous. I’m thinking to limit it to around 100 as a schema max. For transient cleanup, the exclude_patterns array isn't sanitized for each pattern, though sanitization is done. Now, I believe step 3 is completed, but I need to check for syntax errors using `php -l` on modified files. Moving on to step 4, I’ll add or adjust tests, like sanitization and task selection. It seems we can also add PHP unit tests to ensure everything works correctly.
thinking
**Exploring test options**

I’m considering adding a new test in the tests/unit-standalone area since there’s a tests folder available. It looks like it might use the WordPress test framework, so I should examine the tests' structure carefully. There’s a tests directory that includes the IntegrationTest, and it seems I might be able to run it with PHPUnit. I should probably list what’s in the tests folder to get a clearer idea of what’s available for testing.
exec
/bin/zsh -lc 'find tests -maxdepth 2 -type f -print' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 41ms:
tests/Mocks/MockExclusions.php
tests/Mocks/MockConnection.php
tests/unit/SampleTest.php
tests/unit/MediaScannerTest.php
tests/unit/DatabaseAnalyzerTest.php
tests/unit/LargeFilesTest.php
tests/integration/RestApiTest.php
tests/bootstrap-standalone.php
tests/bootstrap.php
tests/README.md
tests/factories/CommentFactory.php
tests/factories/PostFactory.php
tests/factories/AttachmentFactory.php
tests/StandaloneTestCase.php
tests/TestCase.php
tests/IntegrationTest.php
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Considering testing options**

I'm looking into unit tests and integration tests, maybe using the WordPress test suite. There's also bootstrap-standalone for tests that don't need WordPress. I think we could add unit tests for sanitization in SettingsRegistry, which would involve using WordPress functions like sanitize_text_field. However, I wonder if they can be mocked or if they might provide stub functions in standalone tests. I should definitely check out tests/bootstrap-standalone.php for more insights.
exec
/bin/zsh -lc "sed -n '1,200p' tests/bootstrap-standalone.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 38ms:
<?php
/**
 * PHPUnit bootstrap file for standalone unit tests (no WordPress required)
 *
 * @package WPAdminHealth\Tests
 */

// Define test environment constants.
define( 'WP_ADMIN_HEALTH_TESTS_DIR', __DIR__ );
define( 'ABSPATH', dirname( __DIR__ ) . '/' );

// WordPress function stubs for standalone tests.
if ( ! function_exists( '__' ) ) {
	/**
	 * Translation stub - returns the string as-is.
	 *
	 * @param string $text   Text to translate.
	 * @param string $domain Text domain (unused).
	 * @return string
	 */
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Inspecting WordPress functions**

I'm looking into bootstrap-standalone since it stubs some WordPress functions, but not all of the ones we used in SettingsRegistry, like sanitize_textarea_field and sanitize_email. I notice for our new newline_list sanitizer, we rely on wp_strip_all_tags, which isn't stubbed and might break standalone tests if sanitize_settings is invoked. I wonder if these tests are running with WordPress or if there's a way to run unit tests standalone. I should check the tests in SampleTest and examine the phpunit.xml file.
exec
/bin/zsh -lc 'cat phpunit.xml' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 40ms:
<?xml version="1.0" encoding="UTF-8"?>
<phpunit
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="https://schema.phpunit.de/9.5/phpunit.xsd"
	bootstrap="tests/bootstrap.php"
	backupGlobals="false"
	colors="true"
	convertErrorsToExceptions="true"
	convertNoticesToExceptions="true"
	convertWarningsToExceptions="true"
	stopOnFailure="false"
	verbose="true">
	<testsuites>
		<testsuite name="WP Admin Health Suite Test Suite">
			<directory>tests/unit</directory>
			<directory>tests/integration</directory>
		</testsuite>
	</testsuites>
	<coverage processUncoveredFiles="true">
		<include>
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Examining test files**

I'm looking at the Bootstrap file, which seems to be tests/bootstrap.php. It likely loads the WordPress test framework, so I think our changes should be fine there. There's also phpunit-standalone.xml for tests that don't need WordPress. Hmm, I should take a closer look at phpunit-standalone.xml to see what it contains. This way, I'll know more about how the tests are being structured without the WordPress dependencies.
exec
/bin/zsh -lc 'cat phpunit-standalone.xml' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 38ms:
<?xml version="1.0" encoding="UTF-8"?>
<phpunit
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="https://schema.phpunit.de/9.5/phpunit.xsd"
	bootstrap="tests/bootstrap-standalone.php"
	backupGlobals="false"
	colors="true"
	convertErrorsToExceptions="true"
	convertNoticesToExceptions="true"
	convertWarningsToExceptions="true"
	stopOnFailure="false"
	verbose="true">
	<testsuites>
		<testsuite name="WP Admin Health Suite Standalone Tests">
			<directory>tests/unit-standalone</directory>
		</testsuite>
	</testsuites>
	<coverage processUncoveredFiles="true">
		<include>
			<directory suffix=".php">includes</directory>
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Exploring testing directories**

I see that there are standalone tests using bootstrap-standalone with limited stubs. This prompts me to check if the tests directory `tests/unit-standalone` exists. I'm curious to see what's in there and how it all ties together. It feels important to do this to ensure everything is properly set up. I wonder what I might find that could enhance my understanding!
exec
/bin/zsh -lc 'ls tests/unit-standalone 2>/dev/null || echo "(no unit-standalone dir)"' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 32ms:
Cache
Container
Integration
Media
Mocks
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Looking into unit tests**

I'm considering whether there are unit-standalone tests that might cover something like SettingsRegistry. It sounds like a logical idea to search for it to ensure those tests exist. It’s important to check if everything is properly covered in the testing phase, you know? I’m just trying to make sure that gaps aren’t left unaddressed. So, let’s go ahead and see what we can find!
exec
/bin/zsh -lc 'rg -n "SettingsRegistry" tests/unit-standalone tests/unit tests/integration | head -n 100' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 44ms:

file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Clarifying testing steps**

The instructions only mention running npm lint/test, but I think it’s a good idea to also run phpunit to be on the safe side. I might need to set up the WordPress tests library, though, so I can put that off for later. Right now, I should just finish step 3. After that, I wonder if we should update any documentation on auto drafts retention? Step 3 is done, and now I’ll mark it completed while starting step 4!
Plan update
  ✓ Audit current DB settings usage
  ✓ Update settings definitions + sanitizers
  ✓ Align cleanup task with retention settings
  → Add/adjust tests as needed
  • Run lint and tests
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Evaluating test requirements**

I’m at step 4, thinking about adding or adjusting tests as needed. We need to decide on necessary tests since the specification mentions validation. I'm thinking we should add at least a unit test to ensure that the SettingsRegistry sanitization works correctly, especially with newline lists, negative integers, and orphaned keys. Testing in standalone or WP unit tests is a consideration. However, maybe we could test sanitize_field_value indirectly with stubs for get_option, if that works. Let's check the standalone bootstrap for get_option.
exec
/bin/zsh -lc 'rg -n "function get_option" -n tests/bootstrap-standalone.php' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 49ms:
293:	function get_option( $option, $default = false ) {
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

exec
/bin/zsh -lc "sed -n '260,360p' tests/bootstrap-standalone.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 45ms:
	 * Add action stub - does nothing.
	 *
	 * @param string   $hook_name     Hook name.
	 * @param callable $callback      Callback function.
	 * @param int      $priority      Priority.
	 * @param int      $accepted_args Number of arguments.
	 * @return true
	 */
	function add_action( $hook_name, $callback, $priority = 10, $accepted_args = 1 ) {
		return true;
	}
}

if ( ! function_exists( 'esc_url' ) ) {
	/**
	 * URL escaping stub.
	 *
	 * @param string $url URL to escape.
	 * @return string Escaped URL.
	 */
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.






thinking
**Evaluating testing strategies**

I'm thinking about how modifications to the tests bootstrap could affect other tests. It seems okay, but the user didn't mention PHPUnit, though adding tests sounds good. Maybe we could create a new test file under `tests/unit-standalone` since those tests run with phpunit-standalone, not npm. Alternatively, we might add a WordPress unit test under `tests/unit` which would allow us to use WP functions, but setting up that environment could be complex. It looks like we could still write standalone tests more simply.
thinking
**Assessing settings sanitization**

I'm considering how `AbstractDomainSettings` extends and uses `get_option`, which might introduce some complexity. It seems that `define_fields` doesn’t involve any WP dependencies, but it does include a field for sanitizing 'newline_list', which we will test. After that, I'd register `new DatabaseSettings()` and call `$registry->sanitize_settings($input)`. The function retrieves fields and stored options, and loops through field IDs to sanitize values or defaults. We currently lack the necessary WP functions in our standalone bootstrap, but we'll add stubs to handle sanitization properly, ensuring integers like `revisions_to_keep` are correctly clamped to minimum values.
thinking
**Testing defaults and sanitization**

I'm reflecting on our field defaults, which is set to 5, and I think if the input is -1, the result should be 0 instead of the previous 1. That seems good. I also want to test `auto_clean_trash_days`; if it’s blank, it should return the default of 0. Then there's `health_score_cache_duration`, which should return 1 for a blank input.

Now, for sanitizing `newline_list`, I could supply something like `"  wc_\n< b >\nwc_ \n\nmy prefix\n"` and expect a clean return. But it looks like our sanitizer should remove unwanted elements like script tags too. I need to ensure it handles duplicates and excess whitespace properly.
thinking
**Handling input sanitization and migration**

I'm thinking about sanitizing the example input `"  wpha_\r\nwc_\nwc_\n  \nmy prefix\n"`, which should turn into `"wpha_\nwc_\nmyprefix"`. The `array_unique` function will help remove duplicates while preserving order.

Regarding migration, if I supply a stored option with `cleanup_orphaned_metadata => true` and leave out `orphaned_cleanup_enabled`, the test should indirectly verify this by calling `sanitize_settings`. It'll ensure that if the input includes `cleanup_orphaned_metadata`, it sets `orphaned_cleanup_enabled` to true after migration. It looks like we're on the right track!
thinking
**Writing legacy key tests**

I’m planning to test how sending input with a legacy key works, even though the old key isn't in the fields. I can still include it in the tests. Here’s what I’m thinking: 

I’ll set up the registry to register `DatabaseSettings` and possibly some other domains, then call `sanitize_settings` with various inputs, including `cleanup_orphaned_metadata => '1'`, `excluded_transient_prefixes`, and others.

In the assertions, I'll check that `sanitized['orphaned_cleanup_enabled']` equals true, that any duplicates are removed, and that various minimum values are properly clamped. Also, I need to ensure I'm importing classes correctly in the tests.
exec
/bin/zsh -lc "sed -n '1,120p' tests/StandaloneTestCase.php" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 43ms:
<?php
/**
 * Standalone Test Case for unit tests not requiring WordPress
 *
 * @package WPAdminHealth\Tests
 */

namespace WPAdminHealth\Tests;

use PHPUnit\Framework\TestCase;

/**
 * Base test case class for standalone unit tests.
 *
 * Use this for testing components that don't depend on WordPress functions.
 */
abstract class StandaloneTestCase extends TestCase {

	/**
	 * Set up test environment before each test.
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

exec
/bin/zsh -lc 'tail -n 60 tests/bootstrap-standalone.php' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 34ms:
	 * @param int $min Minimum value.
	 * @param int $max Maximum value.
	 * @return int Random number.
	 */
	function wp_rand( $min = 0, $max = 0 ) {
		if ( 0 === $max ) {
			$max = mt_getrandmax();
		}
		return mt_rand( $min, $max );
	}
}

// Composer autoloader.
require_once dirname( __DIR__ ) . '/vendor/autoload.php';

// Register test namespace autoloader for Mocks and other test classes.
spl_autoload_register(
	function ( $class ) {
		$prefix = 'WPAdminHealth\\Tests\\';
		$len    = strlen( $prefix );
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.


thinking
**Exploring Bootstrap Functions**

I'm thinking about how Bootstrap loads the composer autoloader and defines stubs for various WordPress functions. This could allow me to write standalone tests under tests/unit-standalone, which is a positive step. I might also need to add stub functions for the `SettingsRegistry` new sanitize feature. However, I see that `wp_strip_all_tags` isn't stubbed yet. I should verify in bootstrap-standalone to see if there's a stub for `wp_strip_all_tags`. Let's do a search!
exec
/bin/zsh -lc 'rg -n "wp_strip_all_tags" tests/bootstrap-standalone.php' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite exited 1 in 51ms:

file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

exec
/bin/zsh -lc 'rg -n "sanitize_textarea_field" tests/bootstrap-standalone.php' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite exited 1 in 40ms:

file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.

exec
/bin/zsh -lc 'find tests/unit-standalone -maxdepth 2 -type f -print' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 46ms:
tests/unit-standalone/Mocks/MockConnectionTest.php
tests/unit-standalone/Cache/CacheTest.php
tests/unit-standalone/Integration/ContainerCacheIntegrationTest.php
tests/unit-standalone/Container/ContainerTest.php
tests/unit-standalone/Container/ServiceProviderTest.php
tests/unit-standalone/Media/AltTextCheckerTest.php
tests/unit-standalone/Media/SafeDeleteTest.php
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.






thinking
**Preparing Settings Tests**

I'm considering not doing any settings tests right now. Maybe I should create a new directory, possibly named Settings or SettingsRegistryTest, in the root? I want to stick to the existing structure, which groups modules like Cache and Container. My plan is to add `tests/unit-standalone/Settings/SettingsRegistryTest.php` and make sure that autoloading functions correctly. I also want to check if there are tests/TestCase for WP and use StandaloneTestCase for our tests. Finally, I'll register the DatabaseSettings domain.
thinking
**Evaluating Sanitization Settings**

I’m working with the `sanitize_settings` function, which uses `get_option` to load stored settings; the stub is returning an empty array by default. The function loops through fields and sets defaults if no input is provided, which seems good. Since we've changed the default for `revisions_to_keep` to 5, the sanitized output when there's no input should reflect that. I'll also test clamping on the `auto_clean_trash_days` field by setting inputs like -1 and 999 to check the expected outputs. Finally, I want to validate the newline_list sanitizer for duplicates and whitespace too, ensuring it's functioning correctly.
thinking
**Implementing and Testing Functions**

I’m planning to add a function stub for `wp_strip_all_tags` in `bootstrap-standalone.php` if it doesn’t already exist. I’ll follow the signature used in WordPress. Next, I want to create a test file with specific test cases. 

For the first case, `test_sanitize_settings_migrates_legacy_orphaned_key`, I’ll provide input that reflects changes in the DatabaseSettings. After sanitization, I need to assert that certain fields are correctly updated or removed. The second case, `test_sanitize_settings_clamps_integer_values`, will verify that certain inputs clamp to their expected outputs, ensuring everything sanitizes as intended.
thinking
**Validating Integer Sanitization and Normalization**

I notice that `revisions_to_keep` has a maximum of 50, not 365, so I’ll adjust my expectations: for an input of 999, the expected output for this field should be 50. For an input of -1, I expect it to clamp down to 0. Since `sanitize_settings` only keeps one value per key while looping, I'll create separate tests for each scenario.

For `test_sanitize_settings_normalizes_newline_list`, I’m testing input with whitespace and ensure duplicates are removed. The output should normalize to "wc_\nmyprefix," and I want to check how the max_items are handled, especially if more than 100 items are provided.
thinking
**Implementing Tests for Sanitization**

I plan to quickly test by generating 101 lines to check if the output count results in 100, which should confirm the line counting. The `sanitize_settings` function returns sanitized values for all fields, including `excluded_transient_prefixes`, so I’ll ensure to assert that correctly. Since our sanitizer outputs a string with newlines, I want to confirm the order too. 

I also need to make sure my tests utilize only the DatabaseSettings domain, ensuring all relevant keys are included. I will patch and implement the test file, considering changes made to integer sanitization as well.
file update
M /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite/tests/bootstrap-standalone.php
@@ -142,2 +142,21 @@
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
apply_patch(auto_approved=true) exited 0 in 46ms:
Success. Updated the following files:
M tests/bootstrap-standalone.php
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.

file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.

file update
A /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite/tests/unit-standalone/Settings/SettingsRegistryTest.php
<?php
/**
 * SettingsRegistry standalone tests.
 *
 * @package WPAdminHealth\Tests
 */

namespace WPAdminHealth\Tests\Settings;

use WPAdminHealth\Settings\SettingsRegistry;
use WPAdminHealth\Settings\Domain\DatabaseSettings;
use WPAdminHealth\Tests\StandaloneTestCase;

class SettingsRegistryTest extends StandaloneTestCase {

	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
		$registry = new SettingsRegistry();
		$registry->register( new DatabaseSettings() );

		$sanitized = $registry->sanitize_settings(
			array(
				'cleanup_orphaned_metadata' => '1',
			)
		);

		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
	}

	public function test_sanitize_settings_clamps_integer_values(): void {
		$registry = new SettingsRegistry();
		$registry->register( new DatabaseSettings() );

		$sanitized = $registry->sanitize_settings(
			array(
				'revisions_to_keep'    => '-1',
				'auto_clean_trash_days' => 999,
				'auto_clean_spam_days'  => '-5',
			)
		);

		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
	}

	public function test_sanitize_settings_normalizes_newline_list(): void {
		$registry = new SettingsRegistry();
		$registry->register( new DatabaseSettings() );

		$sanitized = $registry->sanitize_settings(
			array(
				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
			)
		);

		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
	}
}

apply_patch(auto_approved=true) exited 0 in 49ms:
Success. Updated the following files:
A tests/unit-standalone/Settings/SettingsRegistryTest.php
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+

file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+



thinking
**Checking file and directory creation**

I added a test file, and now I need to ensure the directory path exists. I know that while `apply_patch` can create files, it might not automatically create directories. If the directory doesn't exist, the `Add File` function will fail. But since it succeeded, the directory must have existed or been created. We're also using the `namespace WPAdminHealth\Tests\Settings;`, which relies on `StandaloneTestCase`. I should confirm that composer autoload includes this namespace, and it does, so classes are loaded. Now, we updated the test file name and location, and they should work in `phpunit-standalone`, even though that's not required. Our new tests are calling `sanitize_settings`, which interacts with stubs like `get_option`. But keep in mind that `sanitize_settings` also calls functions like `sanitize_email` and `is_email`.
thinking
**Finalizing step 4**

We’re only registering `DatabaseSettings`, which doesn’t include email fields. That’s fine. The `sanitize_settings` function will handle all fields, including things like `excluded_transient_prefixes`. For booleans, it uses `filter_var`, and for integers, it checks with `is_numeric`. Newline lists use `wp_strip_all_tags` and `sanitize_text_field`, which seems great. It does handle 'text' fields by calling `sanitize_text_field`, so I expect the tests to pass. 

The `test_sanitize_settings_migrates_legacy_orphaned_key` will check that the sanitized output doesn't include `cleanup_orphaned_metadata`, which is correct since `sanitize_settings` only returns keys for the specified fields. 

Now that step 4 is done, we did change the integer sanitization in `SettingsRegistry`, which might affect other tests. I think it’s a good idea to run `phpunit-standalone` to evaluate. It’s not required, but it’s wise. Otherwise, I might run `php -l`. So with tests added, let’s mark step 4 as complete and move on to step 5, which focuses on running lint and testing.
Plan update
  ✓ Audit current DB settings usage
  ✓ Update settings definitions + sanitizers
  ✓ Align cleanup task with retention settings
  ✓ Add/adjust tests as needed
  → Run lint and tests
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+

exec
/bin/zsh -lc 'php -l includes/Settings/SettingsRegistry.php && php -l includes/Settings/Domain/DatabaseSettings.php && php -l includes/Database/Tasks/DatabaseCleanupTask.php && php -l tests/bootstrap-standalone.php && php -l tests/unit-standalone/Settings/SettingsRegistryTest.php' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 312ms:
No syntax errors detected in includes/Settings/SettingsRegistry.php
No syntax errors detected in includes/Settings/Domain/DatabaseSettings.php
No syntax errors detected in includes/Database/Tasks/DatabaseCleanupTask.php
No syntax errors detected in tests/bootstrap-standalone.php
No syntax errors detected in tests/unit-standalone/Settings/SettingsRegistryTest.php
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+

exec
/bin/zsh -lc 'npm run lint' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 2.13s:

> wp-admin-health-suite@1.0.0 lint
> eslint assets/js --ext .js,.jsx


/Users/ahmedyounis/Documents/Projects/wp-admin-health-suite/assets/js/admin.js
    7:1  warning  Missing JSDoc @param "window" type    jsdoc/require-param-type
    8:1  warning  Missing JSDoc @param "$" type         jsdoc/require-param-type
  276:1  warning  Missing JSDoc @param "message" type   jsdoc/require-param-type
  277:1  warning  Missing JSDoc @param "duration" type  jsdoc/require-param-type

/Users/ahmedyounis/Documents/Projects/wp-admin-health-suite/assets/js/charts.js
  7:1  warning  Missing JSDoc @param "window" type  jsdoc/require-param-type
  8:1  warning  Missing JSDoc @param "$" type       jsdoc/require-param-type

/Users/ahmedyounis/Documents/Projects/wp-admin-health-suite/assets/js/components/HealthScoreCircle.jsx
  31:30  warning  'score' is missing in props validation    react/prop-types
  31:41  warning  'grade' is missing in props validation    react/prop-types
  31:54  warning  'loading' is missing in props validation  react/prop-types
  57:1   warning  Missing JSDoc @param "timestamp" type     jsdoc/require-param-type
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+


thinking
**Running tests after linting**

I see that the linting process returned warnings but didn't cause an exit code error, which means I can move forward. That's a good sign, and it feels okay! Now, I'll proceed to run the npm tests to check if everything is working as expected. It’s crucial to ensure the tests pass for the overall functionality! I’ll stay focused and monitor the outcomes closely. Let’s see what happens next!
exec
/bin/zsh -lc 'npm test' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 1.40s:

> wp-admin-health-suite@1.0.0 test
> jest --passWithNoTests

PASS assets/js/components/QuickActions.test.jsx
PASS assets/js/components/ActivityTimeline.test.jsx
  ● Console

    console.error
      Warning: An update to ActivityTimeline inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
          at ActivityTimeline (/Users/ahmedyounis/Documents/Projects/wp-admin-health-suite/assets/js/components/ActivityTimeline.jsx:108:46)
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+


thinking
**Running tests for accuracy**

It's great that the npm tests pass, but I want to ensure everything is thorough. I’m thinking about running the phpunit standalone tests since we've added some new features. While it's not necessary for the user, it could be a smart move to verify that everything works correctly. I’ll run `phpunit -c phpunit-standalone.xml` or perhaps `vendor/bin/phpunit -c phpunit-standalone.xml`, depending on its installation status. I'll check quickly and then execute the test with a timeout.
exec
/bin/zsh -lc './vendor/bin/phpunit -c phpunit-standalone.xml' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 162ms:
PHPUnit 9.6.31 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.16
Configuration: phpunit-standalone.xml

...............................................................  63 / 239 ( 26%)
............................................................... 126 / 239 ( 52%)
............................................................... 189 / 239 ( 79%)
..................................................              239 / 239 (100%)

Time: 00:00.024, Memory: 10.00 MB

OK (239 tests, 590 assertions)
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+


thinking
**Completing testing steps**

Awesome! The standalone tests, including the new ones, have passed. Now, I'm considering whether to run a full PHPUnit test. That might require having the WordPress test libraries installed, but I'm not sure if that's necessary. It could take a while, and there's a possibility it might fail due to an unset environment, but I don’t think it’s needed. Right now, I'm making progress on step 5 and can mark it as completed!
Plan update
  ✓ Audit current DB settings usage
  ✓ Update settings definitions + sanitizers
  ✓ Align cleanup task with retention settings
  ✓ Add/adjust tests as needed
  ✓ Run lint and tests
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+

exec
/bin/zsh -lc 'git status --porcelain' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 53ms:
 M .t2/state.json
 M includes/Database/Tasks/DatabaseCleanupTask.php
 M includes/Settings/Domain/DatabaseSettings.php
 M includes/Settings/SettingsRegistry.php
 M tests/bootstrap-standalone.php
?? .logs/Q07-02.gitcommit.txt
?? .plans/Q07-03.md
?? .t2/handoff/Q07-03.md
?? tests/unit-standalone/Settings/
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+



thinking
**Evaluating untracked files**

I’m looking at the file plans/Q07-03.md, which appears untracked in git status. This suggests it didn't exist in the repository, but we did read it earlier. The instructions may not have included it for tracking. Should I add it? Maybe not, but it could be fine to leave untracked. The final patch might benefit from only relevant code changes. I also noted that some stray files like .logs/Q07-02.gitcommit.txt could be cleaned up.
thinking
**Inspecting leftover files**

I’m noticing that the file .logs/Q07-02.gitcommit.txt might be leftover from previous tasks and may not be necessary. I’m considering removing it if it was created accidentally. However, I should check the .logs folder first to see if there’s a reason to keep it. It’s worth inspecting the directory before making a final decision on whether to delete the untracked file or not.
exec
/bin/zsh -lc 'ls -la .logs 2>/dev/null || echo "no .logs dir"' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 152ms:
total 13024
drwxr-xr-x@ 371 ahmedyounis  staff   11872 Jan 16 22:39 .
drwxr-xr-x   55 ahmedyounis  staff    1760 Jan 16 09:09 ..
-rw-r--r--@   1 ahmedyounis  staff    2995 Jan  7 10:33 M00-01.claude.impl.last.md
-rw-r--r--@   1 ahmedyounis  staff    4285 Jan  7 10:33 M00-01.claude.impl.raw.txt
-rw-r--r--@   1 ahmedyounis  staff    1228 Jan  7 10:33 M00-01.gitcommit.txt
-rw-r--r--@   1 ahmedyounis  staff    2153 Jan  7 10:41 M00-02.claude.impl.last.md
-rw-r--r--@   1 ahmedyounis  staff    3397 Jan  7 10:41 M00-02.claude.impl.raw.txt
-rw-r--r--@   1 ahmedyounis  staff     522 Jan  7 10:41 M00-02.gitcommit.txt
-rw-r--r--@   1 ahmedyounis  staff    2673 Jan  7 10:43 M00-03.claude.impl.last.md
-rw-r--r--@   1 ahmedyounis  staff    3903 Jan  7 10:43 M00-03.claude.impl.raw.txt
-rw-r--r--@   1 ahmedyounis  staff     401 Jan  7 10:43 M00-03.gitcommit.txt
-rw-r--r--@   1 ahmedyounis  staff    3884 Jan  7 10:47 M00-04.claude.impl.last.md
-rw-r--r--@   1 ahmedyounis  staff    5163 Jan  7 10:47 M00-04.claude.impl.raw.txt
-rw-r--r--@   1 ahmedyounis  staff     620 Jan  7 10:47 M00-04.gitcommit.txt
-rw-r--r--@   1 ahmedyounis  staff    3160 Jan  7 10:50 M00-05.claude.impl.last.md
-rw-r--r--@   1 ahmedyounis  staff    4409 Jan  7 10:50 M00-05.claude.impl.raw.txt
-rw-r--r--@   1 ahmedyounis  staff     484 Jan  7 10:50 M00-05.gitcommit.txt
-rw-r--r--@   1 ahmedyounis  staff    3880 Jan  7 10:53 M00-06.claude.impl.last.md
-rw-r--r--@   1 ahmedyounis  staff    5139 Jan  7 10:53 M00-06.claude.impl.raw.txt
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+


thinking
**Investigating files in .logs**

I’m looking at the .logs directory and noticing it has many files. It's possible they’re untracked, but I’m wondering if .gitignore is in play here. Still, git status is only showing one untracked file: Q07-02.gitcommit.txt. Yet there are many files in .logs that might be tracked or ignored, which is confusing. If .logs is ignored, why is an untracked file showing up? I guess I need to check the .gitignore file for clarification.
exec
/bin/zsh -lc 'cat .gitignore 2>/dev/null || echo "no .gitignore"' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 46ms:
# Node modules
node_modules/

# Build output
assets/js/dist/

# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# OS files
.DS_Store
Thumbs.db

# IDE files
.vscode/
.idea/
*.sublime-project
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+






thinking
**Evaluating git tracking issues**

I’m noticing that my .gitignore doesn’t seem to ignore certain directories, like .logs, .t2, and .plans. Some files are tracked while .logs/Q07-02.gitcommit.txt is untracked, even though it looks like .logs has mostly tracked files. Maybe that file is new and hasn’t been added yet? I’m unsure if .t2/state.json is meant to be tracked based on the user's request for task Q07-03, which seems to focus solely on code changes. It's tricky!
thinking
**Assessing untracked files and changes**

Leaving untracked files might be fine, but ideally, my final patch as an AI shouldn't include those. Typically, I only commit relevant changes. Since I'm not committing, leaving untracked seems okay. However, I should remove unrelated modifications to keep things neat. I can't change .t2/state.json if it’s modified automatically, but I could revert it if needed. This file might contain internal state—something the user might not want modified. I should check the diff for .t2/state.json to see if it’s just a timestamp update; if so, that could be acceptable.
thinking
**Clarifying modifications and untracked files**

I’m considering the instructions for implementing the spec, and while I might be able to ignore some aspects, I’d prefer to revert changes to .t2/state.json and remove the untracked .logs/Q07-02.gitcommit.txt. Not including .plans and .t2/handoff is also on my mind. Even though those files already exist untracked, I’m realizing that the final patch will only include modifications to tracked files. Untracked files won’t be part of the patch, but new test files I created should be included, even if they're currently untracked.
thinking
**Assessing untracked files and changes**

I see that `git status` shows new untracked files in `tests/unit-standalone/Settings/`, which we need to include. Modifications to .t2/state.json are tracked, but we might want to revert them since the user didn’t mention needing those changes. Files like `.plans/Q07-03.md` and `.t2/handoff/Q07-03.md` are untracked, possibly created by the harness, which means we might not need to commit them. I’m wondering how we read `.plans/Q07-03.md` if it’s untracked; it must exist for this session. As for `.logs/Q07-02.gitcommit.txt`, it seems like a leftover that we should probably remove.
thinking
**Analyzing log files and tracking**

I'm considering whether the untracked Q07-02.gitcommit.txt file was inadvertently created by the harness or if it’s part of previous tasks. Since it’s untracked, it could be something the user might want to keep as a log of past tasks. There are multiple log files in the .logs directory, which likely hold history. I'll need to check if these log files are tracked by running `git ls-files .logs | head`. If they are, the user might want to track the Q07-02.gitcommit.txt file too. It’s unclear why it’s untracked when others might be tracked.
exec
/bin/zsh -lc 'git ls-files .logs | head -n 20' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 51ms:
.logs/M00-01.claude.impl.last.md
.logs/M00-01.claude.impl.raw.txt
.logs/M00-01.gitcommit.txt
.logs/M00-02.claude.impl.last.md
.logs/M00-02.claude.impl.raw.txt
.logs/M00-02.gitcommit.txt
.logs/M00-03.claude.impl.last.md
.logs/M00-03.claude.impl.raw.txt
.logs/M00-03.gitcommit.txt
.logs/M00-04.claude.impl.last.md
.logs/M00-04.claude.impl.raw.txt
.logs/M00-04.gitcommit.txt
.logs/M00-05.claude.impl.last.md
.logs/M00-05.claude.impl.raw.txt
.logs/M00-05.gitcommit.txt
.logs/M00-06.claude.impl.last.md
.logs/M00-06.claude.impl.raw.txt
.logs/M00-06.gitcommit.txt
.logs/M00-07.claude.impl.last.md
.logs/M00-07.claude.impl.raw.txt
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+


thinking
**Checking log files**

I’m thinking about how log files are tracked, and it seems like Q07-02.gitcommit.txt might not be tracked, while similar files like Q07-01.gitcommit.txt are possibly tracked. I'd like to confirm if Q07-02 is indeed tracked. It’s important to double-check this to avoid any confusion or mistakes in the version control process. Let’s see if I can get that information sorted out!
exec
/bin/zsh -lc 'git ls-files .logs | rg -n "Q07-02" || true' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 46ms:
367:.logs/Q07-02.codex.impl.last.md
368:.logs/Q07-02.codex.impl.raw.txt
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+

exec
/bin/zsh -lc "sed -n '1,60p' .logs/Q07-02.gitcommit.txt" in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 42ms:
[main 34c2c0b] Q07-02: implement
 16 files changed, 31531 insertions(+), 15 deletions(-)
 create mode 100644 .logs/Q07-01.codex.impl.last.md
 create mode 100644 .logs/Q07-01.codex.impl.raw.txt
 create mode 100644 .logs/Q07-01.gitcommit.txt
 create mode 100644 .logs/Q07-02.codex.impl.last.md
 create mode 100644 .logs/Q07-02.codex.impl.raw.txt
 create mode 100644 .plans/Q07-02.md
 create mode 100644 .t2/handoff/Q07-02.md

husky - DEPRECATED

Please remove the following two lines from .husky/pre-commit:

#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

They WILL FAIL in v10.0.0

[STARTED] Backing up original state...
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+





thinking
**Evaluating commit logs**

I'm considering the untracked log output of a commit. I think it might create unnecessary noise, especially since the user tasks focus on Q07-03. It could be better to keep the git status clean by removing unrelated commit logs. Although it seems like it won't show in the final patch, leaving it might still affect file system modifications. Since it's untracked and not part of the repository, I believe removing it would help avoid any stray files.
thinking
**Considering untracked files**

I'm thinking about the untracked file `.logs/Q07-02.gitcommit.txt`. While it might have useful info, it's not something the user specifically requested. They focus on implementing Q07-03, and if they run `git status`, they might get curious about that untracked file. I’d prefer to remove it. There are also untracked spec files like `.plans/Q07-03.md` and `.t2/handoff/Q07-03.md`, which may be expected since they're used for tasks. These could stay untracked, but I wonder if I should add them to git.
thinking
**Deciding on file tracking**

For Q07-03, I think the user expects `.plans/Q07-03.md` and `.t2/handoff/Q07-03.md` to be created in the process, but they’re currently untracked. They might want to read these files as part of the tasks, even if it's unclear whether they should be tracked. The user didn't specify to track or commit them. However, we have a new test file that's untracked but should be included in the final patch. It seems it's okay that it's untracked for now.
thinking
**Inspecting file modifications**

I'm thinking about the modifications made to `t2/state.json`. It seems they might have been automated by the harness, and I'm considering whether we should revert to the original version to minimize any unnecessary noise. It’s a good idea to inspect the differences first. Understanding the changes will help me decide if reverting is the best option for clarity and organization. Let’s check out that diff!
exec
/bin/zsh -lc 'git diff -- .t2/state.json | head -n 80' in /Users/ahmedyounis/Documents/Projects/wp-admin-health-suite succeeded in 56ms:
diff --git a/.t2/state.json b/.t2/state.json
index 9b0f07d..7410f19 100644
--- a/.t2/state.json
+++ b/.t2/state.json
@@ -38,7 +38,8 @@
     "Q06-05",
     "Q06-06",
     "Q06-07",
-    "Q07-01"
+    "Q07-01",
+    "Q07-02"
   ],
   "claude_sessions": {
     "Q01-01": "5e05e067-351c-42d8-b76a-fe63b7a2bad5",
@@ -77,5 +78,5 @@
     "Q06-03": "b059f094-5965-49ed-bfb1-6d207b7daf67"
   },
   "gemini_sessions": {},
-  "updated_at": "2026-01-17T06:39:29.131150Z"
+  "updated_at": "2026-01-17T06:39:35.203819Z"
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+






thinking
**Considering task state changes**

So, it looks like the state JSON changed to include Q07-02 in completed_tasks and updated_at, which seems normal for tracking. Our task, Q07-03, didn't specify an update, but leaving it might be okay. However, this tracking could create noise. It seems likely that the harness updates it automatically when tasks start, which might mean reverting isn't necessary. Since it's a minor change and part of the system, maybe leaving it is acceptable.
thinking
**Evaluating patch implications**

I think the patch might create some noise, but the user didn’t specifically request not to update. It seems like the state file should ideally reflect completed tasks, but it’s complicated. Also, the files under `.plans/Q07-03.md` and `.t2/handoff/Q07-03.md` are untracked, and maybe leaving them that way is fine. I should check if our modifications need an update to `tests/bootstrap-standalone.php` or other stubs. 

Now, we should ensure there are no linting issues, and in the final response, we’ll mark it as DONE. I must consider the risk of changing integer sanitization—it might affect all integer settings. Previously, -1 could become 1, and now it might mean a different value, which could be an improvement but potentially problematic for unusual inputs. Let's mention that!
thinking
**Reviewing cleanup task adjustments**

The DatabaseCleanupTask now utilizes `get_posts` for auto drafts and the functions `gmdate` and `strtotime`, ensuring that WordPress is loaded. The scheduled transients cleanup will now respect excluded transient prefixes, which could reduce the cleanup if specified by the user. The trash cleanup process now considers retention days and has separate toggles for posts and comments. Previously, enabling cleanup_trashed_posts would delete everything, but now it’s more granular and requires retention days to be greater than zero.

However, if the user has cleanup_trashed_posts set to true but auto_clean_trash_days at zero, the task won’t run, which is a notable change. This might seem correct since it indicates a disabled state, but the user could expect deletion without realizing they need to set the days. I’ll mention this as a potential risk and ensure the UI makes it clear that retention days must be greater than zero.
thinking
**Confirming cleanup settings adjustments**

We’ve added a checkbox description that references retention, which is a positive step! For spam, it also requires retention days to be greater than zero; otherwise, if users enable cleanup_spam_comments but leave the days at zero, there won't be any scheduled deletion. The description should clarify this.

The auto drafts cleanup is set to delete entries older than 7 days, even without a retention setting, which might be acceptable. 

We’ve also replaced the `cleanup_orphaned_metadata` field in the settings UI with `orphaned_cleanup_enabled`, ensuring old values are migrated correctly. Existing installations may still show the old key but will reflect the new value in the UI if it's set properly. The scheduled tasks are working correctly with this migration, so everything seems fine!
thinking
**Crafting final response**

I noticed that the SettingsRegistry's `sanitize_settings` function migrates input and stored values, which is great. I checked for any code using the old `cleanup_orphaned_metadata` key, but there were none, so that’s fine. 

Now, we’ve added new settings schema options in the DatabaseCleanupTask, but they aren't used elsewhere, so that’s safe. Regarding the `wp_strip_all_tags` stub, it checks function existence and is also safe.

For the final output, I’ll include the exact verification commands, as the user requested: `npm run lint` and `npm test`. I’ll provide a summary of changes clearly segmented, and mention that lint outputs warnings but still passes. 

Here’s how I’ll structure it:

**Status:** DONE  

**Summary of changes:**  
- Updated Database settings domain: revised defaults, replaced orphaned cleanup key, added descriptions, validated excluded transient prefixes.  
- Improved settings sanitization: integer handling clamped for negatives/blank, new newline_list sanitizer, migrated legacy keys.  
- Updated DatabaseCleanupTask: uses orphaned_cleanup_enabled, respects retention days, added auto-drafts cleanup (older than 7 days).  
- Added standalone tests for SettingsRegistry sanitization; added wp_strip_all_tags stub.  

**How to verify:**  
- `npm run lint`  
- `npm test`  

Optionally: `./vendor/bin/phpunit -c phpunit-standalone.xml`. 

**Risks / follow-ups:**  
- Scheduled trash/spam cleanup requires retention days >0; confirm intended behavior.  
- Auto-drafts retention is fixed at 7 days; consider making this configurable.  
- Global integer sanitization behavior changed; ensure no other settings relied on previous behavior.  
- Legacy key migration included; can remove once all installs are migrated.  

I'll also mention that lint warnings are pre-existing. This should keep everything clear and concise!
codex
Status: DONE

Summary of changes:
- Updated database cleanup settings: safer defaults (`revisions_to_keep` now defaults to 5), clarified field descriptions, switched orphaned cleanup to `orphaned_cleanup_enabled`, and added stricter sanitization for `excluded_transient_prefixes` (`newline_list`, max 100). (`includes/Settings/Domain/DatabaseSettings.php`)
- Improved settings validation globally: integer inputs now clamp correctly (no more `-1` becoming `1`), added `newline_list` sanitizer, and migrated legacy `cleanup_orphaned_metadata` → `orphaned_cleanup_enabled`. (`includes/Settings/SettingsRegistry.php`)
- Aligned scheduled database cleanup behavior with settings: scheduled transients cleanup honors excluded prefixes; spam/trash cleanup honors retention days and per-type toggles; added auto-drafts cleanup (older than 7 days by default) and extended task schema for manual overrides. (`includes/Database/Tasks/DatabaseCleanupTask.php`)
- Added standalone coverage for the new sanitization + migration behavior and a missing stub used by the new sanitizer. (`tests/unit-standalone/Settings/SettingsRegistryTest.php`, `tests/bootstrap-standalone.php`)

How to verify:
- `npm run lint`
- `npm test`

Risks / follow-ups:
- Scheduled trash/spam cleanup now only runs when the corresponding retention days setting is `> 0`; if someone previously relied on “delete everything” behavior, they’ll need to set retention days or run manually.
- Auto-drafts cleanup uses a fixed 7-day threshold; consider making this configurable if needed.
- Integer sanitization behavior changed globally (negative/non-numeric now clamps to min/default instead of `absint` behavior); worth a quick spot-check of any settings that might have depended on the old behavior.
file update:
diff --git a/includes/Database/Tasks/DatabaseCleanupTask.php b/includes/Database/Tasks/DatabaseCleanupTask.php
index 44aada3aa63df132ff7f1af0bf70a3117cb7dae0..9d07a4f09eb1372d71d08b7439e5d7a5487d2286
--- a/includes/Database/Tasks/DatabaseCleanupTask.php
+++ b/includes/Database/Tasks/DatabaseCleanupTask.php
@@ -75,7 +75,7 @@
 	 *
 	 * @var string
 	 */
-	protected string $description = 'Clean up revisions, transients, orphaned metadata, and trash items.';
+	protected string $description = 'Clean up revisions, transients, orphaned metadata, trash, spam comments, and auto-drafts.';
 
 	/**
 	 * Default frequency.
@@ -338,13 +338,36 @@
 		if ( ! empty( $settings['cleanup_expired_transients'] ) || ! empty( $options['clean_transients'] ) ) {
 			$cleanup_tasks[] = 'transients';
 		}
-		if ( ! empty( $settings['cleanup_orphaned_metadata'] ) || ! empty( $options['clean_orphaned'] ) ) {
+		if (
+			! empty( $settings['orphaned_cleanup_enabled'] )
+			|| ! empty( $settings['cleanup_orphaned_metadata'] )
+			|| ! empty( $options['clean_orphaned'] )
+		) {
 			$cleanup_tasks[] = 'orphaned';
 		}
-		if ( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $options['clean_trash'] ) ) {
+
+		$trash_retention_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+		$spam_retention_days  = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+		$trash_cleanup_enabled = (
+			( ! empty( $settings['cleanup_trashed_posts'] ) || ! empty( $settings['cleanup_trashed_comments'] ) )
+			&& $trash_retention_days > 0
+		);
+
+		$spam_cleanup_enabled = ( ! empty( $settings['cleanup_spam_comments'] ) && $spam_retention_days > 0 );
+
+		if ( $spam_cleanup_enabled || ! empty( $options['clean_spam'] ) ) {
+			$cleanup_tasks[] = 'spam';
+		}
+
+		if ( $trash_cleanup_enabled || ! empty( $options['clean_trash'] ) ) {
 			$cleanup_tasks[] = 'trash';
 		}
 
+		if ( ! empty( $settings['cleanup_auto_drafts'] ) || ! empty( $options['clean_auto_drafts'] ) ) {
+			$cleanup_tasks[] = 'auto_drafts';
+		}
+
 		return $cleanup_tasks;
 	}
 
@@ -540,7 +563,12 @@
 				break;
 
 			case 'transients':
-				$cleaned = $this->transients_cleaner->delete_expired_transients();
+				$settings = get_option( 'wpha_settings', array() );
+				$excluded = isset( $settings['excluded_transient_prefixes'] ) ? (string) $settings['excluded_transient_prefixes'] : '';
+				$excluded = str_replace( array( "\r\n", "\r" ), "\n", $excluded );
+
+				$exclude_patterns = array_filter( array_map( 'trim', explode( "\n", $excluded ) ) );
+				$cleaned          = $this->transients_cleaner->delete_expired_transients( $exclude_patterns );
 				$result['items'] = $cleaned['deleted'] ?? 0;
 				$result['bytes'] = $cleaned['bytes_freed'] ?? 0;
 				$this->log( sprintf( 'Cleaned %d transients', $result['items'] ) );
@@ -557,12 +585,107 @@
 				$this->log( sprintf( 'Cleaned %d orphaned items', $result['items'] ) );
 				break;
 
+			case 'spam':
+				$settings        = get_option( 'wpha_settings', array() );
+				$older_than_days = absint( $settings['auto_clean_spam_days'] ?? 0 );
+
+				if ( ! empty( $options['clean_spam'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( empty( $options['clean_spam'] ) && $older_than_days <= 0 ) {
+					$this->log( 'Skipping spam cleanup (retention disabled)' );
+					break;
+				}
+
+				$cleaned = $this->trash_cleaner->delete_spam_comments( $older_than_days );
+				$result['items'] = $cleaned['deleted'] ?? 0;
+				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
+				$this->log( sprintf( 'Cleaned %d spam comments', $result['items'] ) );
+				break;
+
 			case 'trash':
-				$cleaned = $this->trash_cleaner->empty_all_trash();
-				$result['items'] = ( $cleaned['posts_deleted'] ?? 0 ) + ( $cleaned['comments_deleted'] ?? 0 );
+				$settings = get_option( 'wpha_settings', array() );
+
+				$older_than_days = absint( $settings['auto_clean_trash_days'] ?? 0 );
+				$clean_posts     = ! empty( $settings['cleanup_trashed_posts'] );
+				$clean_comments  = ! empty( $settings['cleanup_trashed_comments'] );
+
+				// For manual/task overrides, allow emptying all trash and/or specifying a threshold.
+				if ( ! empty( $options['clean_trash'] ) ) {
+					$older_than_days = isset( $options['older_than_days'] ) ? absint( $options['older_than_days'] ) : 0;
+					$clean_posts     = true;
+					$clean_comments  = true;
+				}
+
+				if ( $older_than_days <= 0 && empty( $options['clean_trash'] ) ) {
+					$this->log( 'Skipping trash cleanup (retention disabled)' );
+					break;
+				}
+
+				$deleted = 0;
+
+				if ( $clean_posts ) {
+					$posts_result = $this->trash_cleaner->delete_trashed_posts( array(), $older_than_days );
+					$deleted     += $posts_result['deleted'] ?? 0;
+				}
+
+				if ( $clean_comments ) {
+					$comments_result = $this->trash_cleaner->delete_trashed_comments( $older_than_days );
+					$deleted        += $comments_result['deleted'] ?? 0;
+				}
+
+				$result['items'] = $deleted;
 				$result['bytes'] = 0; // Trash cleaner doesn't track bytes.
 				$this->log( sprintf( 'Cleaned %d trash items', $result['items'] ) );
 				break;
+
+			case 'auto_drafts':
+				$older_than_days = 7;
+
+				if ( ! empty( $options['clean_auto_drafts'] ) && isset( $options['older_than_days'] ) ) {
+					$older_than_days = absint( $options['older_than_days'] );
+				}
+
+				if ( $older_than_days <= 0 ) {
+					$older_than_days = 0;
+				}
+
+				$before = gmdate( 'Y-m-d H:i:s', strtotime( "-{$older_than_days} days" ) );
+
+				$post_ids = get_posts(
+					array(
+						'post_type'      => 'any',
+						'post_status'    => 'auto-draft',
+						'posts_per_page' => 200,
+						'fields'         => 'ids',
+						'orderby'        => 'ID',
+						'order'          => 'ASC',
+						'date_query'     => array(
+							array(
+								'column' => 'post_modified_gmt',
+								'before' => $before,
+							),
+						),
+					)
+				);
+
+				if ( empty( $post_ids ) ) {
+					$this->log( 'No auto-drafts to clean' );
+					break;
+				}
+
+				$deleted = 0;
+				foreach ( $post_ids as $post_id ) {
+					if ( wp_delete_post( (int) $post_id, true ) ) {
+						++$deleted;
+					}
+				}
+
+				$result['items'] = $deleted;
+				$result['bytes'] = 0;
+				$this->log( sprintf( 'Cleaned %d auto-drafts', $result['items'] ) );
+				break;
 		}
 
 		return $result;
@@ -600,6 +723,23 @@
 				'default'     => false,
 				'description' => __( 'Empty trash', 'wp-admin-health-suite' ),
 			),
+			'clean_spam'         => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete spam comments', 'wp-admin-health-suite' ),
+			),
+			'clean_auto_drafts'  => array(
+				'type'        => 'boolean',
+				'default'     => false,
+				'description' => __( 'Delete auto-drafts', 'wp-admin-health-suite' ),
+			),
+			'older_than_days'    => array(
+				'type'        => 'integer',
+				'default'     => 0,
+				'min'         => 0,
+				'max'         => 365,
+				'description' => __( 'Age threshold in days for trash/spam/auto-drafts when manually running the task (0 = all).', 'wp-admin-health-suite' ),
+			),
 			'optimize_tables'    => array(
 				'type'        => 'boolean',
 				'default'     => false,
diff --git a/includes/Settings/Domain/DatabaseSettings.php b/includes/Settings/Domain/DatabaseSettings.php
index 1625d1927a694978ffde6e47a1d720e3b20b9182..aa234ecec68ab1983cdad5bd7d309d86bb553600
--- a/includes/Settings/Domain/DatabaseSettings.php
+++ b/includes/Settings/Domain/DatabaseSettings.php
@@ -51,6 +51,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will prune post revisions based on the "Revisions to Keep" setting.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_auto_drafts'         => array(
 				'section'  => 'database_cleanup',
@@ -58,6 +59,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete auto-draft posts older than 7 days.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_posts'       => array(
 				'section'  => 'database_cleanup',
@@ -65,6 +67,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed posts older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_spam_comments'       => array(
 				'section'  => 'database_cleanup',
@@ -72,6 +75,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete spam comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_trashed_comments'    => array(
 				'section'  => 'database_cleanup',
@@ -79,6 +83,7 @@
 				'type'     => 'checkbox',
 				'default'  => false,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will delete trashed comments older than the configured retention period.', 'wp-admin-health-suite' ),
 			),
 			'cleanup_expired_transients'  => array(
 				'section'  => 'database_cleanup',
@@ -86,21 +91,23 @@
 				'type'     => 'checkbox',
 				'default'  => true,
 				'sanitize' => 'boolean',
+				'description' => __( 'When enabled, scheduled cleanup will remove expired transients (honoring any excluded prefixes).', 'wp-admin-health-suite' ),
 			),
-			'cleanup_orphaned_metadata'   => array(
-				'section'  => 'database_cleanup',
-				'title'    => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
-				'type'     => 'checkbox',
-				'default'  => false,
-				'sanitize' => 'boolean',
+			'orphaned_cleanup_enabled'    => array(
+				'section'     => 'database_cleanup',
+				'title'       => __( 'Clean Orphaned Metadata', 'wp-admin-health-suite' ),
+				'type'        => 'checkbox',
+				'default'     => false,
+				'sanitize'    => 'boolean',
+				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 			'revisions_to_keep'           => array(
 				'section'     => 'database_cleanup',
 				'title'       => __( 'Revisions to Keep', 'wp-admin-health-suite' ),
 				'type'        => 'number',
-				'default'     => 0,
+				'default'     => 5,
 				'sanitize'    => 'integer',
-				'description' => __( 'Number of revisions to keep per post (0-50, 0 = delete all).', 'wp-admin-health-suite' ),
+				'description' => __( 'Number of revisions to keep per post (0-50). Set to 0 to delete all revisions.', 'wp-admin-health-suite' ),
 				'min'         => 0,
 				'max'         => 50,
 			),
@@ -129,7 +136,8 @@
 				'title'       => __( 'Excluded Transient Prefixes', 'wp-admin-health-suite' ),
 				'type'        => 'textarea',
 				'default'     => '',
-				'sanitize'    => 'textarea',
+				'sanitize'    => 'newline_list',
+				'max_items'   => 100,
 				'description' => __( 'Transient prefixes to exclude from cleanup (one per line).', 'wp-admin-health-suite' ),
 			),
 			'optimize_tables_weekly'      => array(
@@ -139,14 +147,6 @@
 				'default'     => false,
 				'sanitize'    => 'boolean',
 				'description' => __( 'Automatically optimize database tables weekly.', 'wp-admin-health-suite' ),
-			),
-			'orphaned_cleanup_enabled'    => array(
-				'section'     => 'database_cleanup',
-				'title'       => __( 'Enable Orphaned Cleanup', 'wp-admin-health-suite' ),
-				'type'        => 'checkbox',
-				'default'     => false,
-				'sanitize'    => 'boolean',
-				'description' => __( 'Automatically clean orphaned metadata during scheduled tasks.', 'wp-admin-health-suite' ),
 			),
 		);
 	}
diff --git a/includes/Settings/SettingsRegistry.php b/includes/Settings/SettingsRegistry.php
index a5d7e8fb6e61d27034cf59efe2708100978ea99e..6bc76a4be7b11cee40b55cc4abc9f317eb325359
--- a/includes/Settings/SettingsRegistry.php
+++ b/includes/Settings/SettingsRegistry.php
@@ -98,6 +98,8 @@
 			$settings = array();
 		}
 
+		$settings = $this->migrate_legacy_settings( $settings );
+
 		// Only keep known setting keys to prevent option injection and stale keys.
 		$known_fields = $this->get_all_fields();
 		if ( ! empty( $known_fields ) ) {
@@ -268,6 +270,9 @@
 			$stored = array();
 		}
 
+		$input  = $this->migrate_legacy_settings( $input );
+		$stored = $this->migrate_legacy_settings( $stored );
+
 		foreach ( $fields as $field_id => $field ) {
 			$has_input_value = array_key_exists( $field_id, $input );
 			$value           = null;
@@ -355,12 +360,16 @@
 				return null === $bool ? (bool) $default : $bool;
 
 			case 'integer':
-				$int = absint( $value );
+				if ( null === $value || '' === $value ) {
+					$value = $default;
+				}
+
+				$int = is_numeric( $value ) ? (int) $value : (int) $default;
 				if ( isset( $field['min'] ) && $int < $field['min'] ) {
-					$int = $field['min'];
+					$int = (int) $field['min'];
 				}
 				if ( isset( $field['max'] ) && $int > $field['max'] ) {
-					$int = $field['max'];
+					$int = (int) $field['max'];
 				}
 				return $int;
 
@@ -380,6 +389,39 @@
 			case 'css':
 				return $this->sanitize_css( (string) $value );
 
+			case 'newline_list':
+				if ( null === $value ) {
+					return (string) $default;
+				}
+
+				$raw = wp_strip_all_tags( (string) $value );
+				$raw = str_replace( array( "\r\n", "\r" ), "\n", $raw );
+
+				$items = array_map( 'trim', explode( "\n", $raw ) );
+				$items = array_filter( $items, 'strlen' );
+
+				$sanitized_items = array();
+				foreach ( $items as $item ) {
+					$item = sanitize_text_field( $item );
+					$item = preg_replace( '/\s+/', '', $item );
+					$item = trim( $item );
+
+					if ( '' === $item ) {
+						continue;
+					}
+
+					$sanitized_items[] = $item;
+				}
+
+				$sanitized_items = array_values( array_unique( $sanitized_items ) );
+
+				$max_items = isset( $field['max_items'] ) ? absint( $field['max_items'] ) : 100;
+				if ( $max_items > 0 ) {
+					$sanitized_items = array_slice( $sanitized_items, 0, $max_items );
+				}
+
+				return implode( "\n", $sanitized_items );
+
 			case 'textarea':
 				return sanitize_textarea_field( (string) $value );
 
@@ -390,6 +432,25 @@
 	}
 
 	/**
+	 * Migrate legacy settings keys to current keys.
+	 *
+	 * @since 1.5.0
+	 *
+	 * @param array $settings Raw settings.
+	 * @return array Settings with legacy keys migrated.
+	 */
+	private function migrate_legacy_settings( array $settings ): array {
+		if (
+			! array_key_exists( 'orphaned_cleanup_enabled', $settings )
+			&& array_key_exists( 'cleanup_orphaned_metadata', $settings )
+		) {
+			$settings['orphaned_cleanup_enabled'] = (bool) $settings['cleanup_orphaned_metadata'];
+		}
+
+		return $settings;
+	}
+
+	/**
 	 * Convert a field definition to a JSON schema fragment.
 	 *
 	 * @param array $field Field definition.
diff --git a/tests/bootstrap-standalone.php b/tests/bootstrap-standalone.php
index c21a691e8124e6f03f5c8d25bfb5d23b619aef5c..412121fcb655495ae3a14bd23d362740666adfed
--- a/tests/bootstrap-standalone.php
+++ b/tests/bootstrap-standalone.php
@@ -140,6 +140,25 @@
 	}
 }
 
+if ( ! function_exists( 'wp_strip_all_tags' ) ) {
+	/**
+	 * Strip all HTML tags from text stub.
+	 *
+	 * @param string $text          Text to strip.
+	 * @param bool   $remove_breaks Whether to remove line breaks.
+	 * @return string
+	 */
+	function wp_strip_all_tags( $text, $remove_breaks = false ) {
+		$text = strip_tags( (string) $text );
+
+		if ( $remove_breaks ) {
+			$text = preg_replace( '/[\r\n\t ]+/', ' ', $text );
+		}
+
+		return trim( $text );
+	}
+}
+
 if ( ! function_exists( 'absint' ) ) {
 	/**
 	 * Absolute integer stub.
diff --git a/tests/unit-standalone/Settings/SettingsRegistryTest.php b/tests/unit-standalone/Settings/SettingsRegistryTest.php
new file mode 100644
index 0000000000000000000000000000000000000000..73a249e1a35c3b2e2a13ff0383140fe5de99876c
--- /dev/null
+++ b/tests/unit-standalone/Settings/SettingsRegistryTest.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * SettingsRegistry standalone tests.
+ *
+ * @package WPAdminHealth\Tests
+ */
+
+namespace WPAdminHealth\Tests\Settings;
+
+use WPAdminHealth\Settings\SettingsRegistry;
+use WPAdminHealth\Settings\Domain\DatabaseSettings;
+use WPAdminHealth\Tests\StandaloneTestCase;
+
+class SettingsRegistryTest extends StandaloneTestCase {
+
+	public function test_sanitize_settings_migrates_legacy_orphaned_key(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'cleanup_orphaned_metadata' => '1',
+			)
+		);
+
+		$this->assertArrayHasKey( 'orphaned_cleanup_enabled', $sanitized );
+		$this->assertTrue( $sanitized['orphaned_cleanup_enabled'] );
+		$this->assertArrayNotHasKey( 'cleanup_orphaned_metadata', $sanitized );
+	}
+
+	public function test_sanitize_settings_clamps_integer_values(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'revisions_to_keep'    => '-1',
+				'auto_clean_trash_days' => 999,
+				'auto_clean_spam_days'  => '-5',
+			)
+		);
+
+		$this->assertSame( 0, $sanitized['revisions_to_keep'] );
+		$this->assertSame( 365, $sanitized['auto_clean_trash_days'] );
+		$this->assertSame( 0, $sanitized['auto_clean_spam_days'] );
+	}
+
+	public function test_sanitize_settings_normalizes_newline_list(): void {
+		$registry = new SettingsRegistry();
+		$registry->register( new DatabaseSettings() );
+
+		$sanitized = $registry->sanitize_settings(
+			array(
+				'excluded_transient_prefixes' => "  wc_\r\nwc_\n  my prefix \n\n",
+			)
+		);
+
+		$this->assertSame( "wc_\nmyprefix", $sanitized['excluded_transient_prefixes'] );
+	}
+}
+

tokens used
166,203
