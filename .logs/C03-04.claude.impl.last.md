---

## Status: DONE

## Summary of Changes

**Task C03-04: Standardize cache keys and migrate Analyzer caching**

Created a centralized cache key convention and migrated the Database Analyzer from direct WordPress transient usage to the `CacheInterface` abstraction.

### Files Created

1. **`includes/Support/CacheKeys.php`**
   - Central registry for all cache keys used across the plugin
   - TTL constants: `DEFAULT_TTL` (300s), `SHORT_TTL` (60s), `LONG_TTL` (3600s)
   - Domain-prefixed key constants: `db_`, `perf_`, `media_`
   - Utility methods: `get_all_keys()`, `get_keys_by_prefix()`, `get_ttl()`, `with_suffix()`, `is_valid_key()`

2. **`includes/Support/index.php`**
   - Directory index file

3. **`tests/unit-standalone/Support/CacheKeysTest.php`**
   - 17 tests covering constants, naming conventions, uniqueness, and utility methods

4. **`tests/unit-standalone/Database/AnalyzerCacheTest.php`**
   - 8 tests covering cache hit/miss behavior, key naming, TTL expiration, and `clear_cache()`

### Files Modified

1. **`includes/Database/Analyzer.php`**
   - Migrated from direct `get_transient()`/`set_transient()` to `CacheInterface`
   - Constructor now accepts `CacheInterface $cache` as second parameter
   - Uses `CacheKeys` constants for consistent key naming
   - Added `clear_cache()` method to clear both in-memory and persistent caches
   - Preserved TTL semantics using `CacheKeys::get_ttl()`

2. **`includes/Providers/DatabaseServiceProvider.php`**
   - Updated Analyzer binding to inject `CacheInterface` from the container

## How to Verify

```bash
# Run JavaScript tests
npm test

# Run PHP linting
npm run lint

# Run new cache-related tests specifically
./vendor/bin/phpunit --configuration phpunit-standalone.xml tests/unit-standalone/Support/CacheKeysTest.php tests/unit-standalone/Database/AnalyzerCacheTest.php
```

## Risks / Follow-ups

1. **Low risk**: Existing code using `Analyzer` through the DI container will work unchanged since `CacheInterface` is already registered
2. **Note**: Pre-existing lint warnings (158) remain but are unrelated to these changes
3. **Optional**: Other classes using direct transient calls could be migrated to use `CacheKeys` in future tasks
4. **Memory issue**: Full standalone test suite hits memory limits (~134MB) - this is a pre-existing issue unrelated to these changes
