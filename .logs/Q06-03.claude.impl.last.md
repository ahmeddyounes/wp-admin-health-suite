---

**Status: DONE**

## Summary of Changes

Reviewed `includes/REST/DatabaseController.php` and `includes/REST/Database/` controllers for input validation, permission checks, and error responses.

### Files Modified:

1. **`includes/REST/Database/CleanupController.php`**:
   - Added `validate_callback` to `keep_per_post` argument (line 165)
   - Added `validate_callback` to `expired_only` argument (line 186)
   - Added `sanitize_callback` and `validate_callback` to `exclude_patterns` argument (lines 193-194)
   - Added `validate_callback` to `older_than_days` argument for spam endpoint (line 217)
   - Added `validate_callback` to `older_than_days` argument for trash endpoint (line 240)
   - Added `sanitize_callback` and `validate_callback` to `post_types` argument (lines 247-248)
   - Added `sanitize_callback` and `validate_callback` to `types` argument for orphaned cleanup (lines 273-274)
   - Added three new sanitization methods:
     - `sanitize_string_array()` - sanitizes generic string arrays
     - `sanitize_post_types()` - validates against registered post types to prevent injection
     - `sanitize_orphaned_types()` - validates against allowed orphaned data types

2. **`includes/REST/Database/OptimizationController.php`**:
   - Replaced inline closure with proper `sanitize_table_names` method reference for optimize endpoint (line 102)
   - Added `validate_callback` to `tables` argument for optimize endpoint (line 103)
   - Replaced inline closure with proper `sanitize_table_names` method reference for repair endpoint (line 125)
   - Added `validate_callback` to `tables` argument for repair endpoint (line 126)
   - Added `sanitize_table_names()` method that validates table names against WordPress prefix to prevent arbitrary table access (lines 343-374)

## How to Verify

```bash
npm run lint   # Should pass with only warnings (no errors)
npm test       # Should pass all 101 tests
```

## Risks / Follow-ups

- **Low risk**: The changes add stricter input validation which could theoretically reject previously-accepted malformed input, but this is the correct security behavior.
- **Note**: The main `DatabaseController.php` already had proper validation and sanitization callbacks - no changes needed there.
- **Note**: `TableAnalysisController.php` only has read-only endpoints with properly validated `limit` parameter - no changes needed there.
