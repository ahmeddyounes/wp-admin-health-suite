---

## Status: DONE

## Summary of Changes

Refactored the service-locator pattern usage throughout the codebase:

### Container-Managed Services (fallbacks removed)

1. **`includes/Media/Exclusions.php`** - Simplified `get_settings()` to return the injected instance directly (no container lookup)

2. **`includes/REST/RestController.php`** - Changed `get_settings()` and `get_connection()` to throw `RuntimeException` if dependencies not injected (enforces DI)

3. **`includes/Performance/HeartbeatController.php`** - Made `SettingsInterface` required in constructor (removed nullable)

### Edge Adapters (documented, fallbacks kept)

4. **`includes/Settings.php`** - Documented as edge adapter (template facade) - templates instantiate directly

5. **`includes/Installer.php`** - Documented as edge adapter - runs during activation before container is available

6. **`includes/BatchProcessor.php`** - Documented as edge adapter - static utility methods can't receive constructor injection

### Documentation

7. **`docs/developers/edge-adapters.md`** - New file documenting:
   - Edge adapter pattern and rationale
   - List of all edge adapters with explanations
   - List of refactored container-managed classes
   - Guidelines for new code

8. **`templates/admin/settings.php`** - Added comment explaining Settings facade usage

## How to Verify

```bash
npm run lint    # 0 errors (161 warnings pre-existing)
npm test        # 417 tests pass
```

## Risks / Follow-ups

- **RuntimeException in REST controllers**: If someone instantiates `RestController` subclasses outside the container without injecting dependencies, they'll get a clear error message directing them to use `RESTServiceProvider`
- **Edge adapters**: The 3 documented edge adapters (`Settings`, `Installer`, `BatchProcessor`) legitimately need fallbacks due to WordPress lifecycle constraints
- **Future consideration**: The template rendering could eventually be moved to a dedicated service if `render_field()` is added to `SettingsInterface`, but this would require template changes
