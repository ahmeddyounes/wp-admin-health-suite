---

## Status: DONE

## Summary of Changes

I reviewed and fixed issues in `includes/AI/Recommendations.php`:

### Issues Fixed:

1. **PHPStan Error - `scan_all_media()` method not in interface** (`includes/AI/Recommendations.php:407`)
   - Changed `get_media_stats()` to use `get_media_summary()` from `ScannerInterface` instead of the non-interface `scan_all_media()` method
   - Added a new `normalize_media_stats()` method to handle key name differences between:
     - Cached results (uses `large_files_count`, `missing_alt_count`)
     - Interface method (uses `large_count`, doesn't have `missing_alt_count`)

2. **DocBlock indentation issues** (lines 200-201, 274-275, 297-298)
   - Fixed `@since` tag indentation in `prioritize_issues()`, `get_actionable_steps()`, and `dismiss_recommendation()` methods

3. **Orphaned tables logic bug** (`includes/AI/Recommendations.php:375`)
   - Changed `get_all_wp_tables()` (which returns ALL tables with WP prefix) to `find_orphaned_tables()` (which correctly identifies orphaned tables only)

4. **Updated PHPStan baseline** (`phpstan-baseline.neon`)
   - Removed the now-fixed baseline entry for `scan_all_media()` method

## How to Verify

```bash
# Run lint (passes with warnings only)
npm run lint

# Run tests (all 101 tests pass)
npm test

# Run PHPStan on Recommendations.php (no errors)
vendor/bin/phpstan analyse includes/AI/Recommendations.php --memory-limit=1G
```

## Risks / Follow-ups

1. **Interface Coverage**: The `ScannerInterface::get_media_summary()` doesn't include `missing_alt_count`. The `normalize_media_stats()` method defaults this to 0 when not available from the interface. If missing alt text recommendations are critical, consider:
   - Adding a `get_missing_alt_count()` method to `ScannerInterface`, OR
   - Using the cached scan results which include this data

2. **Orphaned Tables Detection**: The fix now properly uses `find_orphaned_tables()` which returns detailed orphaned table information (arrays with metadata). The code doesn't currently generate recommendations based on orphaned tables, but the data is now correctly available for future use.
