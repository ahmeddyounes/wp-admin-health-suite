The changes for C02-08 are:
1. `includes/Admin/SettingsViewModel.php` - New file (untracked)
2. `includes/Admin/PageRenderer.php` - Modified (AM status indicates new in index + working tree modifications)
3. `includes/Providers/BootstrapServiceProvider.php` - Modified (MM status indicates index + working tree modifications)
4. `templates/admin/settings.php` - Modified (MM status)

Let me provide the final summary.

---

## Status: DONE

## Summary of Changes

This implementation addresses **C02-08: Clean up legacy Settings facade usage** by introducing a view model pattern that eliminates service location in templates while keeping the Settings facade for backward compatibility.

### Files Created

1. **`includes/Admin/SettingsViewModel.php`** (new)
   - A container-managed view model that provides template-ready data for the settings page
   - Wraps `SettingsInterface` and provides `render_field()` for HTML generation
   - Designed to be injected via dependency injection rather than instantiated directly in templates
   - Includes `get_template_data()` method for bundling all settings data

### Files Modified

2. **`includes/Admin/PageRenderer.php`**
   - Added optional `SettingsViewModel` dependency to constructor
   - Updated `render_settings()` to pass `$settings_obj` to the template when view model is available
   - Maintains backward compatibility if view model is not injected

3. **`includes/Providers/BootstrapServiceProvider.php`**
   - Added `SettingsViewModel::class` to `$provides` array
   - Registered `SettingsViewModel` as a singleton with `SettingsInterface` injection
   - Updated `PageRenderer` binding to inject `SettingsViewModel`
   - Added `admin.settings_view_model` alias

4. **`templates/admin/settings.php`**
   - Updated to check for injected `$settings_obj` (SettingsViewModel) first
   - Falls back to instantiating `Settings` facade only if no view model is available
   - Added deprecation comment on the fallback path
   - Maintains full backward compatibility

### Architecture

```
Container (SettingsInterface)
    ↓ injected into
SettingsViewModel
    ↓ injected into  
PageRenderer
    ↓ passes as $settings_obj to
settings.php template
```

The Settings facade (`includes/Settings.php`) remains untouched and available for any legacy code that may need it.

## How to Verify

```bash
# PHP syntax check
php -l includes/Admin/SettingsViewModel.php
php -l includes/Admin/PageRenderer.php
php -l includes/Providers/BootstrapServiceProvider.php
php -l templates/admin/settings.php

# PHP CodeSniffer (new PHP files only)
./vendor/bin/phpcs --standard=phpcs.xml includes/Admin/SettingsViewModel.php includes/Admin/PageRenderer.php includes/Providers/BootstrapServiceProvider.php

# Standalone PHP unit tests
./vendor/bin/phpunit -c phpunit-standalone.xml --no-coverage

# JS lint and tests
npm run lint
npm test
```

## Risks / Follow-ups

1. **Template variable scope**: The template checks for `$settings_obj instanceof \WPAdminHealth\Admin\SettingsViewModel` - this works correctly due to how `PageRenderer::render()` uses `extract()` to pass data

2. **Pre-existing phpcs errors**: The `templates/admin/settings.php` file has pre-existing phpcs violations (non-prefixed global variables, Yoda conditions) that existed before this change and are unrelated to this task

3. **Future cleanup**: The fallback path in the template (instantiating Settings facade) can be removed in a future major version once all integrations use the injected view model

4. **Other services**: `HeartbeatController` and `Installer` were audited and already properly use `SettingsInterface` via DI - no changes needed
