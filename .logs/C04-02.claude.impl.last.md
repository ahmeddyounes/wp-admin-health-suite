---

**Status: DONE**

## Summary of Changes

### 1. Updated `includes/Assets.php` (line 245)
- Added `'debug' => defined( 'WP_DEBUG' ) && WP_DEBUG` to the localized script data
- This exposes the WordPress debug mode flag to JavaScript for deprecation warning control

### 2. Updated `assets/js/admin.js` (lines 31-317)
- Refactored the legacy `API` object to delegate to `WPAdminHealth.api` when available
- Added deprecation warning system that:
  - Only shows warnings in debug mode (when `wpAdminHealthData.debug` is true)
  - Tracks which warnings have been shown to avoid console spam (one warning per method)
  - Shows clear migration guidance: `[WPAdminHealth] WPAdminHealth.API.get() is deprecated. Use WPAdminHealth.api.get() instead. See docs/developers/js-api.md for migration guide.`
- Maintained full backward compatibility:
  - All existing methods (`get`, `post`, `put`, `delete`, `request`, `buildPath`, `shouldRetry`) continue to work
  - Falls back to original implementation if `WPAdminHealth.api` is not available
  - Legacy `namespace` property preserved
- Internal methods prefixed with underscore (`_legacyRequest`, `_buildPathInternal`, `_shouldRetry`) for clarity

### 3. Updated `assets/js/entries/settings.test.js` (lines 77-119)
- Added test suite "Legacy API (backward compatibility)" with tests verifying:
  - Legacy API is available on `window.WPAdminHealth`
  - Delegation pattern works correctly when canonical API is available

## How to Verify

```bash
# Run JavaScript lint (should pass with only pre-existing warnings)
npm run lint

# Run JavaScript tests (should pass, 456 tests)
npm test
```

Expected results:
- `npm run lint`: 0 errors, 158 warnings (pre-existing)
- `npm test`: 456 tests passing

Manual verification:
1. With `WP_DEBUG` set to `true`, use `WPAdminHealth.API.get()` in browser console - should see deprecation warning
2. With `WP_DEBUG` set to `false`, use `WPAdminHealth.API.get()` - no warning should appear
3. Legacy API methods should work identically to before and delegate to the canonical `WPAdminHealth.api`

## Risks / Follow-ups

1. **Parameter mapping**: The legacy `API.get(endpoint, params)` now passes params as `{ params }` to the canonical API. This matches the new API signature but may be worth monitoring if any code depends on the old behavior.

2. **Timing dependency**: The delegation relies on `WPAdminHealth.api` being set by the entry point modules. If `admin.js` is used standalone without the entry points, it falls back to the legacy implementation (which works but doesn't benefit from the new API's features like caching and deduplication).

3. **Future removal**: The deprecation warnings reference `docs/developers/js-api.md` for migration guidance. In a future major version, consider removing the legacy API entirely after sufficient migration period.
