---

## Status: DONE

## Summary of Changes

### New Files Created
1. **`includes/Exceptions/NotFoundException.php`** - Exception class for resource not found errors (404) with factory methods: `resource()`, `post()`, `user()`, `setting()`, `route()`
2. **`includes/Exceptions/index.php`** - Directory index protection
3. **`tests/unit-standalone/Exceptions/ExceptionsTest.php`** - Comprehensive test suite for all exception classes

### Files Modified
1. **`includes/REST/RestController.php`** - Added exception handling infrastructure:
   - `handle_exception()` - Converts any Throwable to WP_REST_Response
   - `format_exception_response()` - Formats WPAdminHealthException to REST response
   - `format_generic_exception_response()` - Formats generic exceptions
   - `execute_with_exception_handling()` - Wrapper for controller callbacks
   - `log_exception()` - Debug logging for exceptions

2. **`includes/Application/Database/RunCleanup.php`** - Throws `ValidationException` for invalid cleanup types

3. **`includes/Application/Database/RunOptimization.php`** - Throws `DatabaseException` when no tables are optimized

4. **`includes/Application/Media/RunScan.php`** - Throws `ValidationException` for invalid scan types

5. **`tests/unit-standalone/Application/Database/RunCleanupTest.php`** - Updated to expect exceptions

## How to Verify

```bash
# Run lint (JS only - 0 errors, 161 pre-existing warnings)
npm run lint

# Run tests (417 tests pass)
npm test
```

## Risks / Follow-ups

1. **Incremental adoption required** - REST controllers need to be updated one-by-one to use `execute_with_exception_handling()` wrapper or catch exceptions directly. The infrastructure is in place but not yet used by all endpoints.

2. **PHP test coverage** - The new PHP exception classes have tests in `tests/unit-standalone/Exceptions/ExceptionsTest.php`, but running PHP tests requires a WordPress environment (`./vendor/bin/phpunit`). The JS tests pass.

3. **Debug mode sensitivity** - The `format_generic_exception_response()` method checks `WP_DEBUG` to determine whether to include stack traces. Ensure production environments have `WP_DEBUG` disabled.

4. **Backward compatibility** - The existing `format_error_response()` method in RestController was preserved for backward compatibility with existing code that may use it.
