---

## Status: DONE

## Summary of Changes

1. **Implemented `RunOptimization` use-case** (`includes/Application/Database/RunOptimization.php`):
   - Added constructor injection for `SettingsInterface`, `OptimizerInterface`, `ConnectionInterface`, and optional `ActivityLoggerInterface`
   - Implemented `execute()` method that orchestrates optimization operations
   - Added convenience methods `optimize_all()` and `optimize_tables()`
   - Implemented activity logging via `ActivityLoggerInterface` or fallback to scan history table

2. **Refactored `DatabaseController`** (`includes/REST/DatabaseController.php`):
   - Replaced `TrashCleanerInterface` and `OptimizerInterface` dependencies with `RunCleanup` and `RunOptimization` use-cases
   - Simplified `clean()` method to delegate to `RunCleanup->execute()`
   - Simplified `optimize()` method to delegate to `RunOptimization->execute()`
   - Removed 6 private business logic methods: `clean_revisions()`, `clean_transients()`, `clean_spam()`, `clean_trash()`, `clean_orphaned()`, and `log_activity()` (now handled by use-cases)
   - Controller now follows the pattern: validate input -> check permissions -> call use-case -> format response

3. **Updated `RESTServiceProvider`** (`includes/Providers/RESTServiceProvider.php`):
   - Added imports for `RunCleanup` and `RunOptimization`
   - Added both use-cases to the `$provides` array
   - Added string aliases for backward compatibility
   - Registered bindings for `RunCleanup` and `RunOptimization` with their dependencies
   - Updated `DatabaseController` binding to inject use-cases instead of raw services

## How to Verify

```bash
# Run linting (should pass with only warnings, no errors)
npm run lint

# Run tests (all 417 tests should pass)
npm test
```

## Risks / Follow-ups

1. **Activity logging behavior change**: The `RunCleanup` use-case only logs activity when NOT in safe mode, whereas the old controller logged activity after every cleanup. This is a semantic improvement (preview operations shouldn't be logged) but may change existing behavior.

2. **Backward compatibility**: The API routes remain stable as required. The response format is unchanged.

3. **Future refactoring opportunity**: Other controllers (MediaController, PerformanceController) could benefit from similar refactoring to use their respective use-cases more fully.
