The formatting issue is fixed. The remaining issues are:
1. File naming convention (pre-existing, part of PSR-4 autoloading strategy used in the project)
2. Using `$default` as a parameter name (warning only, common practice)

These are pre-existing and consistent with the project's coding standards.

---

## Status: DONE

## Summary of Changes

### Problem Found
The `Performance\HeartbeatController` class had a **critical data structure mismatch** with the `REST\Performance\HeartbeatController` class:

1. **Old format** (Performance\HeartbeatController):
   ```php
   ['admin' => 60, 'post-editor' => 15, 'frontend' => 60]
   // Values: int or 'disabled' string
   ```

2. **REST API format** (expected by frontend JS):
   ```php
   ['dashboard' => ['enabled' => true, 'interval' => 60], ...]
   // Values: object with enabled (bool) and interval (int)
   ```

Both used the same option key `wpha_heartbeat_settings`, causing incompatibility.

### Changes Made to `includes/Performance/HeartbeatController.php`:

1. **Aligned location names**: Changed from `admin`, `post-editor`, `frontend` to `dashboard`, `editor`, `frontend` to match REST API
2. **Aligned data structure**: Changed from flat int/'disabled' values to `{enabled: bool, interval: int}` objects
3. **Added migration support**: Automatic migration from old format to new format via `migrate_settings()` method
4. **Fixed PHPStan issues**: 
   - `estimate_requests_saved()` now explicitly returns `int` (using cast)
   - `get_active_preset()` now returns `string` (never null, returns 'custom')
   - `get_current_location()` now returns `string` (always returns a valid location)
5. **Added type hints**: All methods now have proper parameter and return type declarations
6. **Added new helper methods**: `is_enabled()`, `get_interval()`, `update_location_settings()`
7. **Added i18n support**: Preset labels/descriptions now use `__()` for translation
8. **Removed PHPStan baseline entries**: 3 entries for this file were removed since issues are fixed

### Files Modified:
- `includes/Performance/HeartbeatController.php` - Complete refactor
- `phpstan-baseline.neon` - Removed 3 obsolete baseline entries

## How to Verify

```bash
# Check PHP syntax
php -l includes/Performance/HeartbeatController.php

# Run lint (warnings only, no errors)
npm run lint

# Run tests (all pass)
npm test

# Check PHPCS (remaining errors are pre-existing file naming)
vendor/bin/phpcs --standard=WordPress includes/Performance/HeartbeatController.php
```

## Risks / Follow-ups

1. **Migration behavior**: The `migrate_settings()` method will automatically convert old settings format to new format and save. This is a one-time migration per site.

2. **Dependent features verified**: The REST API controller (`REST\Performance\HeartbeatController`) and JavaScript frontend (`performance.js`) already use the new format, so this change ensures compatibility.

3. **Editor heartbeat consideration**: The editor location keeps heartbeat enabled by default (interval: 60s for minimal preset) to preserve essential features like post autosave, post locking for concurrent editing, and the block editor's autosave functionality.

4. **Backwards compatibility**: The deprecated `update_frequency()` method is kept for any external code that may depend on it.
