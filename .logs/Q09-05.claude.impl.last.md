---

## Status: DONE

## Summary of Changes

### `includes/Integrations/Multilingual.php` (from previous session)
- Added table existence guards (`wpml_translations_table_exists()`) before querying `icl_translations` table
- Added caching for translation queries to improve performance
- Added explicit type casting to ensure consistent return types
- Fixed potential issues with WPML/Polylang detection

### `tests/unit-standalone/Integration/MultilingualIntegrationTest.php` (new file)
- Created comprehensive unit tests with 20 test cases covering:
  - `get_id()`, `get_name()`, `is_available()`, `get_active_plugin()`
  - `get_languages()`, `get_current_language()`
  - `get_translations()` with table guards and caching
  - `check_translated_media_usage()` early returns
  - `get_used_attachments()` with/without WPML table
  - `is_attachment_used()` delegation
  - `get_statistics()` structure validation
  - `filter_attachments_by_language()` edge cases
  - `get_capabilities()` media detection
  - `get_current_version()`, `get_min_version()`
  - `get_attachment_usage()` translation info

### `tests/bootstrap-standalone.php` (from previous session)
- Added WPML function stubs (`icl_get_languages`, `icl_get_current_language`)
- Added `get_post()` stub for mock posts
- Added `get_post_type()` stub for mock post types

## How to Verify

```bash
# Run PHP standalone tests
./vendor/bin/phpunit --bootstrap tests/bootstrap-standalone.php tests/unit-standalone/

# Run npm lint (0 errors, 166 pre-existing warnings)
npm run lint

# Run npm tests (101 tests pass)
npm test
```

## Risks / Follow-ups

1. **MockConnection pattern matching limitation**: The mock's regex-based pattern matching doesn't handle multi-line SQL queries well. One test (`test_get_attachment_usage_returns_translation_info`) uses an anonymous class extension to work around this. Consider improving MockConnection's pattern matching in the future.

2. **Pre-existing lint warnings**: 166 ESLint warnings exist (JSDoc types, React prop-types) - these are pre-existing and not related to this change.

3. **Pre-existing test console warnings**: React `act()` warnings in ActivityTimeline tests are pre-existing.
