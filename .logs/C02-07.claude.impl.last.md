---

## Status: DONE

## Summary of Changes

1. **Created `scripts/check-forbidden-patterns.sh`** - A new bash script that enforces architectural guidelines by detecting misuse of `Plugin::get_instance()` in the codebase:
   - **Check 1**: Scans forbidden directories (Contracts, Domain, Services, Exceptions, Container, AI) where `Plugin::get_instance()` should NEVER be used
   - **Check 2**: Warns about undocumented edge adapter usages in other `includes/` files (non-blocking)
   - **Check 3**: Detects direct `get_container()` access in domain code

2. **Updated `.github/workflows/ci.yml`** - Added a new `forbidden-patterns` CI job that runs the script on every push/PR to main or develop branches

3. **Updated `docs/developers/edge-adapters.md`** - Added comprehensive "CI Enforcement" section documenting:
   - Allowed locations (no documentation needed)
   - Forbidden locations (will fail CI)
   - Locations requiring documentation (warnings)

## How to Verify

```bash
# Run the forbidden patterns check locally
./scripts/check-forbidden-patterns.sh

# Run lint (should show 0 errors, only warnings)
npm run lint

# Run tests (all 417 should pass)
npm test
```

## Risks / Follow-ups

1. **Two undocumented usages detected**: The script found `Plugin::get_instance()` in `includes/RestApi.php` and `includes/HealthCalculator.php` (though the HealthCalculator one is in a docblock example). These are warnings only - adding `EDGE ADAPTER` documentation comments would resolve them.

2. **Grep limitations**: The script uses simple grep pattern matching so it may detect usages in comments/docblocks (like the HealthCalculator example). This is by design - it's better to over-report than miss real violations. Warnings are non-blocking.

3. **New directories**: If new directories are added that should be in the "forbidden" or "allowed" lists, the script should be updated accordingly.
